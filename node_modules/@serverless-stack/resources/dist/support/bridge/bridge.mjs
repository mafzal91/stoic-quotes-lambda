import { createRequire as topLevelCreateRequire } from 'module';const require = topLevelCreateRequire(import.meta.url);
var gh=Object.create;var En=Object.defineProperty;var yh=Object.getOwnPropertyDescriptor;var bh=Object.getOwnPropertyNames;var vh=Object.getPrototypeOf,mh=Object.prototype.hasOwnProperty;var s=(t,e)=>En(t,"name",{value:e,configurable:!0}),S=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var wh=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of bh(e))!mh.call(t,n)&&n!==r&&En(t,n,{get:()=>e[n],enumerable:!(i=yh(e,n))||i.enumerable});return t};var Sh=(t,e,r)=>(r=t!=null?gh(vh(t)):{},wh(e||!t||!t.__esModule?En(r,"default",{value:t,enumerable:!0}):r,t));var Vr=b((Nm,Ao)=>{Ao.exports=xh;var Eh=Object.prototype.hasOwnProperty;function xh(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var i in r)Eh.call(r,i)&&(t[i]=r[i])}return t}s(xh,"extend")});var xn=b((Mm,ko)=>{ko.exports=S("stream")});var Mo=b((Lm,No)=>{"use strict";function Bo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}s(Bo,"ownKeys");function Ch(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Bo(Object(r),!0).forEach(function(i){Th(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bo(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}s(Ch,"_objectSpread");function Th(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}s(Th,"_defineProperty");function Ih(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}s(Ih,"_classCallCheck");function Po(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}s(Po,"_defineProperties");function Oh(t,e,r){return e&&Po(t.prototype,e),r&&Po(t,r),t}s(Oh,"_createClass");var Rh=S("buffer"),Hr=Rh.Buffer,Ah=S("util"),Cn=Ah.inspect,kh=Cn&&Cn.custom||"inspect";function Bh(t,e,r){Hr.prototype.copy.call(t,e,r)}s(Bh,"copyBuffer");No.exports=function(){function t(){Ih(this,t),this.head=null,this.tail=null,this.length=0}return s(t,"BufferList"),Oh(t,[{key:"push",value:s(function(r){var i={data:r,next:null};this.length>0?this.tail.next=i:this.head=i,this.tail=i,++this.length},"push")},{key:"unshift",value:s(function(r){var i={data:r,next:this.head};this.length===0&&(this.tail=i),this.head=i,++this.length},"unshift")},{key:"shift",value:s(function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},"shift")},{key:"clear",value:s(function(){this.head=this.tail=null,this.length=0},"clear")},{key:"join",value:s(function(r){if(this.length===0)return"";for(var i=this.head,n=""+i.data;i=i.next;)n+=r+i.data;return n},"join")},{key:"concat",value:s(function(r){if(this.length===0)return Hr.alloc(0);for(var i=Hr.allocUnsafe(r>>>0),n=this.head,o=0;n;)Bh(n.data,i,o),o+=n.data.length,n=n.next;return i},"concat")},{key:"consume",value:s(function(r,i){var n;return r<this.head.data.length?(n=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?n=this.shift():n=i?this._getString(r):this._getBuffer(r),n},"consume")},{key:"first",value:s(function(){return this.head.data},"first")},{key:"_getString",value:s(function(r){var i=this.head,n=1,o=i.data;for(r-=o.length;i=i.next;){var a=i.data,l=r>a.length?a.length:r;if(l===a.length?o+=a:o+=a.slice(0,r),r-=l,r===0){l===a.length?(++n,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(l));break}++n}return this.length-=n,o},"_getString")},{key:"_getBuffer",value:s(function(r){var i=Hr.allocUnsafe(r),n=this.head,o=1;for(n.data.copy(i),r-=n.data.length;n=n.next;){var a=n.data,l=r>a.length?a.length:r;if(a.copy(i,i.length-r,0,l),r-=l,r===0){l===a.length?(++o,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(l));break}++o}return this.length-=o,i},"_getBuffer")},{key:kh,value:s(function(r,i){return Cn(this,Ch({},i,{depth:0,customInspect:!1}))},"value")}]),t}()});var In=b((qm,qo)=>{"use strict";function Ph(t,e){var r=this,i=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return i||n?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(Tn,this,t)):process.nextTick(Tn,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(o){!e&&o?r._writableState?r._writableState.errorEmitted?process.nextTick($r,r):(r._writableState.errorEmitted=!0,process.nextTick(Lo,r,o)):process.nextTick(Lo,r,o):e?(process.nextTick($r,r),e(o)):process.nextTick($r,r)}),this)}s(Ph,"destroy");function Lo(t,e){Tn(t,e),$r(t)}s(Lo,"emitErrorAndCloseNT");function $r(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}s($r,"emitCloseNT");function Nh(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}s(Nh,"undestroy");function Tn(t,e){t.emit("error",e)}s(Tn,"emitErrorNT");function Mh(t,e){var r=t._readableState,i=t._writableState;r&&r.autoDestroy||i&&i.autoDestroy?t.destroy(e):t.emit("error",e)}s(Mh,"errorOrDestroy");qo.exports={destroy:Ph,undestroy:Nh,errorOrDestroy:Mh}});var He=b((Dm,jo)=>{"use strict";var Uo={};function _e(t,e,r){r||(r=Error);function i(o,a,l){return typeof e=="string"?e:e(o,a,l)}s(i,"getMessage");class n extends r{constructor(a,l,f){super(i(a,l,f))}}s(n,"NodeError"),n.prototype.name=r.name,n.prototype.code=t,Uo[t]=n}s(_e,"createErrorType");function Do(t,e){if(Array.isArray(t)){let r=t.length;return t=t.map(i=>String(i)),r>2?`one of ${e} ${t.slice(0,r-1).join(", ")}, or `+t[r-1]:r===2?`one of ${e} ${t[0]} or ${t[1]}`:`of ${e} ${t[0]}`}else return`of ${e} ${String(t)}`}s(Do,"oneOf");function Lh(t,e,r){return t.substr(!r||r<0?0:+r,e.length)===e}s(Lh,"startsWith");function qh(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}s(qh,"endsWith");function Dh(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}s(Dh,"includes");_e("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);_e("ERR_INVALID_ARG_TYPE",function(t,e,r){let i;typeof e=="string"&&Lh(e,"not ")?(i="must not be",e=e.replace(/^not /,"")):i="must be";let n;if(qh(t," argument"))n=`The ${t} ${i} ${Do(e,"type")}`;else{let o=Dh(t,".")?"property":"argument";n=`The "${t}" ${o} ${i} ${Do(e,"type")}`}return n+=`. Received type ${typeof r}`,n},TypeError);_e("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");_e("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});_e("ERR_STREAM_PREMATURE_CLOSE","Premature close");_e("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});_e("ERR_MULTIPLE_CALLBACK","Callback called multiple times");_e("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");_e("ERR_STREAM_WRITE_AFTER_END","write after end");_e("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);_e("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);_e("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");jo.exports.codes=Uo});var On=b((Um,Fo)=>{"use strict";var Uh=He().codes.ERR_INVALID_OPT_VALUE;function jh(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}s(jh,"highWaterMarkFrom");function Fh(t,e,r,i){var n=jh(e,i,r);if(n!=null){if(!(isFinite(n)&&Math.floor(n)===n)||n<0){var o=i?r:"highWaterMark";throw new Uh(o,n)}return Math.floor(n)}return t.objectMode?16:16*1024}s(Fh,"getHighWaterMark");Fo.exports={getHighWaterMark:Fh}});var Wo=b((jm,Rn)=>{typeof Object.create=="function"?Rn.exports=s(function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))},"inherits"):Rn.exports=s(function(e,r){if(r){e.super_=r;var i=s(function(){},"TempCtor");i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e}},"inherits")});var oe=b((Fm,kn)=>{try{if(An=S("util"),typeof An.inherits!="function")throw"";kn.exports=An.inherits}catch{kn.exports=Wo()}var An});var Bn=b((Wm,Vo)=>{Vo.exports=S("util").deprecate});var Mn=b((Vm,Yo)=>{"use strict";Yo.exports=Y;function $o(t){var e=this;this.next=null,this.entry=null,this.finish=function(){pd(e,t)}}s($o,"CorkedRequest");var Ot;Y.WritableState=Qt;var Wh={deprecate:Bn()},Go=xn(),zr=S("buffer").Buffer,Vh=global.Uint8Array||function(){};function Hh(t){return zr.from(t)}s(Hh,"_uint8ArrayToBuffer");function $h(t){return zr.isBuffer(t)||t instanceof Vh}s($h,"_isUint8Array");var Nn=In(),Gh=On(),zh=Gh.getHighWaterMark,$e=He().codes,Kh=$e.ERR_INVALID_ARG_TYPE,Yh=$e.ERR_METHOD_NOT_IMPLEMENTED,Qh=$e.ERR_MULTIPLE_CALLBACK,Jh=$e.ERR_STREAM_CANNOT_PIPE,Xh=$e.ERR_STREAM_DESTROYED,Zh=$e.ERR_STREAM_NULL_VALUES,ed=$e.ERR_STREAM_WRITE_AFTER_END,td=$e.ERR_UNKNOWN_ENCODING,Rt=Nn.errorOrDestroy;oe()(Y,Go);function rd(){}s(rd,"nop");function Qt(t,e,r){Ot=Ot||lt(),t=t||{},typeof r!="boolean"&&(r=e instanceof Ot),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=zh(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=t.decodeStrings===!1;this.decodeStrings=!i,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(n){ld(e,n)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new $o(this)}s(Qt,"WritableState");Qt.prototype.getBuffer=s(function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r},"getBuffer");(function(){try{Object.defineProperty(Qt.prototype,"buffer",{get:Wh.deprecate(s(function(){return this.getBuffer()},"writableStateBufferGetter"),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var Gr;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Gr=Function.prototype[Symbol.hasInstance],Object.defineProperty(Y,Symbol.hasInstance,{value:s(function(e){return Gr.call(this,e)?!0:this!==Y?!1:e&&e._writableState instanceof Qt},"value")})):Gr=s(function(e){return e instanceof this},"realHasInstance");function Y(t){Ot=Ot||lt();var e=this instanceof Ot;if(!e&&!Gr.call(Y,this))return new Y(t);this._writableState=new Qt(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),Go.call(this)}s(Y,"Writable");Y.prototype.pipe=function(){Rt(this,new Jh)};function id(t,e){var r=new ed;Rt(t,r),process.nextTick(e,r)}s(id,"writeAfterEnd");function nd(t,e,r,i){var n;return r===null?n=new Zh:typeof r!="string"&&!e.objectMode&&(n=new Kh("chunk",["string","Buffer"],r)),n?(Rt(t,n),process.nextTick(i,n),!1):!0}s(nd,"validChunk");Y.prototype.write=function(t,e,r){var i=this._writableState,n=!1,o=!i.objectMode&&$h(t);return o&&!zr.isBuffer(t)&&(t=Hh(t)),typeof e=="function"&&(r=e,e=null),o?e="buffer":e||(e=i.defaultEncoding),typeof r!="function"&&(r=rd),i.ending?id(this,r):(o||nd(this,i,t,r))&&(i.pendingcb++,n=od(this,i,o,t,e,r)),n};Y.prototype.cork=function(){this._writableState.corked++};Y.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&zo(this,t))};Y.prototype.setDefaultEncoding=s(function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new td(e);return this._writableState.defaultEncoding=e,this},"setDefaultEncoding");Object.defineProperty(Y.prototype,"writableBuffer",{enumerable:!1,get:s(function(){return this._writableState&&this._writableState.getBuffer()},"get")});function sd(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=zr.from(e,r)),e}s(sd,"decodeChunk");Object.defineProperty(Y.prototype,"writableHighWaterMark",{enumerable:!1,get:s(function(){return this._writableState.highWaterMark},"get")});function od(t,e,r,i,n,o){if(!r){var a=sd(e,i,n);i!==a&&(r=!0,n="buffer",i=a)}var l=e.objectMode?1:i.length;e.length+=l;var f=e.length<e.highWaterMark;if(f||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:o,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else Pn(t,e,!1,l,i,n,o);return f}s(od,"writeOrBuffer");function Pn(t,e,r,i,n,o,a){e.writelen=i,e.writecb=a,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new Xh("write")):r?t._writev(n,e.onwrite):t._write(n,o,e.onwrite),e.sync=!1}s(Pn,"doWrite");function ad(t,e,r,i,n){--e.pendingcb,r?(process.nextTick(n,i),process.nextTick(Yt,t,e),t._writableState.errorEmitted=!0,Rt(t,i)):(n(i),t._writableState.errorEmitted=!0,Rt(t,i),Yt(t,e))}s(ad,"onwriteError");function fd(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}s(fd,"onwriteStateUpdate");function ld(t,e){var r=t._writableState,i=r.sync,n=r.writecb;if(typeof n!="function")throw new Qh;if(fd(r),e)ad(t,r,i,e,n);else{var o=Ko(r)||t.destroyed;!o&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&zo(t,r),i?process.nextTick(Ho,t,r,o,n):Ho(t,r,o,n)}}s(ld,"onwrite");function Ho(t,e,r,i){r||ud(t,e),e.pendingcb--,i(),Yt(t,e)}s(Ho,"afterWrite");function ud(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}s(ud,"onwriteDrain");function zo(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var i=e.bufferedRequestCount,n=new Array(i),o=e.corkedRequestsFree;o.entry=r;for(var a=0,l=!0;r;)n[a]=r,r.isBuf||(l=!1),r=r.next,a+=1;n.allBuffers=l,Pn(t,e,!0,e.length,n,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new $o(e),e.bufferedRequestCount=0}else{for(;r;){var f=r.chunk,u=r.encoding,c=r.callback,d=e.objectMode?1:f.length;if(Pn(t,e,!1,d,f,u,c),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}s(zo,"clearBuffer");Y.prototype._write=function(t,e,r){r(new Yh("_write()"))};Y.prototype._writev=null;Y.prototype.end=function(t,e,r){var i=this._writableState;return typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),i.ending||dd(this,i,r),this};Object.defineProperty(Y.prototype,"writableLength",{enumerable:!1,get:s(function(){return this._writableState.length},"get")});function Ko(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}s(Ko,"needFinish");function cd(t,e){t._final(function(r){e.pendingcb--,r&&Rt(t,r),e.prefinished=!0,t.emit("prefinish"),Yt(t,e)})}s(cd,"callFinal");function hd(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(cd,t,e)):(e.prefinished=!0,t.emit("prefinish")))}s(hd,"prefinish");function Yt(t,e){var r=Ko(e);if(r&&(hd(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var i=t._readableState;(!i||i.autoDestroy&&i.endEmitted)&&t.destroy()}return r}s(Yt,"finishMaybe");function dd(t,e,r){e.ending=!0,Yt(t,e),r&&(e.finished?process.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}s(dd,"endWritable");function pd(t,e,r){var i=t.entry;for(t.entry=null;i;){var n=i.callback;e.pendingcb--,n(r),i=i.next}e.corkedRequestsFree.next=t}s(pd,"onCorkedFinish");Object.defineProperty(Y.prototype,"destroyed",{enumerable:!1,get:s(function(){return this._writableState===void 0?!1:this._writableState.destroyed},"get"),set:s(function(e){!this._writableState||(this._writableState.destroyed=e)},"set")});Y.prototype.destroy=Nn.destroy;Y.prototype._undestroy=Nn.undestroy;Y.prototype._destroy=function(t,e){e(t)}});var lt=b((Hm,Jo)=>{"use strict";var _d=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};Jo.exports=Te;var Qo=Dn(),qn=Mn();oe()(Te,Qo);for(Ln=_d(qn.prototype),Kr=0;Kr<Ln.length;Kr++)Yr=Ln[Kr],Te.prototype[Yr]||(Te.prototype[Yr]=qn.prototype[Yr]);var Ln,Yr,Kr;function Te(t){if(!(this instanceof Te))return new Te(t);Qo.call(this,t),qn.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",gd)))}s(Te,"Duplex");Object.defineProperty(Te.prototype,"writableHighWaterMark",{enumerable:!1,get:s(function(){return this._writableState.highWaterMark},"get")});Object.defineProperty(Te.prototype,"writableBuffer",{enumerable:!1,get:s(function(){return this._writableState&&this._writableState.getBuffer()},"get")});Object.defineProperty(Te.prototype,"writableLength",{enumerable:!1,get:s(function(){return this._writableState.length},"get")});function gd(){this._writableState.ended||process.nextTick(yd,this)}s(gd,"onend");function yd(t){t.end()}s(yd,"onEndNT");Object.defineProperty(Te.prototype,"destroyed",{enumerable:!1,get:s(function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},"get"),set:s(function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)},"set")})});var jn=b((Un,Zo)=>{var Qr=S("buffer"),Ie=Qr.Buffer;function Xo(t,e){for(var r in t)e[r]=t[r]}s(Xo,"copyProps");Ie.from&&Ie.alloc&&Ie.allocUnsafe&&Ie.allocUnsafeSlow?Zo.exports=Qr:(Xo(Qr,Un),Un.Buffer=ut);function ut(t,e,r){return Ie(t,e,r)}s(ut,"SafeBuffer");ut.prototype=Object.create(Ie.prototype);Xo(Ie,ut);ut.from=function(t,e,r){if(typeof t=="number")throw new TypeError("Argument must not be a number");return Ie(t,e,r)};ut.alloc=function(t,e,r){if(typeof t!="number")throw new TypeError("Argument must be a number");var i=Ie(t);return e!==void 0?typeof r=="string"?i.fill(e,r):i.fill(e):i.fill(0),i};ut.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Ie(t)};ut.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Qr.SlowBuffer(t)}});var Vn=b(ta=>{"use strict";var Wn=jn().Buffer,ea=Wn.isEncoding||function(t){switch(t=""+t,t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function bd(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}s(bd,"_normalizeEncoding");function vd(t){var e=bd(t);if(typeof e!="string"&&(Wn.isEncoding===ea||!ea(t)))throw new Error("Unknown encoding: "+t);return e||t}s(vd,"normalizeEncoding");ta.StringDecoder=Jt;function Jt(t){this.encoding=vd(t);var e;switch(this.encoding){case"utf16le":this.text=Cd,this.end=Td,e=4;break;case"utf8":this.fillLast=Sd,e=4;break;case"base64":this.text=Id,this.end=Od,e=3;break;default:this.write=Rd,this.end=Ad;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Wn.allocUnsafe(e)}s(Jt,"StringDecoder");Jt.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""};Jt.prototype.end=xd;Jt.prototype.text=Ed;Jt.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function Fn(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}s(Fn,"utf8CheckByte");function md(t,e,r){var i=e.length-1;if(i<r)return 0;var n=Fn(e[i]);return n>=0?(n>0&&(t.lastNeed=n-1),n):--i<r||n===-2?0:(n=Fn(e[i]),n>=0?(n>0&&(t.lastNeed=n-2),n):--i<r||n===-2?0:(n=Fn(e[i]),n>=0?(n>0&&(n===2?n=0:t.lastNeed=n-3),n):0))}s(md,"utf8CheckIncomplete");function wd(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}s(wd,"utf8CheckExtraBytes");function Sd(t){var e=this.lastTotal-this.lastNeed,r=wd(this,t,e);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}s(Sd,"utf8FillLast");function Ed(t,e){var r=md(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var i=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString("utf8",e,i)}s(Ed,"utf8Text");function xd(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}s(xd,"utf8End");function Cd(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var i=r.charCodeAt(r.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}s(Cd,"utf16Text");function Td(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}s(Td,"utf16End");function Id(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}s(Id,"base64Text");function Od(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}s(Od,"base64End");function Rd(t){return t.toString(this.encoding)}s(Rd,"simpleWrite");function Ad(t){return t&&t.length?this.write(t):""}s(Ad,"simpleEnd")});var Jr=b((Gm,na)=>{"use strict";var ra=He().codes.ERR_STREAM_PREMATURE_CLOSE;function kd(t){var e=!1;return function(){if(!e){e=!0;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];t.apply(this,i)}}}s(kd,"once");function Bd(){}s(Bd,"noop");function Pd(t){return t.setHeader&&typeof t.abort=="function"}s(Pd,"isRequest");function ia(t,e,r){if(typeof e=="function")return ia(t,null,e);e||(e={}),r=kd(r||Bd);var i=e.readable||e.readable!==!1&&t.readable,n=e.writable||e.writable!==!1&&t.writable,o=s(function(){t.writable||l()},"onlegacyfinish"),a=t._writableState&&t._writableState.finished,l=s(function(){n=!1,a=!0,i||r.call(t)},"onfinish"),f=t._readableState&&t._readableState.endEmitted,u=s(function(){i=!1,f=!0,n||r.call(t)},"onend"),c=s(function(g){r.call(t,g)},"onerror"),d=s(function(){var g;if(i&&!f)return(!t._readableState||!t._readableState.ended)&&(g=new ra),r.call(t,g);if(n&&!a)return(!t._writableState||!t._writableState.ended)&&(g=new ra),r.call(t,g)},"onclose"),h=s(function(){t.req.on("finish",l)},"onrequest");return Pd(t)?(t.on("complete",l),t.on("abort",d),t.req?h():t.on("request",h)):n&&!t._writableState&&(t.on("end",o),t.on("close",o)),t.on("end",u),t.on("finish",l),e.error!==!1&&t.on("error",c),t.on("close",d),function(){t.removeListener("complete",l),t.removeListener("abort",d),t.removeListener("request",h),t.req&&t.req.removeListener("finish",l),t.removeListener("end",o),t.removeListener("close",o),t.removeListener("finish",l),t.removeListener("end",u),t.removeListener("error",c),t.removeListener("close",d)}}s(ia,"eos");na.exports=ia});var oa=b((zm,sa)=>{"use strict";var Xr;function Ge(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}s(Ge,"_defineProperty");var Nd=Jr(),ze=Symbol("lastResolve"),ct=Symbol("lastReject"),Xt=Symbol("error"),Zr=Symbol("ended"),ht=Symbol("lastPromise"),Hn=Symbol("handlePromise"),dt=Symbol("stream");function Ke(t,e){return{value:t,done:e}}s(Ke,"createIterResult");function Md(t){var e=t[ze];if(e!==null){var r=t[dt].read();r!==null&&(t[ht]=null,t[ze]=null,t[ct]=null,e(Ke(r,!1)))}}s(Md,"readAndResolve");function Ld(t){process.nextTick(Md,t)}s(Ld,"onReadable");function qd(t,e){return function(r,i){t.then(function(){if(e[Zr]){r(Ke(void 0,!0));return}e[Hn](r,i)},i)}}s(qd,"wrapForNext");var Dd=Object.getPrototypeOf(function(){}),Ud=Object.setPrototypeOf((Xr={get stream(){return this[dt]},next:s(function(){var e=this,r=this[Xt];if(r!==null)return Promise.reject(r);if(this[Zr])return Promise.resolve(Ke(void 0,!0));if(this[dt].destroyed)return new Promise(function(a,l){process.nextTick(function(){e[Xt]?l(e[Xt]):a(Ke(void 0,!0))})});var i=this[ht],n;if(i)n=new Promise(qd(i,this));else{var o=this[dt].read();if(o!==null)return Promise.resolve(Ke(o,!1));n=new Promise(this[Hn])}return this[ht]=n,n},"next")},Ge(Xr,Symbol.asyncIterator,function(){return this}),Ge(Xr,"return",s(function(){var e=this;return new Promise(function(r,i){e[dt].destroy(null,function(n){if(n){i(n);return}r(Ke(void 0,!0))})})},"_return")),Xr),Dd),jd=s(function(e){var r,i=Object.create(Ud,(r={},Ge(r,dt,{value:e,writable:!0}),Ge(r,ze,{value:null,writable:!0}),Ge(r,ct,{value:null,writable:!0}),Ge(r,Xt,{value:null,writable:!0}),Ge(r,Zr,{value:e._readableState.endEmitted,writable:!0}),Ge(r,Hn,{value:s(function(o,a){var l=i[dt].read();l?(i[ht]=null,i[ze]=null,i[ct]=null,o(Ke(l,!1))):(i[ze]=o,i[ct]=a)},"value"),writable:!0}),r));return i[ht]=null,Nd(e,function(n){if(n&&n.code!=="ERR_STREAM_PREMATURE_CLOSE"){var o=i[ct];o!==null&&(i[ht]=null,i[ze]=null,i[ct]=null,o(n)),i[Xt]=n;return}var a=i[ze];a!==null&&(i[ht]=null,i[ze]=null,i[ct]=null,a(Ke(void 0,!0))),i[Zr]=!0}),e.on("readable",Ld.bind(null,i)),i},"createReadableStreamAsyncIterator");sa.exports=jd});var ua=b((Km,la)=>{"use strict";function aa(t,e,r,i,n,o,a){try{var l=t[o](a),f=l.value}catch(u){r(u);return}l.done?e(f):Promise.resolve(f).then(i,n)}s(aa,"asyncGeneratorStep");function Fd(t){return function(){var e=this,r=arguments;return new Promise(function(i,n){var o=t.apply(e,r);function a(f){aa(o,i,n,a,l,"next",f)}s(a,"_next");function l(f){aa(o,i,n,a,l,"throw",f)}s(l,"_throw"),a(void 0)})}}s(Fd,"_asyncToGenerator");function fa(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}s(fa,"ownKeys");function Wd(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?fa(Object(r),!0).forEach(function(i){Vd(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):fa(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}s(Wd,"_objectSpread");function Vd(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}s(Vd,"_defineProperty");var Hd=He().codes.ERR_INVALID_ARG_TYPE;function $d(t,e,r){var i;if(e&&typeof e.next=="function")i=e;else if(e&&e[Symbol.asyncIterator])i=e[Symbol.asyncIterator]();else if(e&&e[Symbol.iterator])i=e[Symbol.iterator]();else throw new Hd("iterable",["Iterable"],e);var n=new t(Wd({objectMode:!0},r)),o=!1;n._read=function(){o||(o=!0,a())};function a(){return l.apply(this,arguments)}s(a,"next");function l(){return l=Fd(function*(){try{var f=yield i.next(),u=f.value,c=f.done;c?n.push(null):n.push(yield u)?a():o=!1}catch(d){n.destroy(d)}}),l.apply(this,arguments)}return s(l,"_next2"),n}s($d,"from");la.exports=$d});var Dn=b((Qm,ma)=>{"use strict";ma.exports=L;var At;L.ReadableState=pa;var Ym=S("events").EventEmitter,da=s(function(e,r){return e.listeners(r).length},"EElistenerCount"),er=xn(),ei=S("buffer").Buffer,Gd=global.Uint8Array||function(){};function zd(t){return ei.from(t)}s(zd,"_uint8ArrayToBuffer");function Kd(t){return ei.isBuffer(t)||t instanceof Gd}s(Kd,"_isUint8Array");var $n=S("util"),N;$n&&$n.debuglog?N=$n.debuglog("stream"):N=s(function(){},"debug");var Yd=Mo(),Xn=In(),Qd=On(),Jd=Qd.getHighWaterMark,ti=He().codes,Xd=ti.ERR_INVALID_ARG_TYPE,Zd=ti.ERR_STREAM_PUSH_AFTER_EOF,ep=ti.ERR_METHOD_NOT_IMPLEMENTED,tp=ti.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,kt,Gn,zn;oe()(L,er);var Zt=Xn.errorOrDestroy,Kn=["error","close","destroy","pause","resume"];function rp(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}s(rp,"prependListener");function pa(t,e,r){At=At||lt(),t=t||{},typeof r!="boolean"&&(r=e instanceof At),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=Jd(this,t,"readableHighWaterMark",r),this.buffer=new Yd,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(kt||(kt=Vn().StringDecoder),this.decoder=new kt(t.encoding),this.encoding=t.encoding)}s(pa,"ReadableState");function L(t){if(At=At||lt(),!(this instanceof L))return new L(t);var e=this instanceof At;this._readableState=new pa(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),er.call(this)}s(L,"Readable");Object.defineProperty(L.prototype,"destroyed",{enumerable:!1,get:s(function(){return this._readableState===void 0?!1:this._readableState.destroyed},"get"),set:s(function(e){!this._readableState||(this._readableState.destroyed=e)},"set")});L.prototype.destroy=Xn.destroy;L.prototype._undestroy=Xn.undestroy;L.prototype._destroy=function(t,e){e(t)};L.prototype.push=function(t,e){var r=this._readableState,i;return r.objectMode?i=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=ei.from(t,e),e=""),i=!0),_a(this,t,e,!1,i)};L.prototype.unshift=function(t){return _a(this,t,null,!0,!1)};function _a(t,e,r,i,n){N("readableAddChunk",e);var o=t._readableState;if(e===null)o.reading=!1,sp(t,o);else{var a;if(n||(a=ip(o,e)),a)Zt(t,a);else if(o.objectMode||e&&e.length>0)if(typeof e!="string"&&!o.objectMode&&Object.getPrototypeOf(e)!==ei.prototype&&(e=zd(e)),i)o.endEmitted?Zt(t,new tp):Yn(t,o,e,!0);else if(o.ended)Zt(t,new Zd);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!r?(e=o.decoder.write(e),o.objectMode||e.length!==0?Yn(t,o,e,!1):Jn(t,o)):Yn(t,o,e,!1)}else i||(o.reading=!1,Jn(t,o))}return!o.ended&&(o.length<o.highWaterMark||o.length===0)}s(_a,"readableAddChunk");function Yn(t,e,r,i){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,i?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&ri(t)),Jn(t,e)}s(Yn,"addChunk");function ip(t,e){var r;return!Kd(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new Xd("chunk",["string","Buffer","Uint8Array"],e)),r}s(ip,"chunkInvalid");L.prototype.isPaused=function(){return this._readableState.flowing===!1};L.prototype.setEncoding=function(t){kt||(kt=Vn().StringDecoder);var e=new kt(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,i="";r!==null;)i+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),i!==""&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var ca=1073741824;function np(t){return t>=ca?t=ca:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}s(np,"computeNewHighWaterMark");function ha(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=np(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}s(ha,"howMuchToRead");L.prototype.read=function(t){N("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return N("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?Qn(this):ri(this),null;if(t=ha(t,e),t===0&&e.ended)return e.length===0&&Qn(this),null;var i=e.needReadable;N("need readable",i),(e.length===0||e.length-t<e.highWaterMark)&&(i=!0,N("length less than watermark",i)),e.ended||e.reading?(i=!1,N("reading or ended",i)):i&&(N("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=ha(r,e)));var n;return t>0?n=ba(t,e):n=null,n===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&Qn(this)),n!==null&&this.emit("data",n),n};function sp(t,e){if(N("onEofChunk"),!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?ri(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,ga(t)))}}s(sp,"onEofChunk");function ri(t){var e=t._readableState;N("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(N("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(ga,t))}s(ri,"emitReadable");function ga(t){var e=t._readableState;N("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,Zn(t)}s(ga,"emitReadable_");function Jn(t,e){e.readingMore||(e.readingMore=!0,process.nextTick(op,t,e))}s(Jn,"maybeReadMore");function op(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var r=e.length;if(N("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}s(op,"maybeReadMore_");L.prototype._read=function(t){Zt(this,new ep("_read()"))};L.prototype.pipe=function(t,e){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=t;break;case 1:i.pipes=[i.pipes,t];break;default:i.pipes.push(t);break}i.pipesCount+=1,N("pipe count=%d opts=%j",i.pipesCount,e);var n=(!e||e.end!==!1)&&t!==process.stdout&&t!==process.stderr,o=n?l:m;i.endEmitted?process.nextTick(o):r.once("end",o),t.on("unpipe",a);function a(w,_){N("onunpipe"),w===r&&_&&_.hasUnpiped===!1&&(_.hasUnpiped=!0,c())}s(a,"onunpipe");function l(){N("onend"),t.end()}s(l,"onend");var f=ap(r);t.on("drain",f);var u=!1;function c(){N("cleanup"),t.removeListener("close",p),t.removeListener("finish",g),t.removeListener("drain",f),t.removeListener("error",h),t.removeListener("unpipe",a),r.removeListener("end",l),r.removeListener("end",m),r.removeListener("data",d),u=!0,i.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&f()}s(c,"cleanup"),r.on("data",d);function d(w){N("ondata");var _=t.write(w);N("dest.write",_),_===!1&&((i.pipesCount===1&&i.pipes===t||i.pipesCount>1&&va(i.pipes,t)!==-1)&&!u&&(N("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}s(d,"ondata");function h(w){N("onerror",w),m(),t.removeListener("error",h),da(t,"error")===0&&Zt(t,w)}s(h,"onerror"),rp(t,"error",h);function p(){t.removeListener("finish",g),m()}s(p,"onclose"),t.once("close",p);function g(){N("onfinish"),t.removeListener("close",p),m()}s(g,"onfinish"),t.once("finish",g);function m(){N("unpipe"),r.unpipe(t)}return s(m,"unpipe"),t.emit("pipe",r),i.flowing||(N("pipe resume"),r.resume()),t};function ap(t){return s(function(){var r=t._readableState;N("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&da(t,"data")&&(r.flowing=!0,Zn(t))},"pipeOnDrainFunctionResult")}s(ap,"pipeOnDrain");L.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var i=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<n;o++)i[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=va(e.pipes,t);return a===-1?this:(e.pipes.splice(a,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)};L.prototype.on=function(t,e){var r=er.prototype.on.call(this,t,e),i=this._readableState;return t==="data"?(i.readableListening=this.listenerCount("readable")>0,i.flowing!==!1&&this.resume()):t==="readable"&&!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,N("on readable",i.length,i.reading),i.length?ri(this):i.reading||process.nextTick(fp,this)),r};L.prototype.addListener=L.prototype.on;L.prototype.removeListener=function(t,e){var r=er.prototype.removeListener.call(this,t,e);return t==="readable"&&process.nextTick(ya,this),r};L.prototype.removeAllListeners=function(t){var e=er.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&process.nextTick(ya,this),e};function ya(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}s(ya,"updateReadableListening");function fp(t){N("readable nexttick read 0"),t.read(0)}s(fp,"nReadingNextTick");L.prototype.resume=function(){var t=this._readableState;return t.flowing||(N("resume"),t.flowing=!t.readableListening,lp(this,t)),t.paused=!1,this};function lp(t,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(up,t,e))}s(lp,"resume");function up(t,e){N("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),Zn(t),e.flowing&&!e.reading&&t.read(0)}s(up,"resume_");L.prototype.pause=function(){return N("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(N("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Zn(t){var e=t._readableState;for(N("flow",e.flowing);e.flowing&&t.read()!==null;);}s(Zn,"flow");L.prototype.wrap=function(t){var e=this,r=this._readableState,i=!1;t.on("end",function(){if(N("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&e.push(a)}e.push(null)}),t.on("data",function(a){if(N("wrapped data"),r.decoder&&(a=r.decoder.write(a)),!(r.objectMode&&a==null)&&!(!r.objectMode&&(!a||!a.length))){var l=e.push(a);l||(i=!0,t.pause())}});for(var n in t)this[n]===void 0&&typeof t[n]=="function"&&(this[n]=s(function(l){return s(function(){return t[l].apply(t,arguments)},"methodWrapReturnFunction")},"methodWrap")(n));for(var o=0;o<Kn.length;o++)t.on(Kn[o],this.emit.bind(this,Kn[o]));return this._read=function(a){N("wrapped _read",a),i&&(i=!1,t.resume())},this};typeof Symbol=="function"&&(L.prototype[Symbol.asyncIterator]=function(){return Gn===void 0&&(Gn=oa()),Gn(this)});Object.defineProperty(L.prototype,"readableHighWaterMark",{enumerable:!1,get:s(function(){return this._readableState.highWaterMark},"get")});Object.defineProperty(L.prototype,"readableBuffer",{enumerable:!1,get:s(function(){return this._readableState&&this._readableState.buffer},"get")});Object.defineProperty(L.prototype,"readableFlowing",{enumerable:!1,get:s(function(){return this._readableState.flowing},"get"),set:s(function(e){this._readableState&&(this._readableState.flowing=e)},"set")});L._fromList=ba;Object.defineProperty(L.prototype,"readableLength",{enumerable:!1,get:s(function(){return this._readableState.length},"get")});function ba(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}s(ba,"fromList");function Qn(t){var e=t._readableState;N("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(cp,e,t))}s(Qn,"endReadable");function cp(t,e){if(N("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}s(cp,"endReadableNT");typeof Symbol=="function"&&(L.from=function(t,e){return zn===void 0&&(zn=ua()),zn(L,t,e)});function va(t,e){for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1}s(va,"indexOf")});var es=b((Jm,Sa)=>{"use strict";Sa.exports=Be;var ii=He().codes,hp=ii.ERR_METHOD_NOT_IMPLEMENTED,dp=ii.ERR_MULTIPLE_CALLBACK,pp=ii.ERR_TRANSFORM_ALREADY_TRANSFORMING,_p=ii.ERR_TRANSFORM_WITH_LENGTH_0,ni=lt();oe()(Be,ni);function gp(t,e){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(i===null)return this.emit("error",new dp);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),i(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}s(gp,"afterTransform");function Be(t){if(!(this instanceof Be))return new Be(t);ni.call(this,t),this._transformState={afterTransform:gp.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",yp)}s(Be,"Transform");function yp(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){wa(t,e,r)}):wa(this,null,null)}s(yp,"prefinish");Be.prototype.push=function(t,e){return this._transformState.needTransform=!1,ni.prototype.push.call(this,t,e)};Be.prototype._transform=function(t,e,r){r(new hp("_transform()"))};Be.prototype._write=function(t,e,r){var i=this._transformState;if(i.writecb=r,i.writechunk=t,i.writeencoding=e,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}};Be.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Be.prototype._destroy=function(t,e){ni.prototype._destroy.call(this,t,function(r){e(r)})};function wa(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new _p;if(t._transformState.transforming)throw new pp;return t.push(null)}s(wa,"done")});var Ca=b((Xm,xa)=>{"use strict";xa.exports=tr;var Ea=es();oe()(tr,Ea);function tr(t){if(!(this instanceof tr))return new tr(t);Ea.call(this,t)}s(tr,"PassThrough");tr.prototype._transform=function(t,e,r){r(null,t)}});var Aa=b((Zm,Ra)=>{"use strict";var ts;function bp(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}s(bp,"once");var Oa=He().codes,vp=Oa.ERR_MISSING_ARGS,mp=Oa.ERR_STREAM_DESTROYED;function Ta(t){if(t)throw t}s(Ta,"noop");function wp(t){return t.setHeader&&typeof t.abort=="function"}s(wp,"isRequest");function Sp(t,e,r,i){i=bp(i);var n=!1;t.on("close",function(){n=!0}),ts===void 0&&(ts=Jr()),ts(t,{readable:e,writable:r},function(a){if(a)return i(a);n=!0,i()});var o=!1;return function(a){if(!n&&!o){if(o=!0,wp(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();i(a||new mp("pipe"))}}}s(Sp,"destroyer");function Ia(t){t()}s(Ia,"call");function Ep(t,e){return t.pipe(e)}s(Ep,"pipe");function xp(t){return!t.length||typeof t[t.length-1]!="function"?Ta:t.pop()}s(xp,"popCallback");function Cp(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var i=xp(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new vp("streams");var n,o=e.map(function(a,l){var f=l<e.length-1,u=l>0;return Sp(a,f,u,function(c){n||(n=c),c&&o.forEach(Ia),!f&&(o.forEach(Ia),i(n))})});return e.reduce(Ep)}s(Cp,"pipeline");Ra.exports=Cp});var Ye=b((ge,ir)=>{var rr=S("stream");process.env.READABLE_STREAM==="disable"&&rr?(ir.exports=rr.Readable,Object.assign(ir.exports,rr),ir.exports.Stream=rr):(ge=ir.exports=Dn(),ge.Stream=rr||ge,ge.Readable=ge,ge.Writable=Mn(),ge.Duplex=lt(),ge.Transform=es(),ge.PassThrough=Ca(),ge.finished=Jr(),ge.pipeline=Aa())});var si=b((ew,ka)=>{"use strict";var Tp=Vr(),Ip=Ye().Readable,Op={objectMode:!0},Rp={clean:!0};function Qe(t){if(!(this instanceof Qe))return new Qe(t);this.options=t||{},this.options=Tp(Rp,t),this._inflights=new Map}s(Qe,"Store");Qe.prototype.put=function(t,e){return this._inflights.set(t.messageId,t),e&&e(),this};Qe.prototype.createStream=function(){var t=new Ip(Op),e=!1,r=[],i=0;return this._inflights.forEach(function(n,o){r.push(n)}),t._read=function(){!e&&i<r.length?this.push(r[i++]):this.push(null)},t.destroy=function(){if(!e){var n=this;e=!0,setTimeout(function(){n.emit("close")},0)}},t};Qe.prototype.del=function(t,e){return t=this._inflights.get(t.messageId),t?(this._inflights.delete(t.messageId),e(null,t)):e&&e(new Error("missing packet")),this};Qe.prototype.get=function(t,e){return t=this._inflights.get(t.messageId),t?e(null,t):e&&e(new Error("missing packet")),this};Qe.prototype.close=function(t){this.options.clean&&(this._inflights=null),t&&t()};ka.exports=Qe});var Na=b((tw,Pa)=>{"use strict";var{Buffer:Se}=S("buffer"),Ba=Symbol.for("BufferList");function G(t){if(!(this instanceof G))return new G(t);G._init.call(this,t)}s(G,"BufferList");G._init=s(function(e){Object.defineProperty(this,Ba,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},"_init");G.prototype._new=s(function(e){return new G(e)},"_new");G.prototype._offset=s(function(e){if(e===0)return[0,0];let r=0;for(let i=0;i<this._bufs.length;i++){let n=r+this._bufs[i].length;if(e<n||i===this._bufs.length-1)return[i,e-r];r=n}},"_offset");G.prototype._reverseOffset=function(t){let e=t[0],r=t[1];for(let i=0;i<e;i++)r+=this._bufs[i].length;return r};G.prototype.get=s(function(e){if(e>this.length||e<0)return;let r=this._offset(e);return this._bufs[r[0]][r[1]]},"get");G.prototype.slice=s(function(e,r){return typeof e=="number"&&e<0&&(e+=this.length),typeof r=="number"&&r<0&&(r+=this.length),this.copy(null,0,e,r)},"slice");G.prototype.copy=s(function(e,r,i,n){if((typeof i!="number"||i<0)&&(i=0),(typeof n!="number"||n>this.length)&&(n=this.length),i>=this.length||n<=0)return e||Se.alloc(0);let o=!!e,a=this._offset(i),l=n-i,f=l,u=o&&r||0,c=a[1];if(i===0&&n===this.length){if(!o)return this._bufs.length===1?this._bufs[0]:Se.concat(this._bufs,this.length);for(let d=0;d<this._bufs.length;d++)this._bufs[d].copy(e,u),u+=this._bufs[d].length;return e}if(f<=this._bufs[a[0]].length-c)return o?this._bufs[a[0]].copy(e,r,c,c+f):this._bufs[a[0]].slice(c,c+f);o||(e=Se.allocUnsafe(l));for(let d=a[0];d<this._bufs.length;d++){let h=this._bufs[d].length-c;if(f>h)this._bufs[d].copy(e,u,c),u+=h;else{this._bufs[d].copy(e,u,c,c+f),u+=h;break}f-=h,c&&(c=0)}return e.length>u?e.slice(0,u):e},"copy");G.prototype.shallowSlice=s(function(e,r){if(e=e||0,r=typeof r!="number"?this.length:r,e<0&&(e+=this.length),r<0&&(r+=this.length),e===r)return this._new();let i=this._offset(e),n=this._offset(r),o=this._bufs.slice(i[0],n[0]+1);return n[1]===0?o.pop():o[o.length-1]=o[o.length-1].slice(0,n[1]),i[1]!==0&&(o[0]=o[0].slice(i[1])),this._new(o)},"shallowSlice");G.prototype.toString=s(function(e,r,i){return this.slice(r,i).toString(e)},"toString");G.prototype.consume=s(function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;)if(e>=this._bufs[0].length)e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}return this},"consume");G.prototype.duplicate=s(function(){let e=this._new();for(let r=0;r<this._bufs.length;r++)e.append(this._bufs[r]);return e},"duplicate");G.prototype.append=s(function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(Se.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let r=0;r<e.length;r++)this.append(e[r]);else if(this._isBufferList(e))for(let r=0;r<e._bufs.length;r++)this.append(e._bufs[r]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(Se.from(e));return this},"append");G.prototype._appendBuffer=s(function(e){this._bufs.push(e),this.length+=e.length},"appendBuffer");G.prototype.indexOf=function(t,e,r){if(r===void 0&&typeof e=="string"&&(r=e,e=void 0),typeof t=="function"||Array.isArray(t))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof t=="number"?t=Se.from([t]):typeof t=="string"?t=Se.from(t,r):this._isBufferList(t)?t=t.slice():Array.isArray(t.buffer)?t=Se.from(t.buffer,t.byteOffset,t.byteLength):Se.isBuffer(t)||(t=Se.from(t)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),t.length===0)return e>this.length?this.length:e;let i=this._offset(e),n=i[0],o=i[1];for(;n<this._bufs.length;n++){let a=this._bufs[n];for(;o<a.length;)if(a.length-o>=t.length){let f=a.indexOf(t,o);if(f!==-1)return this._reverseOffset([n,f]);o=a.length-t.length+1}else{let f=this._reverseOffset([n,o]);if(this._match(f,t))return f;o++}o=0}return-1};G.prototype._match=function(t,e){if(this.length-t<e.length)return!1;for(let r=0;r<e.length;r++)if(this.get(t+r)!==e[r])return!1;return!0};(function(){let t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let e in t)(function(r){t[r]===null?G.prototype[r]=function(i,n){return this.slice(i,i+n)[r](0,n)}:G.prototype[r]=function(i=0){return this.slice(i,i+t[r])[r](0)}})(e)})();G.prototype._isBufferList=s(function(e){return e instanceof G||G.isBufferList(e)},"_isBufferList");G.isBufferList=s(function(e){return e!=null&&e[Ba]},"isBufferList");Pa.exports=G});var Ma=b((rw,oi)=>{"use strict";var rs=Ye().Duplex,Ap=oe(),nr=Na();function ie(t){if(!(this instanceof ie))return new ie(t);if(typeof t=="function"){this._callback=t;let e=s(function(i){this._callback&&(this._callback(i),this._callback=null)},"piper").bind(this);this.on("pipe",s(function(i){i.on("error",e)},"onPipe")),this.on("unpipe",s(function(i){i.removeListener("error",e)},"onUnpipe")),t=null}nr._init.call(this,t),rs.call(this)}s(ie,"BufferListStream");Ap(ie,rs);Object.assign(ie.prototype,nr.prototype);ie.prototype._new=s(function(e){return new ie(e)},"_new");ie.prototype._write=s(function(e,r,i){this._appendBuffer(e),typeof i=="function"&&i()},"_write");ie.prototype._read=s(function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},"_read");ie.prototype.end=s(function(e){rs.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},"end");ie.prototype._destroy=s(function(e,r){this._bufs.length=0,this.length=0,r(e)},"_destroy");ie.prototype._isBufferList=s(function(e){return e instanceof ie||e instanceof nr||ie.isBufferList(e)},"_isBufferList");ie.isBufferList=nr.isBufferList;oi.exports=ie;oi.exports.BufferListStream=ie;oi.exports.BufferList=nr});var qa=b((iw,La)=>{var ai=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};s(ai,"Packet");La.exports=ai});var is=b((nw,Da)=>{var C=Da.exports;C.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"};C.codes={};for(let t in C.types){let e=C.types[t];C.codes[e]=t}C.CMD_SHIFT=4;C.CMD_MASK=240;C.DUP_MASK=8;C.QOS_MASK=3;C.QOS_SHIFT=1;C.RETAIN_MASK=1;C.VARBYTEINT_MASK=127;C.VARBYTEINT_FIN_MASK=128;C.VARBYTEINT_MAX=268435455;C.SESSIONPRESENT_MASK=1;C.SESSIONPRESENT_HEADER=Buffer.from([C.SESSIONPRESENT_MASK]);C.CONNACK_HEADER=Buffer.from([C.codes.connack<<C.CMD_SHIFT]);C.USERNAME_MASK=128;C.PASSWORD_MASK=64;C.WILL_RETAIN_MASK=32;C.WILL_QOS_MASK=24;C.WILL_QOS_SHIFT=3;C.WILL_FLAG_MASK=4;C.CLEAN_SESSION_MASK=2;C.CONNECT_HEADER=Buffer.from([C.codes.connect<<C.CMD_SHIFT]);C.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11};C.propertiesCodes={};for(let t in C.properties){let e=C.properties[t];C.propertiesCodes[e]=t}C.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function Je(t){return[0,1,2].map(e=>[0,1].map(r=>[0,1].map(i=>{let n=Buffer.alloc(1);return n.writeUInt8(C.codes[t]<<C.CMD_SHIFT|(r?C.DUP_MASK:0)|e<<C.QOS_SHIFT|i,0,!0),n})))}s(Je,"genHeader");C.PUBLISH_HEADER=Je("publish");C.SUBSCRIBE_HEADER=Je("subscribe");C.SUBSCRIBE_OPTIONS_QOS_MASK=3;C.SUBSCRIBE_OPTIONS_NL_MASK=1;C.SUBSCRIBE_OPTIONS_NL_SHIFT=2;C.SUBSCRIBE_OPTIONS_RAP_MASK=1;C.SUBSCRIBE_OPTIONS_RAP_SHIFT=3;C.SUBSCRIBE_OPTIONS_RH_MASK=3;C.SUBSCRIBE_OPTIONS_RH_SHIFT=4;C.SUBSCRIBE_OPTIONS_RH=[0,16,32];C.SUBSCRIBE_OPTIONS_NL=4;C.SUBSCRIBE_OPTIONS_RAP=8;C.SUBSCRIBE_OPTIONS_QOS=[0,1,2];C.UNSUBSCRIBE_HEADER=Je("unsubscribe");C.ACKS={unsuback:Je("unsuback"),puback:Je("puback"),pubcomp:Je("pubcomp"),pubrel:Je("pubrel"),pubrec:Je("pubrec")};C.SUBACK_HEADER=Buffer.from([C.codes.suback<<C.CMD_SHIFT]);C.VERSION3=Buffer.from([3]);C.VERSION4=Buffer.from([4]);C.VERSION5=Buffer.from([5]);C.VERSION131=Buffer.from([131]);C.VERSION132=Buffer.from([132]);C.QOS=[0,1,2].map(t=>Buffer.from([t]));C.EMPTY={pingreq:Buffer.from([C.codes.pingreq<<4,0]),pingresp:Buffer.from([C.codes.pingresp<<4,0]),disconnect:Buffer.from([C.codes.disconnect<<4,0])}});var ja=b((sw,Ua)=>{var Bt=1e3,Pt=Bt*60,Nt=Pt*60,pt=Nt*24,kp=pt*7,Bp=pt*365.25;Ua.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return Pp(t);if(r==="number"&&isFinite(t))return e.long?Mp(t):Np(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function Pp(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return r*Bp;case"weeks":case"week":case"w":return r*kp;case"days":case"day":case"d":return r*pt;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Nt;case"minutes":case"minute":case"mins":case"min":case"m":return r*Pt;case"seconds":case"second":case"secs":case"sec":case"s":return r*Bt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}s(Pp,"parse");function Np(t){var e=Math.abs(t);return e>=pt?Math.round(t/pt)+"d":e>=Nt?Math.round(t/Nt)+"h":e>=Pt?Math.round(t/Pt)+"m":e>=Bt?Math.round(t/Bt)+"s":t+"ms"}s(Np,"fmtShort");function Mp(t){var e=Math.abs(t);return e>=pt?fi(t,e,pt,"day"):e>=Nt?fi(t,e,Nt,"hour"):e>=Pt?fi(t,e,Pt,"minute"):e>=Bt?fi(t,e,Bt,"second"):t+" ms"}s(Mp,"fmtLong");function fi(t,e,r,i){var n=e>=r*1.5;return Math.round(t/r)+" "+i+(n?"s":"")}s(fi,"plural")});var ns=b((ow,Fa)=>{function Lp(t){r.debug=r,r.default=r,r.coerce=f,r.disable=o,r.enable=n,r.enabled=a,r.humanize=ja(),r.destroy=u,Object.keys(t).forEach(c=>{r[c]=t[c]}),r.names=[],r.skips=[],r.formatters={};function e(c){let d=0;for(let h=0;h<c.length;h++)d=(d<<5)-d+c.charCodeAt(h),d|=0;return r.colors[Math.abs(d)%r.colors.length]}s(e,"selectColor"),r.selectColor=e;function r(c){let d,h=null,p,g;function m(...w){if(!m.enabled)return;let _=m,y=Number(new Date),x=y-(d||y);_.diff=x,_.prev=d,_.curr=y,d=y,w[0]=r.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let T=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(E,M)=>{if(E==="%%")return"%";T++;let H=r.formatters[M];if(typeof H=="function"){let K=w[T];E=H.call(_,K),w.splice(T,1),T--}return E}),r.formatArgs.call(_,w),(_.log||r.log).apply(_,w)}return s(m,"debug"),m.namespace=c,m.useColors=r.useColors(),m.color=r.selectColor(c),m.extend=i,m.destroy=r.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==r.namespaces&&(p=r.namespaces,g=r.enabled(c)),g),set:w=>{h=w}}),typeof r.init=="function"&&r.init(m),m}s(r,"createDebug");function i(c,d){let h=r(this.namespace+(typeof d>"u"?":":d)+c);return h.log=this.log,h}s(i,"extend");function n(c){r.save(c),r.namespaces=c,r.names=[],r.skips=[];let d,h=(typeof c=="string"?c:"").split(/[\s,]+/),p=h.length;for(d=0;d<p;d++)!h[d]||(c=h[d].replace(/\*/g,".*?"),c[0]==="-"?r.skips.push(new RegExp("^"+c.substr(1)+"$")):r.names.push(new RegExp("^"+c+"$")))}s(n,"enable");function o(){let c=[...r.names.map(l),...r.skips.map(l).map(d=>"-"+d)].join(",");return r.enable(""),c}s(o,"disable");function a(c){if(c[c.length-1]==="*")return!0;let d,h;for(d=0,h=r.skips.length;d<h;d++)if(r.skips[d].test(c))return!1;for(d=0,h=r.names.length;d<h;d++)if(r.names[d].test(c))return!0;return!1}s(a,"enabled");function l(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}s(l,"toNamespace");function f(c){return c instanceof Error?c.stack||c.message:c}s(f,"coerce");function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s(u,"destroy"),r.enable(r.load()),r}s(Lp,"setup");Fa.exports=Lp});var Wa=b((ce,li)=>{ce.formatArgs=Dp;ce.save=Up;ce.load=jp;ce.useColors=qp;ce.storage=Fp();ce.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ce.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function qp(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}s(qp,"useColors");function Dp(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+li.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(i=r))}),t.splice(i,0,e)}s(Dp,"formatArgs");ce.log=console.debug||console.log||(()=>{});function Up(t){try{t?ce.storage.setItem("debug",t):ce.storage.removeItem("debug")}catch{}}s(Up,"save");function jp(){let t;try{t=ce.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}s(jp,"load");function Fp(){try{return localStorage}catch{}}s(Fp,"localstorage");li.exports=ns()(ce);var{formatters:Wp}=li.exports;Wp.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Ha=b((aw,Va)=>{"use strict";Va.exports=(t,e=process.argv)=>{let r=t.startsWith("-")?"":t.length===1?"-":"--",i=e.indexOf(r+t),n=e.indexOf("--");return i!==-1&&(n===-1||i<n)}});var za=b((fw,Ga)=>{"use strict";var Vp=S("os"),$a=S("tty"),ye=Ha(),{env:X}=process,Xe;ye("no-color")||ye("no-colors")||ye("color=false")||ye("color=never")?Xe=0:(ye("color")||ye("colors")||ye("color=true")||ye("color=always"))&&(Xe=1);"FORCE_COLOR"in X&&(X.FORCE_COLOR==="true"?Xe=1:X.FORCE_COLOR==="false"?Xe=0:Xe=X.FORCE_COLOR.length===0?1:Math.min(parseInt(X.FORCE_COLOR,10),3));function ss(t){return t===0?!1:{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}s(ss,"translateLevel");function os(t,e){if(Xe===0)return 0;if(ye("color=16m")||ye("color=full")||ye("color=truecolor"))return 3;if(ye("color=256"))return 2;if(t&&!e&&Xe===void 0)return 0;let r=Xe||0;if(X.TERM==="dumb")return r;if(process.platform==="win32"){let i=Vp.release().split(".");return Number(i[0])>=10&&Number(i[2])>=10586?Number(i[2])>=14931?3:2:1}if("CI"in X)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(i=>i in X)||X.CI_NAME==="codeship"?1:r;if("TEAMCITY_VERSION"in X)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(X.TEAMCITY_VERSION)?1:0;if(X.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in X){let i=parseInt((X.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(X.TERM_PROGRAM){case"iTerm.app":return i>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(X.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(X.TERM)||"COLORTERM"in X?1:r}s(os,"supportsColor");function Hp(t){let e=os(t,t&&t.isTTY);return ss(e)}s(Hp,"getSupportLevel");Ga.exports={supportsColor:Hp,stdout:ss(os(!0,$a.isatty(1))),stderr:ss(os(!0,$a.isatty(2)))}});var Ya=b((Z,ci)=>{var $p=S("tty"),ui=S("util");Z.init=Xp;Z.log=Yp;Z.formatArgs=zp;Z.save=Qp;Z.load=Jp;Z.useColors=Gp;Z.destroy=ui.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Z.colors=[6,2,3,4,5,1];try{let t=za();t&&(t.stderr||t).level>=2&&(Z.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Z.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let r=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,o)=>o.toUpperCase()),i=process.env[e];return/^(yes|on|true|enabled)$/i.test(i)?i=!0:/^(no|off|false|disabled)$/i.test(i)?i=!1:i==="null"?i=null:i=Number(i),t[r]=i,t},{});function Gp(){return"colors"in Z.inspectOpts?Boolean(Z.inspectOpts.colors):$p.isatty(process.stderr.fd)}s(Gp,"useColors");function zp(t){let{namespace:e,useColors:r}=this;if(r){let i=this.color,n="\x1B[3"+(i<8?i:"8;5;"+i),o=`  ${n};1m${e} \x1B[0m`;t[0]=o+t[0].split(`
`).join(`
`+o),t.push(n+"m+"+ci.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=Kp()+e+" "+t[0]}s(zp,"formatArgs");function Kp(){return Z.inspectOpts.hideDate?"":new Date().toISOString()+" "}s(Kp,"getDate");function Yp(...t){return process.stderr.write(ui.format(...t)+`
`)}s(Yp,"log");function Qp(t){t?process.env.DEBUG=t:delete process.env.DEBUG}s(Qp,"save");function Jp(){return process.env.DEBUG}s(Jp,"load");function Xp(t){t.inspectOpts={};let e=Object.keys(Z.inspectOpts);for(let r=0;r<e.length;r++)t.inspectOpts[e[r]]=Z.inspectOpts[e[r]]}s(Xp,"init");ci.exports=ns()(Z);var{formatters:Ka}=ci.exports;Ka.o=function(t){return this.inspectOpts.colors=this.useColors,ui.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Ka.O=function(t){return this.inspectOpts.colors=this.useColors,ui.inspect(t,this.inspectOpts)}});var Ze=b((lw,as)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?as.exports=Wa():as.exports=Ya()});var Xa=b((uw,Ja)=>{var Zp=Ma(),e_=S("events"),Qa=qa(),V=is(),R=Ze()("mqtt-packet:parser"),_t=class extends e_{constructor(){super(),this.parser=this.constructor.parser}static parser(e){return this instanceof _t?(this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new _t().parser(e)}_resetState(){R("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new Qa,this.error=null,this._list=Zp(),this._stateCounter=0}parse(e){for(this.error&&this._resetState(),this._list.append(e),R("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,R("parse: state complete. _stateCounter is now: %d",this._stateCounter),R("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return R("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let e=this._list.readUInt8(0);return this.packet.cmd=V.types[e>>V.CMD_SHIFT],this.packet.retain=(e&V.RETAIN_MASK)!==0,this.packet.qos=e>>V.QOS_SHIFT&V.QOS_MASK,this.packet.dup=(e&V.DUP_MASK)!==0,R("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0}_parseLength(){let e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),R("_parseLength %d",e.value),!!e}_parsePayload(){R("_parsePayload: payload %O",this._list);let e=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return R("_parsePayload complete result: %s",e),e}_parseConnect(){R("_parseConnect");let e,r,i,n,o={},a=this.packet,l=this._parseString();if(l===null)return this._emitError(new Error("Cannot parse protocolId"));if(l!=="MQTT"&&l!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(a.protocolId=l,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(a.protocolVersion=this._list.readUInt8(this._pos),a.protocolVersion>=128&&(a.bridgeMode=!0,a.protocolVersion=a.protocolVersion-128),a.protocolVersion!==3&&a.protocolVersion!==4&&a.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(o.username=this._list.readUInt8(this._pos)&V.USERNAME_MASK,o.password=this._list.readUInt8(this._pos)&V.PASSWORD_MASK,o.will=this._list.readUInt8(this._pos)&V.WILL_FLAG_MASK,o.will&&(a.will={},a.will.retain=(this._list.readUInt8(this._pos)&V.WILL_RETAIN_MASK)!==0,a.will.qos=(this._list.readUInt8(this._pos)&V.WILL_QOS_MASK)>>V.WILL_QOS_SHIFT),a.clean=(this._list.readUInt8(this._pos)&V.CLEAN_SESSION_MASK)!==0,this._pos++,a.keepalive=this._parseNum(),a.keepalive===-1)return this._emitError(new Error("Packet too short"));if(a.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(a.properties=u)}let f=this._parseString();if(f===null)return this._emitError(new Error("Packet too short"));if(a.clientId=f,R("_parseConnect: packet.clientId: %s",a.clientId),o.will){if(a.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(a.will.properties=u)}if(e=this._parseString(),e===null)return this._emitError(new Error("Cannot parse will topic"));if(a.will.topic=e,R("_parseConnect: packet.will.topic: %s",a.will.topic),r=this._parseBuffer(),r===null)return this._emitError(new Error("Cannot parse will payload"));a.will.payload=r,R("_parseConnect: packet.will.paylaod: %s",a.will.payload)}if(o.username){if(n=this._parseString(),n===null)return this._emitError(new Error("Cannot parse username"));a.username=n,R("_parseConnect: packet.username: %s",a.username)}if(o.password){if(i=this._parseBuffer(),i===null)return this._emitError(new Error("Cannot parse password"));a.password=i}return this.settings=a,R("_parseConnect: complete"),a}_parseConnack(){R("_parseConnack");let e=this.packet;if(this._list.length<1)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&V.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?e.reasonCode=this._list.readUInt8(this._pos++):e.reasonCode=0;else{if(this._list.length<2)return null;e.returnCode=this._list.readUInt8(this._pos++)}if(e.returnCode===-1||e.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}R("_parseConnack: complete")}_parsePublish(){R("_parsePublish");let e=this.packet;if(e.topic=this._parseString(),e.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(e.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}e.payload=this._list.slice(this._pos,e.length),R("_parsePublish: payload from buffer list: %o",e.payload)}}_parseSubscribe(){R("_parseSubscribe");let e=this.packet,r,i,n,o,a,l,f;if(e.qos!==1)return this._emitError(new Error("Wrong subscribe header"));if(e.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(e.properties=u)}for(;this._pos<e.length;){if(r=this._parseString(),r===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=e.length)return this._emitError(new Error("Malformed Subscribe Payload"));i=this._parseByte(),n=i&V.SUBSCRIBE_OPTIONS_QOS_MASK,l=(i>>V.SUBSCRIBE_OPTIONS_NL_SHIFT&V.SUBSCRIBE_OPTIONS_NL_MASK)!==0,a=(i>>V.SUBSCRIBE_OPTIONS_RAP_SHIFT&V.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,o=i>>V.SUBSCRIBE_OPTIONS_RH_SHIFT&V.SUBSCRIBE_OPTIONS_RH_MASK,f={topic:r,qos:n},this.settings.protocolVersion===5?(f.nl=l,f.rap=a,f.rh=o):this.settings.bridgeMode&&(f.rh=0,f.rap=!0,f.nl=!0),R("_parseSubscribe: push subscription `%s` to subscription",f),e.subscriptions.push(f)}}}_parseSuback(){R("_parseSuback");let e=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseUnsubscribe(){R("_parseUnsubscribe");let e=this.packet;if(e.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}for(;this._pos<e.length;){let r=this._parseString();if(r===null)return this._emitError(new Error("Cannot parse topic"));R("_parseUnsubscribe: push topic `%s` to unsubscriptions",r),e.unsubscriptions.push(r)}}}_parseUnsuback(){R("_parseUnsuback");let e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(this.settings.protocolVersion===5){let r=this._parseProperties();for(Object.getOwnPropertyNames(r).length&&(e.properties=r),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}}_parseConfirmation(){R("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let e=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5&&(e.length>2?(e.reasonCode=this._parseByte(),R("_parseConfirmation: packet.reasonCode `%d`",e.reasonCode)):e.reasonCode=0,e.length>3)){let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}return!0}_parseDisconnect(){let e=this.packet;if(R("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?e.reasonCode=this._parseByte():e.reasonCode=0;let r=this._parseProperties();Object.getOwnPropertyNames(r).length&&(e.properties=r)}return R("_parseDisconnect result: true"),!0}_parseAuth(){R("_parseAuth");let e=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();let r=this._parseProperties();return Object.getOwnPropertyNames(r).length&&(e.properties=r),R("_parseAuth: result: true"),!0}_parseMessageId(){let e=this.packet;return e.messageId=this._parseNum(),e.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(R("_parseMessageId: packet.messageId %d",e.messageId),!0)}_parseString(e){let r=this._parseNum(),i=r+this._pos;if(r===-1||i>this._list.length||i>this.packet.length)return null;let n=this._list.toString("utf8",this._pos,i);return this._pos+=r,R("_parseString: result: %s",n),n}_parseStringPair(){return R("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let e=this._parseNum(),r=e+this._pos;if(e===-1||r>this._list.length||r>this.packet.length)return null;let i=this._list.slice(this._pos,r);return this._pos+=e,R("_parseBuffer: result: %o",i),i}_parseNum(){if(this._list.length-this._pos<2)return-1;let e=this._list.readUInt16BE(this._pos);return this._pos+=2,R("_parseNum: result: %s",e),e}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let e=this._list.readUInt32BE(this._pos);return this._pos+=4,R("_parse4ByteNum: result: %s",e),e}_parseVarByteNum(e){R("_parseVarByteNum");let r=4,i=0,n=1,o=0,a=!1,l,f=this._pos?this._pos:0;for(;i<r&&f+i<this._list.length;){if(l=this._list.readUInt8(f+i++),o+=n*(l&V.VARBYTEINT_MASK),n*=128,(l&V.VARBYTEINT_FIN_MASK)===0){a=!0;break}if(this._list.length<=i)break}return!a&&i===r&&this._list.length>=i&&this._emitError(new Error("Invalid variable byte integer")),f&&(this._pos+=i),a=a?e?{bytes:i,value:o}:o:!1,R("_parseVarByteNum: result: %o",a),a}_parseByte(){let e;return this._pos<this._list.length&&(e=this._list.readUInt8(this._pos),this._pos++),R("_parseByte: result: %o",e),e}_parseByType(e){switch(R("_parseByType: type: %s",e),e){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){R("_parseProperties");let e=this._parseVarByteNum(),i=this._pos+e,n={};for(;this._pos<i;){let o=this._parseByte();if(!o)return this._emitError(new Error("Cannot parse property code type")),!1;let a=V.propertiesCodes[o];if(!a)return this._emitError(new Error("Unknown property")),!1;if(a==="userProperties"){n[a]||(n[a]=Object.create(null));let l=this._parseByType(V.propertiesTypes[a]);if(n[a][l.name])if(Array.isArray(n[a][l.name]))n[a][l.name].push(l.value);else{let f=n[a][l.name];n[a][l.name]=[f],n[a][l.name].push(l.value)}else n[a][l.name]=l.value;continue}n[a]?Array.isArray(n[a])?n[a].push(this._parseByType(V.propertiesTypes[a])):(n[a]=[n[a]],n[a].push(this._parseByType(V.propertiesTypes[a]))):n[a]=this._parseByType(V.propertiesTypes[a])}return n}_newPacket(){return R("_newPacket"),this.packet&&(this._list.consume(this.packet.length),R("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),R("_newPacket: new packet"),this.packet=new Qa,this._pos=0,!0}_emitError(e){R("_emitError"),this.error=e,this.emit("error",e)}};s(_t,"Parser");Ja.exports=_t});var rf=b((cw,tf)=>{var Za={},t_=Buffer.isBuffer(Buffer.from([1,2]).subarray(0,1));function ef(t){let e=Buffer.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(t&255,0+1),e}s(ef,"generateBuffer");function r_(){for(let t=0;t<65536;t++)Za[t]=ef(t)}s(r_,"generateCache");function i_(t){let r=0,i=0,n=Buffer.allocUnsafe(4);do r=t%128|0,t=t/128|0,t>0&&(r=r|128),n.writeUInt8(r,i++);while(t>0&&i<4);return t>0&&(i=0),t_?n.subarray(0,i):n.slice(0,i)}s(i_,"genBufVariableByteInt");function n_(t){let e=Buffer.allocUnsafe(4);return e.writeUInt32BE(t,0),e}s(n_,"generate4ByteBuffer");tf.exports={cache:Za,generateCache:r_,generateNumber:ef,genBufVariableByteInt:i_,generate4ByteBuffer:n_}});var Mt=b((hw,fs)=>{"use strict";typeof process>"u"||!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?fs.exports={nextTick:s_}:fs.exports=process;function s_(t,e,r,i){if(typeof t!="function")throw new TypeError('"callback" argument must be a function');var n=arguments.length,o,a;switch(n){case 0:case 1:return process.nextTick(t);case 2:return process.nextTick(s(function(){t.call(null,e)},"afterTickOne"));case 3:return process.nextTick(s(function(){t.call(null,e,r)},"afterTickTwo"));case 4:return process.nextTick(s(function(){t.call(null,e,r,i)},"afterTickThree"));default:for(o=new Array(n-1),a=0;a<o.length;)o[a++]=arguments[a];return process.nextTick(s(function(){t.apply(null,o)},"afterTick"))}}s(s_,"nextTick")});var cs=b((dw,cf)=>{var k=is(),o_=Buffer.allocUnsafe(0),a_=Buffer.from([0]),sr=rf(),f_=Mt().nextTick,be=Ze()("mqtt-packet:writeToStream"),hi=sr.cache,l_=sr.generateNumber,u_=sr.generateCache,ls=sr.genBufVariableByteInt,c_=sr.generate4ByteBuffer,ae=us,di=!0;function lf(t,e,r){switch(be("generate called"),e.cork&&(e.cork(),f_(h_,e)),di&&(di=!1,u_()),be("generate: packet.cmd: %s",t.cmd),t.cmd){case"connect":return d_(t,e,r);case"connack":return p_(t,e,r);case"publish":return __(t,e,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return g_(t,e,r);case"subscribe":return y_(t,e,r);case"suback":return b_(t,e,r);case"unsubscribe":return v_(t,e,r);case"unsuback":return m_(t,e,r);case"pingreq":case"pingresp":return w_(t,e,r);case"disconnect":return S_(t,e,r);case"auth":return E_(t,e,r);default:return e.emit("error",new Error("Unknown command")),!1}}s(lf,"generate");Object.defineProperty(lf,"cacheNumbers",{get(){return ae===us},set(t){t?((!hi||Object.keys(hi).length===0)&&(di=!0),ae=us):(di=!1,ae=x_)}});function h_(t){t.uncork()}s(h_,"uncork");function d_(t,e,r){let i=t||{},n=i.protocolId||"MQTT",o=i.protocolVersion||4,a=i.will,l=i.clean,f=i.keepalive||0,u=i.clientId||"",c=i.username,d=i.password,h=i.properties;l===void 0&&(l=!0);let p=0;if(!n||typeof n!="string"&&!Buffer.isBuffer(n))return e.emit("error",new Error("Invalid protocolId")),!1;if(p+=n.length+2,o!==3&&o!==4&&o!==5)return e.emit("error",new Error("Invalid protocol version")),!1;if(p+=1,(typeof u=="string"||Buffer.isBuffer(u))&&(u||o>=4)&&(u||l))p+=Buffer.byteLength(u)+2;else{if(o<4)return e.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(l*1===0)return e.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof f!="number"||f<0||f>65535||f%1!==0)return e.emit("error",new Error("Invalid keepalive")),!1;if(p+=2,p+=1,o===5){var g=et(e,h);if(!g)return!1;p+=g.length}if(a){if(typeof a!="object")return e.emit("error",new Error("Invalid will")),!1;if(!a.topic||typeof a.topic!="string")return e.emit("error",new Error("Invalid will topic")),!1;if(p+=Buffer.byteLength(a.topic)+2,p+=2,a.payload)if(a.payload.length>=0)typeof a.payload=="string"?p+=Buffer.byteLength(a.payload):p+=a.payload.length;else return e.emit("error",new Error("Invalid will payload")),!1;var m={};if(o===5){if(m=et(e,a.properties),!m)return!1;p+=m.length}}let w=!1;if(c!=null)if(ff(c))w=!0,p+=Buffer.byteLength(c)+2;else return e.emit("error",new Error("Invalid username")),!1;if(d!=null){if(!w)return e.emit("error",new Error("Username is required to use password")),!1;if(ff(d))p+=uf(d)+2;else return e.emit("error",new Error("Invalid password")),!1}e.write(k.CONNECT_HEADER),ve(e,p),Lt(e,n),i.bridgeMode&&(o+=128),e.write(o===131?k.VERSION131:o===132?k.VERSION132:o===4?k.VERSION4:o===5?k.VERSION5:k.VERSION3);let _=0;return _|=c!=null?k.USERNAME_MASK:0,_|=d!=null?k.PASSWORD_MASK:0,_|=a&&a.retain?k.WILL_RETAIN_MASK:0,_|=a&&a.qos?a.qos<<k.WILL_QOS_SHIFT:0,_|=a?k.WILL_FLAG_MASK:0,_|=l?k.CLEAN_SESSION_MASK:0,e.write(Buffer.from([_])),ae(e,f),o===5&&g.write(),Lt(e,u),a&&(o===5&&m.write(),gt(e,a.topic),Lt(e,a.payload)),c!=null&&Lt(e,c),d!=null&&Lt(e,d),!0}s(d_,"connect");function p_(t,e,r){let i=r?r.protocolVersion:4,n=t||{},o=i===5?n.reasonCode:n.returnCode,a=n.properties,l=2;if(typeof o!="number")return e.emit("error",new Error("Invalid return code")),!1;let f=null;if(i===5){if(f=et(e,a),!f)return!1;l+=f.length}return e.write(k.CONNACK_HEADER),ve(e,l),e.write(n.sessionPresent?k.SESSIONPRESENT_HEADER:a_),e.write(Buffer.from([o])),f?.write(),!0}s(p_,"connack");function __(t,e,r){be("publish: packet: %o",t);let i=r?r.protocolVersion:4,n=t||{},o=n.qos||0,a=n.retain?k.RETAIN_MASK:0,l=n.topic,f=n.payload||o_,u=n.messageId,c=n.properties,d=0;if(typeof l=="string")d+=Buffer.byteLength(l)+2;else if(Buffer.isBuffer(l))d+=l.length+2;else return e.emit("error",new Error("Invalid topic")),!1;if(Buffer.isBuffer(f)?d+=f.length:d+=Buffer.byteLength(f),o&&typeof u!="number")return e.emit("error",new Error("Invalid messageId")),!1;o&&(d+=2);let h=null;if(i===5){if(h=et(e,c),!h)return!1;d+=h.length}return e.write(k.PUBLISH_HEADER[o][n.dup?1:0][a?1:0]),ve(e,d),ae(e,uf(l)),e.write(l),o>0&&ae(e,u),h?.write(),be("publish: payload: %o",f),e.write(f)}s(__,"publish");function g_(t,e,r){let i=r?r.protocolVersion:4,n=t||{},o=n.cmd||"puback",a=n.messageId,l=n.dup&&o==="pubrel"?k.DUP_MASK:0,f=0,u=n.reasonCode,c=n.properties,d=i===5?3:2;if(o==="pubrel"&&(f=1),typeof a!="number")return e.emit("error",new Error("Invalid messageId")),!1;let h=null;if(i===5&&typeof c=="object"){if(h=or(e,c,r,d),!h)return!1;d+=h.length}return e.write(k.ACKS[o][f][l][0]),ve(e,d),ae(e,a),i===5&&e.write(Buffer.from([u])),h!==null&&h.write(),!0}s(g_,"confirmation");function y_(t,e,r){be("subscribe: packet: ");let i=r?r.protocolVersion:4,n=t||{},o=n.dup?k.DUP_MASK:0,a=n.messageId,l=n.subscriptions,f=n.properties,u=0;if(typeof a!="number")return e.emit("error",new Error("Invalid messageId")),!1;u+=2;let c=null;if(i===5){if(c=et(e,f),!c)return!1;u+=c.length}if(typeof l=="object"&&l.length)for(let h=0;h<l.length;h+=1){let p=l[h].topic,g=l[h].qos;if(typeof p!="string")return e.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if(typeof g!="number")return e.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(i===5){if(typeof(l[h].nl||!1)!="boolean")return e.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(l[h].rap||!1)!="boolean")return e.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;let _=l[h].rh||0;if(typeof _!="number"||_>2)return e.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}u+=Buffer.byteLength(p)+2+1}else return e.emit("error",new Error("Invalid subscriptions")),!1;be("subscribe: writing to stream: %o",k.SUBSCRIBE_HEADER),e.write(k.SUBSCRIBE_HEADER[1][o?1:0][0]),ve(e,u),ae(e,a),c!==null&&c.write();let d=!0;for(let h of l){let p=h.topic,g=h.qos,m=+h.nl,w=+h.rap,_=h.rh,y;gt(e,p),y=k.SUBSCRIBE_OPTIONS_QOS[g],i===5&&(y|=m?k.SUBSCRIBE_OPTIONS_NL:0,y|=w?k.SUBSCRIBE_OPTIONS_RAP:0,y|=_?k.SUBSCRIBE_OPTIONS_RH[_]:0),d=e.write(Buffer.from([y]))}return d}s(y_,"subscribe");function b_(t,e,r){let i=r?r.protocolVersion:4,n=t||{},o=n.messageId,a=n.granted,l=n.properties,f=0;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(f+=2,typeof a=="object"&&a.length)for(let c=0;c<a.length;c+=1){if(typeof a[c]!="number")return e.emit("error",new Error("Invalid qos vector")),!1;f+=1}else return e.emit("error",new Error("Invalid qos vector")),!1;let u=null;if(i===5){if(u=or(e,l,r,f),!u)return!1;f+=u.length}return e.write(k.SUBACK_HEADER),ve(e,f),ae(e,o),u!==null&&u.write(),e.write(Buffer.from(a))}s(b_,"suback");function v_(t,e,r){let i=r?r.protocolVersion:4,n=t||{},o=n.messageId,a=n.dup?k.DUP_MASK:0,l=n.unsubscriptions,f=n.properties,u=0;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(u+=2,typeof l=="object"&&l.length)for(let h=0;h<l.length;h+=1){if(typeof l[h]!="string")return e.emit("error",new Error("Invalid unsubscriptions")),!1;u+=Buffer.byteLength(l[h])+2}else return e.emit("error",new Error("Invalid unsubscriptions")),!1;let c=null;if(i===5){if(c=et(e,f),!c)return!1;u+=c.length}e.write(k.UNSUBSCRIBE_HEADER[1][a?1:0][0]),ve(e,u),ae(e,o),c!==null&&c.write();let d=!0;for(let h=0;h<l.length;h++)d=gt(e,l[h]);return d}s(v_,"unsubscribe");function m_(t,e,r){let i=r?r.protocolVersion:4,n=t||{},o=n.messageId,a=n.dup?k.DUP_MASK:0,l=n.granted,f=n.properties,u=n.cmd,c=0,d=2;if(typeof o!="number")return e.emit("error",new Error("Invalid messageId")),!1;if(i===5)if(typeof l=="object"&&l.length)for(let p=0;p<l.length;p+=1){if(typeof l[p]!="number")return e.emit("error",new Error("Invalid qos vector")),!1;d+=1}else return e.emit("error",new Error("Invalid qos vector")),!1;let h=null;if(i===5){if(h=or(e,f,r,d),!h)return!1;d+=h.length}return e.write(k.ACKS[u][c][a][0]),ve(e,d),ae(e,o),h!==null&&h.write(),i===5&&e.write(Buffer.from(l)),!0}s(m_,"unsuback");function w_(t,e,r){return e.write(k.EMPTY[t.cmd])}s(w_,"emptyPacket");function S_(t,e,r){let i=r?r.protocolVersion:4,n=t||{},o=n.reasonCode,a=n.properties,l=i===5?1:0,f=null;if(i===5){if(f=or(e,a,r,l),!f)return!1;l+=f.length}return e.write(Buffer.from([k.codes.disconnect<<4])),ve(e,l),i===5&&e.write(Buffer.from([o])),f!==null&&f.write(),!0}s(S_,"disconnect");function E_(t,e,r){let i=r?r.protocolVersion:4,n=t||{},o=n.reasonCode,a=n.properties,l=i===5?1:0;i!==5&&e.emit("error",new Error("Invalid mqtt version for auth packet"));let f=or(e,a,r,l);return f?(l+=f.length,e.write(Buffer.from([k.codes.auth<<4])),ve(e,l),e.write(Buffer.from([o])),f!==null&&f.write(),!0):!1}s(E_,"auth");var nf={};function ve(t,e){if(e>k.VARBYTEINT_MAX)return t.emit("error",new Error(`Invalid variable byte integer: ${e}`)),!1;let r=nf[e];return r||(r=ls(e),e<16384&&(nf[e]=r)),be("writeVarByteInt: writing to stream: %o",r),t.write(r)}s(ve,"writeVarByteInt");function gt(t,e){let r=Buffer.byteLength(e);return ae(t,r),be("writeString: %s",e),t.write(e,"utf8")}s(gt,"writeString");function sf(t,e,r){gt(t,e),gt(t,r)}s(sf,"writeStringPair");function us(t,e){return be("writeNumberCached: number: %d",e),be("writeNumberCached: %o",hi[e]),t.write(hi[e])}s(us,"writeNumberCached");function x_(t,e){let r=l_(e);return be("writeNumberGenerated: %o",r),t.write(r)}s(x_,"writeNumberGenerated");function C_(t,e){let r=c_(e);return be("write4ByteNumber: %o",r),t.write(r)}s(C_,"write4ByteNumber");function Lt(t,e){typeof e=="string"?gt(t,e):e?(ae(t,e.length),t.write(e)):ae(t,0)}s(Lt,"writeStringOrBuffer");function et(t,e){if(typeof e!="object"||e.length!=null)return{length:1,write(){af(t,{},0)}};let r=0;function i(o,a){let l=k.propertiesTypes[o],f=0;switch(l){case"byte":{if(typeof a!="boolean")return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=1+1;break}case"int8":{if(typeof a!="number"||a<0||a>255)return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=1+1;break}case"binary":{if(a&&a===null)return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=1+Buffer.byteLength(a)+2;break}case"int16":{if(typeof a!="number"||a<0||a>65535)return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=1+2;break}case"int32":{if(typeof a!="number"||a<0||a>4294967295)return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=1+4;break}case"var":{if(typeof a!="number"||a<0||a>268435455)return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=1+Buffer.byteLength(ls(a));break}case"string":{if(typeof a!="string")return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=1+2+Buffer.byteLength(a.toString());break}case"pair":{if(typeof a!="object")return t.emit("error",new Error(`Invalid ${o}: ${a}`)),!1;f+=Object.getOwnPropertyNames(a).reduce((u,c)=>{let d=a[c];return Array.isArray(d)?u+=d.reduce((h,p)=>(h+=1+2+Buffer.byteLength(c.toString())+2+Buffer.byteLength(p.toString()),h),0):u+=1+2+Buffer.byteLength(c.toString())+2+Buffer.byteLength(a[c].toString()),u},0);break}default:return t.emit("error",new Error(`Invalid property ${o}: ${a}`)),!1}return f}if(s(i,"getLengthProperty"),e)for(let o in e){let a=0,l=0,f=e[o];if(Array.isArray(f))for(let u=0;u<f.length;u++){if(l=i(o,f[u]),!l)return!1;a+=l}else{if(l=i(o,f),!l)return!1;a=l}if(!a)return!1;r+=a}return{length:Buffer.byteLength(ls(r))+r,write(){af(t,e,r)}}}s(et,"getProperties");function or(t,e,r,i){let n=["reasonString","userProperties"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,a=et(t,e);if(o)for(;i+a.length>o;){let l=n.shift();if(l&&e[l])delete e[l],a=et(t,e);else return!1}return a}s(or,"getPropertiesByMaximumPacketSize");function of(t,e,r){switch(k.propertiesTypes[e]){case"byte":{t.write(Buffer.from([k.properties[e]])),t.write(Buffer.from([+r]));break}case"int8":{t.write(Buffer.from([k.properties[e]])),t.write(Buffer.from([r]));break}case"binary":{t.write(Buffer.from([k.properties[e]])),Lt(t,r);break}case"int16":{t.write(Buffer.from([k.properties[e]])),ae(t,r);break}case"int32":{t.write(Buffer.from([k.properties[e]])),C_(t,r);break}case"var":{t.write(Buffer.from([k.properties[e]])),ve(t,r);break}case"string":{t.write(Buffer.from([k.properties[e]])),gt(t,r);break}case"pair":{Object.getOwnPropertyNames(r).forEach(n=>{let o=r[n];Array.isArray(o)?o.forEach(a=>{t.write(Buffer.from([k.properties[e]])),sf(t,n.toString(),a.toString())}):(t.write(Buffer.from([k.properties[e]])),sf(t,n.toString(),o.toString()))});break}default:return t.emit("error",new Error(`Invalid property ${e} value: ${r}`)),!1}}s(of,"writeProperty");function af(t,e,r){ve(t,r);for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==null){let n=e[i];if(Array.isArray(n))for(let o=0;o<n.length;o++)of(t,i,n[o]);else of(t,i,n)}}s(af,"writeProperties");function uf(t){return t?t instanceof Buffer?t.length:Buffer.byteLength(t):0}s(uf,"byteLength");function ff(t){return typeof t=="string"||t instanceof Buffer}s(ff,"isStringOrBuffer");cf.exports=lf});var df=b((pw,hf)=>{var T_=cs(),I_=S("events");function O_(t,e){let r=new pi;return T_(t,r,e),r.concat()}s(O_,"generate");var pi=class extends I_{constructor(){super(),this._array=new Array(20),this._i=0}write(e){return this._array[this._i++]=e,!0}concat(){let e=0,r=new Array(this._array.length),i=this._array,n=0,o;for(o=0;o<i.length&&i[o]!==void 0;o++)typeof i[o]!="string"?r[o]=i[o].length:r[o]=Buffer.byteLength(i[o]),e+=r[o];let a=Buffer.allocUnsafe(e);for(o=0;o<i.length&&i[o]!==void 0;o++)typeof i[o]!="string"?(i[o].copy(a,n),n+=r[o]):(a.write(i[o],n),n+=r[o]);return a}};s(pi,"Accumulator");hf.exports=O_});var pf=b(_i=>{_i.parser=Xa().parser;_i.generate=df();_i.writeToStream=cs()});var gf=b((gw,_f)=>{"use strict";function R_(t,e,r){var i=this;this._callback=t,this._args=r,this._interval=setInterval(t,e,this._args),this.reschedule=function(n){n||(n=i._interval),i._interval&&clearInterval(i._interval),i._interval=setInterval(i._callback,n,i._args)},this.clear=function(){i._interval&&(clearInterval(i._interval),i._interval=void 0)},this.destroy=function(){i._interval&&clearInterval(i._interval),i._callback=void 0,i._interval=void 0,i._args=void 0}}s(R_,"ReInterval");function A_(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("interval needed");var t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new R_(arguments[0],arguments[1],t)}s(A_,"reInterval");_f.exports=A_});var bf=b((yw,yf)=>{"use strict";function k_(t){for(var e=t.split("/"),r=0;r<e.length;r++)if(e[r]!=="+"){if(e[r]==="#")return r===e.length-1;if(e[r].indexOf("+")!==-1||e[r].indexOf("#")!==-1)return!1}return!0}s(k_,"validateTopic");function B_(t){if(t.length===0)return"empty_topic_list";for(var e=0;e<t.length;e++)if(!k_(t[e]))return t[e];return null}s(B_,"validateTopics");yf.exports={validateTopics:B_}});var ps=b((bw,xf)=>{"use strict";var wf=S("events").EventEmitter,gi=si(),Sf=pf(),P_=Ye().Writable,N_=oe(),M_=gf(),L_=bf(),yi=Vr(),v=Ze()("mqttjs:client"),ds=process?process.nextTick:function(t){setTimeout(t,0)},Ef=global.setImmediate||function(t){ds(t)},vf={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0},q_=["ECONNREFUSED","EADDRINUSE","ECONNRESET","ENOTFOUND"],hs={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function D_(){return"mqttjs_"+Math.random().toString(16).substr(2,8)}s(D_,"defaultId");function ar(t,e,r){v("sendPacket :: packet: %O",e),v("sendPacket :: emitting `packetsend`"),t.emit("packetsend",e),v("sendPacket :: writing to stream");var i=Sf.writeToStream(e,t.stream,t.options);v("sendPacket :: writeToStream result %s",i),!i&&r?(v("sendPacket :: handle events on `drain` once through callback."),t.stream.once("drain",r)):r&&(v("sendPacket :: invoking cb"),r())}s(ar,"sendPacket");function U_(t){t&&(v("flush: queue exists? %b",!!t),Object.keys(t).forEach(function(e){typeof t[e].cb=="function"&&(t[e].cb(new Error("Connection closed")),delete t[e])}))}s(U_,"flush");function j_(t){t&&(v("flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(t).forEach(function(e){t[e].volatile&&typeof t[e].cb=="function"&&(t[e].cb(new Error("Connection closed")),delete t[e])}))}s(j_,"flushVolatile");function mf(t,e,r,i){v("storeAndSend :: store packet with cmd %s to outgoingStore",e.cmd),t.outgoingStore.put(e,s(function(o){if(o)return r&&r(o);i(),ar(t,e,r)},"storedPacket"))}s(mf,"storeAndSend");function fe(t){v("nop ::",t)}s(fe,"nop");function q(t,e){var r,i=this;if(!(this instanceof q))return new q(t,e);this.options=e||{};for(r in vf)typeof this.options[r]>"u"?this.options[r]=vf[r]:this.options[r]=e[r];v("MqttClient :: options.protocol",e.protocol),v("MqttClient :: options.protocolVersion",e.protocolVersion),v("MqttClient :: options.username",e.username),v("MqttClient :: options.keepalive",e.keepalive),v("MqttClient :: options.reconnectPeriod",e.reconnectPeriod),v("MqttClient :: options.rejectUnauthorized",e.rejectUnauthorized),this.options.clientId=typeof e.clientId=="string"?e.clientId:D_(),v("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=e.protocolVersion===5&&e.customHandleAcks?e.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=t,this.outgoingStore=e.outgoingStore||new gi,this.incomingStore=e.incomingStore||new gi,this.queueQoSZero=e.queueQoSZero===void 0?!0:e.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(Math.random()*65535)),this.outgoing={},this._firstConnection=!0,this.on("connect",function(){var n=this.queue;function o(){var a=n.shift();v("deliver :: entry %o",a);var l=null;!a||(l=a.packet,v("deliver :: call _sendPacket for %o",l),i._sendPacket(l,function(f){a.cb&&a.cb(f),o()}))}s(o,"deliver"),v("connect :: sending queued packets"),o()}),this.on("close",function(){v("close :: connected set to `false`"),this.connected=!1,v("close :: clearing connackTimer"),clearTimeout(this.connackTimer),v("close :: clearing ping timer"),i.pingTimer!==null&&(i.pingTimer.clear(),i.pingTimer=null),v("close :: calling _setupReconnect"),this._setupReconnect()}),wf.call(this),v("MqttClient :: setting up stream"),this._setupStream()}s(q,"MqttClient");N_(q,wf);q.prototype._setupStream=function(){var t,e=this,r=new P_,i=Sf.parser(this.options),n=null,o=[];v("_setupStream :: calling method to clear reconnect"),this._clearReconnect(),v("_setupStream :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),i.on("packet",function(c){v("parser :: on packet push to packets array."),o.push(c)});function a(){if(o.length)ds(l);else{var c=n;n=null,c()}}s(a,"nextTickWork");function l(){v("work :: getting next packet in queue");var c=o.shift();if(c)v("work :: packet pulled from queue"),e._handlePacket(c,a);else{v("work :: no packets in queue");var d=n;n=null,v("work :: done flag is %s",!!d),d&&d()}}s(l,"work"),r._write=function(c,d,h){n=h,v("writable stream :: parsing buffer"),i.parse(c),l()};function f(c){v("streamErrorHandler :: error",c.message),q_.includes(c.code)?(v("streamErrorHandler :: emitting error"),e.emit("error",c)):fe(c)}if(s(f,"streamErrorHandler"),v("_setupStream :: pipe stream to writable stream"),this.stream.pipe(r),this.stream.on("error",f),this.stream.on("close",function(){v("(%s)stream :: on close",e.options.clientId),j_(e.outgoing),v("stream: emit close to MqttClient"),e.emit("close")}),v("_setupStream: sending packet `connect`"),t=Object.create(this.options),t.cmd="connect",ar(this,t),i.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return e.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){var u=yi({cmd:"auth",reasonCode:0},this.options.authPacket);ar(this,u)}}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){v("!!connectTimeout hit!! Calling _cleanUp with force `true`"),e._cleanUp(!0)},this.options.connectTimeout)};q.prototype._handlePacket=function(t,e){var r=this.options;if(r.protocolVersion===5&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<t.length)return this.emit("error",new Error("exceeding packets size "+t.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(v("_handlePacket :: emitting packetreceive"),this.emit("packetreceive",t),t.cmd){case"publish":this._handlePublish(t,e);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(t),e();break;case"pubrel":this._handlePubrel(t,e);break;case"connack":this._handleConnack(t),e();break;case"pingresp":this._handlePingresp(t),e();break;case"disconnect":this._handleDisconnect(t),e();break;default:break}};q.prototype._checkDisconnecting=function(t){return this.disconnecting&&(t?t(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting};q.prototype.publish=function(t,e,r,i){v("publish :: message `%s` to topic `%s`",e,t);var n,o=this.options;typeof r=="function"&&(i=r,r=null);var a={qos:0,retain:!1,dup:!1};if(r=yi(a,r),this._checkDisconnecting(i))return this;switch(n={cmd:"publish",topic:t,payload:e,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},o.protocolVersion===5&&(n.properties=r.properties,(!o.properties&&n.properties&&n.properties.topicAlias||r.properties&&o.properties&&(r.properties.topicAlias&&o.properties.topicAliasMaximum&&r.properties.topicAlias>o.properties.topicAliasMaximum||!o.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete n.properties.topicAlias),v("publish :: qos",r.qos),r.qos){case 1:case 2:this.outgoing[n.messageId]={volatile:!1,cb:i||fe},this._storeProcessing?(v("_storeProcessing enabled"),this._packetIdsDuringStoreProcessing[n.messageId]=!1,this._storePacket(n,void 0,r.cbStorePut)):(v("MqttClient:publish: packet cmd: %s",n.cmd),this._sendPacket(n,void 0,r.cbStorePut));break;default:this._storeProcessing?(v("_storeProcessing enabled"),this._storePacket(n,i,r.cbStorePut)):(v("MqttClient:publish: packet cmd: %s",n.cmd),this._sendPacket(n,i,r.cbStorePut));break}return this};q.prototype.subscribe=function(){for(var t,e=new Array(arguments.length),r=0;r<arguments.length;r++)e[r]=arguments[r];var i=[],n=e.shift(),o=n.resubscribe,a=e.pop()||fe,l=e.pop(),f,u=this,c=this.options.protocolVersion;if(delete n.resubscribe,typeof n=="string"&&(n=[n]),typeof a!="function"&&(l=a,a=fe),f=L_.validateTopics(n),f!==null)return Ef(a,new Error("Invalid topic "+f)),this;if(this._checkDisconnecting(a))return v("subscribe: discconecting true"),this;var d={qos:0};if(c===5&&(d.nl=!1,d.rap=!1,d.rh=0),l=yi(d,l),Array.isArray(n)?n.forEach(function(p){if(v("subscribe: array topic %s",p),!u._resubscribeTopics.hasOwnProperty(p)||u._resubscribeTopics[p].qos<l.qos||o){var g={topic:p,qos:l.qos};c===5&&(g.nl=l.nl,g.rap=l.rap,g.rh=l.rh,g.properties=l.properties),v("subscribe: pushing topic `%s` and qos `%s` to subs list",g.topic,g.qos),i.push(g)}}):Object.keys(n).forEach(function(p){if(v("subscribe: object topic %s",p),!u._resubscribeTopics.hasOwnProperty(p)||u._resubscribeTopics[p].qos<n[p].qos||o){var g={topic:p,qos:n[p].qos};c===5&&(g.nl=n[p].nl,g.rap=n[p].rap,g.rh=n[p].rh,g.properties=l.properties),v("subscribe: pushing `%s` to subs list",g),i.push(g)}}),t={cmd:"subscribe",subscriptions:i,qos:1,retain:!1,dup:!1,messageId:this._nextId()},l.properties&&(t.properties=l.properties),!i.length){a(null,[]);return}if(this.options.resubscribe){v("subscribe :: resubscribe true");var h=[];i.forEach(function(p){if(u.options.reconnectPeriod>0){var g={qos:p.qos};c===5&&(g.nl=p.nl||!1,g.rap=p.rap||!1,g.rh=p.rh||0,g.properties=p.properties),u._resubscribeTopics[p.topic]=g,h.push(p.topic)}}),u.messageIdToTopic[t.messageId]=h}return this.outgoing[t.messageId]={volatile:!0,cb:function(p,g){if(!p)for(var m=g.granted,w=0;w<m.length;w+=1)i[w].qos=m[w];a(p,i)}},v("subscribe :: call _sendPacket"),this._sendPacket(t),this};q.prototype.unsubscribe=function(){for(var t={cmd:"unsubscribe",qos:1,messageId:this._nextId()},e=this,r=new Array(arguments.length),i=0;i<arguments.length;i++)r[i]=arguments[i];var n=r.shift(),o=r.pop()||fe,a=r.pop();return typeof n=="string"&&(n=[n]),typeof o!="function"&&(a=o,o=fe),this._checkDisconnecting(o)?this:(typeof n=="string"?t.unsubscriptions=[n]:Array.isArray(n)&&(t.unsubscriptions=n),this.options.resubscribe&&t.unsubscriptions.forEach(function(l){delete e._resubscribeTopics[l]}),typeof a=="object"&&a.properties&&(t.properties=a.properties),this.outgoing[t.messageId]={volatile:!0,cb:o},v("unsubscribe: call _sendPacket"),this._sendPacket(t),this)};q.prototype.end=function(t,e,r){var i=this;v("end :: (%s)",this.options.clientId),(t==null||typeof t!="boolean")&&(r=e||fe,e=t,t=!1,typeof e!="object"&&(r=e,e=null,typeof r!="function"&&(r=fe))),typeof e!="object"&&(r=e,e=null),v("end :: cb? %s",!!r),r=r||fe;function n(){v("end :: closeStores: closing incoming and outgoing stores"),i.disconnected=!0,i.incomingStore.close(function(a){i.outgoingStore.close(function(l){if(v("end :: closeStores: emitting end"),i.emit("end"),r){let f=a||l;v("end :: closeStores: invoking callback with args"),r(f)}})}),i._deferredReconnect&&i._deferredReconnect()}s(n,"closeStores");function o(){v("end :: (%s) :: finish :: calling _cleanUp with force %s",i.options.clientId,t),i._cleanUp(t,()=>{v("end :: finish :: calling process.nextTick on closeStores"),ds(n.bind(i))},e)}return s(o,"finish"),this.disconnecting?(r(),this):(this._clearReconnect(),this.disconnecting=!0,!t&&Object.keys(this.outgoing).length>0?(v("end :: (%s) :: calling finish in 10ms once outgoing is empty",i.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,o,10))):(v("end :: (%s) :: immediately calling finish",i.options.clientId),o()),this)};q.prototype.removeOutgoingMessage=function(t){var e=this.outgoing[t]?this.outgoing[t].cb:null;return delete this.outgoing[t],this.outgoingStore.del({messageId:t},function(){e(new Error("Message removed"))}),this};q.prototype.reconnect=function(t){v("client reconnect");var e=this,r=s(function(){t?(e.options.incomingStore=t.incomingStore,e.options.outgoingStore=t.outgoingStore):(e.options.incomingStore=null,e.options.outgoingStore=null),e.incomingStore=e.options.incomingStore||new gi,e.outgoingStore=e.options.outgoingStore||new gi,e.disconnecting=!1,e.disconnected=!1,e._deferredReconnect=null,e._reconnect()},"f");return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this};q.prototype._reconnect=function(){v("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this._setupStream()}),v("client already connected. disconnecting first.")):(v("_reconnect: calling _setupStream"),this._setupStream())};q.prototype._setupReconnect=function(){var t=this;!t.disconnecting&&!t.reconnectTimer&&t.options.reconnectPeriod>0?(this.reconnecting||(v("_setupReconnect :: emit `offline` state"),this.emit("offline"),v("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),v("_setupReconnect :: setting reconnectTimer for %d ms",t.options.reconnectPeriod),t.reconnectTimer=setInterval(function(){v("reconnectTimer :: reconnect triggered!"),t._reconnect()},t.options.reconnectPeriod)):v("_setupReconnect :: doing nothing...")};q.prototype._clearReconnect=function(){v("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)};q.prototype._cleanUp=function(t,e){var r=arguments[2];if(e&&(v("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",e)),v("_cleanUp :: forced? %s",t),t)this.options.reconnectPeriod===0&&this.options.clean&&U_(this.outgoing),v("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{var i=yi({cmd:"disconnect"},r);v("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(i,Ef.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(v("_cleanUp :: client not disconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this.pingTimer!==null&&(v("_cleanUp :: clearing pingTimer"),this.pingTimer.clear(),this.pingTimer=null),e&&!this.connected&&(v("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",e),e())};q.prototype._sendPacket=function(t,e,r){if(v("_sendPacket :: (%s) ::  start",this.options.clientId),r=r||fe,!this.connected){v("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(t,e,r);return}switch(this._shiftPingInterval(),t.cmd){case"publish":break;case"pubrel":mf(this,t,e,r);return;default:ar(this,t,e);return}switch(t.qos){case 2:case 1:mf(this,t,e,r);break;case 0:default:ar(this,t,e);break}v("_sendPacket :: (%s) ::  end",this.options.clientId)};q.prototype._storePacket=function(t,e,r){v("_storePacket :: packet: %o",t),v("_storePacket :: cb? %s",!!e),r=r||fe,(t.qos||0)===0&&this.queueQoSZero||t.cmd!=="publish"?this.queue.push({packet:t,cb:e}):t.qos>0?(e=this.outgoing[t.messageId]?this.outgoing[t.messageId].cb:null,this.outgoingStore.put(t,function(i){if(i)return e&&e(i);r()})):e&&e(new Error("No connection to broker"))};q.prototype._setupPingTimer=function(){v("_setupPingTimer :: keepalive %d (seconds)",this.options.keepalive);var t=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=M_(function(){t._checkPing()},this.options.keepalive*1e3))};q.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(this.options.keepalive*1e3)};q.prototype._checkPing=function(){v("_checkPing :: checking ping..."),this.pingResp?(v("_checkPing :: ping response received. Clearing flag and sending `pingreq`"),this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):(v("_checkPing :: calling _cleanUp with force true"),this._cleanUp(!0))};q.prototype._handlePingresp=function(){this.pingResp=!0};q.prototype._handleConnack=function(t){v("_handleConnack");var e=this.options,r=e.protocolVersion,i=r===5?t.reasonCode:t.returnCode;if(clearTimeout(this.connackTimer),t.properties&&(t.properties.topicAliasMaximum&&(e.properties||(e.properties={}),e.properties.topicAliasMaximum=t.properties.topicAliasMaximum),t.properties.serverKeepAlive&&e.keepalive&&(e.keepalive=t.properties.serverKeepAlive,this._shiftPingInterval()),t.properties.maximumPacketSize&&(e.properties||(e.properties={}),e.properties.maximumPacketSize=t.properties.maximumPacketSize)),i===0)this.reconnecting=!1,this._onConnect(t);else if(i>0){var n=new Error("Connection refused: "+hs[i]);n.code=i,this.emit("error",n)}};q.prototype._handlePublish=function(t,e){v("_handlePublish: packet %o",t),e=typeof e<"u"?e:fe;var r=t.topic.toString(),i=t.payload,n=t.qos,o=t.messageId,a=this,l=this.options,f=[0,16,128,131,135,144,145,151,153];switch(v("_handlePublish: qos %d",n),n){case 2:{l.customHandleAcks(r,i,t,function(u,c){if(u instanceof Error||(c=u,u=null),u)return a.emit("error",u);if(f.indexOf(c)===-1)return a.emit("error",new Error("Wrong reason code for pubrec"));c?a._sendPacket({cmd:"pubrec",messageId:o,reasonCode:c},e):a.incomingStore.put(t,function(){a._sendPacket({cmd:"pubrec",messageId:o},e)})});break}case 1:{l.customHandleAcks(r,i,t,function(u,c){if(u instanceof Error||(c=u,u=null),u)return a.emit("error",u);if(f.indexOf(c)===-1)return a.emit("error",new Error("Wrong reason code for puback"));c||a.emit("message",r,i,t),a.handleMessage(t,function(d){if(d)return e&&e(d);a._sendPacket({cmd:"puback",messageId:o,reasonCode:c},e)})});break}case 0:this.emit("message",r,i,t),this.handleMessage(t,e);break;default:v("_handlePublish: unknown QoS. Doing nothing.");break}};q.prototype.handleMessage=function(t,e){e()};q.prototype._handleAck=function(t){var e=t.messageId,r=t.cmd,i=null,n=this.outgoing[e]?this.outgoing[e].cb:null,o=this,a;if(!n){v("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(v("_handleAck :: packet type",r),r){case"pubcomp":case"puback":var l=t.reasonCode;l&&l>0&&l!==16&&(a=new Error("Publish error: "+hs[l]),a.code=l,n(a,t)),delete this.outgoing[e],this.outgoingStore.del(t,n);break;case"pubrec":i={cmd:"pubrel",qos:2,messageId:e};var f=t.reasonCode;f&&f>0&&f!==16?(a=new Error("Publish error: "+hs[f]),a.code=f,n(a,t)):this._sendPacket(i);break;case"suback":delete this.outgoing[e];for(var u=0;u<t.granted.length;u++)if((t.granted[u]&128)!==0){var c=this.messageIdToTopic[e];c&&c.forEach(function(d){delete o._resubscribeTopics[d]})}n(null,t);break;case"unsuback":delete this.outgoing[e],n(null);break;default:o.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&Object.keys(this.outgoing).length===0&&this.emit("outgoingEmpty")};q.prototype._handlePubrel=function(t,e){v("handling pubrel packet"),e=typeof e<"u"?e:fe;var r=t.messageId,i=this,n={cmd:"pubcomp",messageId:r};i.incomingStore.get(t,function(o,a){o?i._sendPacket(n,e):(i.emit("message",a.topic,a.payload,a),i.handleMessage(a,function(l){if(l)return e(l);i.incomingStore.del(a,fe),i._sendPacket(n,e)}))})};q.prototype._handleDisconnect=function(t){this.emit("disconnect",t)};q.prototype._nextId=function(){var t=this.nextId++;return this.nextId===65536&&(this.nextId=1),t};q.prototype.getLastMessageId=function(){return this.nextId===1?65535:this.nextId-1};q.prototype._resubscribe=function(t){v("_resubscribe");var e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion===5&&!t.sessionPresent)&&e.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){v("_resubscribe: protocolVersion 5");for(var r=0;r<e.length;r++){var i={};i[e[r]]=this._resubscribeTopics[e[r]],i.resubscribe=!0,this.subscribe(i,{properties:i[e[r]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1};q.prototype._onConnect=function(t){if(this.disconnected){this.emit("connect",t);return}var e=this;this._setupPingTimer(),this._resubscribe(t),this.connected=!0;function r(){var i=e.outgoingStore.createStream();function n(){e._storeProcessing=!1,e._packetIdsDuringStoreProcessing={}}s(n,"clearStoreProcessing"),e.once("close",o),i.on("error",function(l){n(),e.removeListener("close",o),e.emit("error",l)});function o(){i.destroy(),i=null,n()}s(o,"remove");function a(){if(!!i){e._storeProcessing=!0;var l=i.read(1),f;if(!l){i.once("readable",a);return}if(e._packetIdsDuringStoreProcessing[l.messageId]){a();return}!e.disconnecting&&!e.reconnectTimer?(f=e.outgoing[l.messageId]?e.outgoing[l.messageId].cb:null,e.outgoing[l.messageId]={volatile:!1,cb:function(u,c){f&&f(u,c),a()}},e._packetIdsDuringStoreProcessing[l.messageId]=!0,e._sendPacket(l)):i.destroy&&i.destroy()}}s(a,"storeDeliver"),i.on("end",function(){var l=!0;for(var f in e._packetIdsDuringStoreProcessing)if(!e._packetIdsDuringStoreProcessing[f]){l=!1;break}l?(n(),e.removeListener("close",o),e.emit("connect",t)):r()}),a()}s(r,"startStreamProcess"),r()};xf.exports=q});var _s=b((vw,Cf)=>{"use strict";var F_=S("net"),W_=Ze()("mqttjs:tcp");function V_(t,e){var r,i;return e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost",r=e.port,i=e.hostname,W_("port %d and host %s",r,i),F_.createConnection(r,i)}s(V_,"streamBuilder");Cf.exports=V_});var bi=b((mw,Tf)=>{"use strict";var H_=S("tls"),$_=Ze()("mqttjs:tls");function G_(t,e){var r;e.port=e.port||8883,e.host=e.hostname||e.host||"localhost",e.servername=e.host,e.rejectUnauthorized=e.rejectUnauthorized!==!1,delete e.path,$_("port %d host %s rejectUnauthorized %b",e.port,e.host,e.rejectUnauthorized),r=H_.connect(e),r.on("secureConnect",function(){e.rejectUnauthorized&&!r.authorized?r.emit("error",new Error("TLS not authorized")):r.removeListener("error",i)});function i(n){e.rejectUnauthorized&&t.emit("error",n),r.end()}return s(i,"handleTLSerrors"),r.on("error",i),r}s(G_,"buildBuilder");Tf.exports=G_});var Rf=b((ww,Of)=>{Of.exports=If;function If(t,e){if(t&&e)return If(t)(e);if(typeof t!="function")throw new TypeError("need wrapper function");return Object.keys(t).forEach(function(i){r[i]=t[i]}),r;function r(){for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];var o=t.apply(this,i),a=i[i.length-1];return typeof o=="function"&&o!==a&&Object.keys(a).forEach(function(l){o[l]=a[l]}),o}s(r,"wrapper")}s(If,"wrappy")});var Bf=b((Sw,gs)=>{var Af=Rf();gs.exports=Af(vi);gs.exports.strict=Af(kf);vi.proto=vi(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return vi(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return kf(this)},configurable:!0})});function vi(t){var e=s(function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))},"f");return e.called=!1,e}s(vi,"once");function kf(t){var e=s(function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},"f"),r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}s(kf,"onceStrict")});var ys=b((Ew,Nf)=>{var z_=Bf(),K_=s(function(){},"noop"),Y_=s(function(t){return t.setHeader&&typeof t.abort=="function"},"isRequest"),Q_=s(function(t){return t.stdio&&Array.isArray(t.stdio)&&t.stdio.length===3},"isChildProcess"),Pf=s(function(t,e,r){if(typeof e=="function")return Pf(t,null,e);e||(e={}),r=z_(r||K_);var i=t._writableState,n=t._readableState,o=e.readable||e.readable!==!1&&t.readable,a=e.writable||e.writable!==!1&&t.writable,l=!1,f=s(function(){t.writable||u()},"onlegacyfinish"),u=s(function(){a=!1,o||r.call(t)},"onfinish"),c=s(function(){o=!1,a||r.call(t)},"onend"),d=s(function(w){r.call(t,w?new Error("exited with error code: "+w):null)},"onexit"),h=s(function(w){r.call(t,w)},"onerror"),p=s(function(){process.nextTick(g)},"onclose"),g=s(function(){if(!l){if(o&&!(n&&n.ended&&!n.destroyed))return r.call(t,new Error("premature close"));if(a&&!(i&&i.ended&&!i.destroyed))return r.call(t,new Error("premature close"))}},"onclosenexttick"),m=s(function(){t.req.on("finish",u)},"onrequest");return Y_(t)?(t.on("complete",u),t.on("abort",p),t.req?m():t.on("request",m)):a&&!i&&(t.on("end",f),t.on("close",f)),Q_(t)&&t.on("exit",d),t.on("end",c),t.on("finish",u),e.error!==!1&&t.on("error",h),t.on("close",p),function(){l=!0,t.removeListener("complete",u),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",u),t.removeListener("exit",d),t.removeListener("end",c),t.removeListener("error",h),t.removeListener("close",p)}},"eos");Nf.exports=Pf});var bs=b((xw,Mf)=>{Mf.exports=J_;function J_(t){var e=t._readableState;return e?e.objectMode||typeof t._duplexState=="number"?t.read():t.read(X_(e)):null}s(J_,"shift");function X_(t){return t.buffer.length?t.buffer.head?t.buffer.head.data.length:t.buffer[0].length:t.length}s(X_,"getStateLength")});var wi=b((Cw,Uf)=>{var mi=Ye(),Lf=ys(),Z_=oe(),eg=bs(),qf=Buffer.from&&Buffer.from!==Uint8Array.from?Buffer.from([0]):new Buffer([0]),vs=s(function(t,e){t._corked?t.once("uncork",e):e()},"onuncork"),tg=s(function(t,e){t._autoDestroy&&t.destroy(e)},"autoDestroy"),Df=s(function(t,e){return function(r){r?tg(t,r.message==="premature close"?null:r):e&&!t._ended&&t.end()}},"destroyer"),rg=s(function(t,e){if(!t||t._writableState&&t._writableState.finished)return e();if(t._writableState)return t.end(e);t.end(),e()},"end"),ig=s(function(){},"noop"),ng=s(function(t){return new mi.Readable({objectMode:!0,highWaterMark:16}).wrap(t)},"toStreams2"),ee=s(function(t,e,r){if(!(this instanceof ee))return new ee(t,e,r);mi.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||r.autoDestroy!==!1,this._forwardDestroy=!r||r.destroy!==!1,this._forwardEnd=!r||r.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,t&&this.setWritable(t),e&&this.setReadable(e)},"Duplexify");Z_(ee,mi.Duplex);ee.obj=function(t,e,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new ee(t,e,r)};ee.prototype.cork=function(){++this._corked===1&&this.emit("cork")};ee.prototype.uncork=function(){this._corked&&--this._corked===0&&this.emit("uncork")};ee.prototype.setWritable=function(t){if(this._unwrite&&this._unwrite(),this.destroyed){t&&t.destroy&&t.destroy();return}if(t===null||t===!1){this.end();return}var e=this,r=Lf(t,{writable:!0,readable:!1},Df(this,this._forwardEnd)),i=s(function(){var o=e._ondrain;e._ondrain=null,o&&o()},"ondrain"),n=s(function(){e._writable.removeListener("drain",i),r()},"clear");this._unwrite&&process.nextTick(i),this._writable=t,this._writable.on("drain",i),this._unwrite=n,this.uncork()};ee.prototype.setReadable=function(t){if(this._unread&&this._unread(),this.destroyed){t&&t.destroy&&t.destroy();return}if(t===null||t===!1){this.push(null),this.resume();return}var e=this,r=Lf(t,{writable:!1,readable:!0},Df(this)),i=s(function(){e._forward()},"onreadable"),n=s(function(){e.push(null)},"onend"),o=s(function(){e._readable2.removeListener("readable",i),e._readable2.removeListener("end",n),r()},"clear");this._drained=!0,this._readable=t,this._readable2=t._readableState?t:ng(t),this._readable2.on("readable",i),this._readable2.on("end",n),this._unread=o,this._forward()};ee.prototype._read=function(){this._drained=!0,this._forward()};ee.prototype._forward=function(){if(!(this._forwarding||!this._readable2||!this._drained)){this._forwarding=!0;for(var t;this._drained&&(t=eg(this._readable2))!==null;)this.destroyed||(this._drained=this.push(t));this._forwarding=!1}};ee.prototype.destroy=function(t,e){if(e||(e=ig),this.destroyed)return e(null);this.destroyed=!0;var r=this;process.nextTick(function(){r._destroy(t),e(null)})};ee.prototype._destroy=function(t){if(t){var e=this._ondrain;this._ondrain=null,e?e(t):this.emit("error",t)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")};ee.prototype._write=function(t,e,r){if(!this.destroyed){if(this._corked)return vs(this,this._write.bind(this,t,e,r));if(t===qf)return this._finish(r);if(!this._writable)return r();this._writable.write(t)===!1?this._ondrain=r:this.destroyed||r()}};ee.prototype._finish=function(t){var e=this;this.emit("preend"),vs(this,function(){rg(e._forwardEnd&&e._writable,function(){e._writableState.prefinished===!1&&(e._writableState.prefinished=!0),e.emit("prefinish"),vs(e,t)})})};ee.prototype.end=function(t,e,r){return typeof t=="function"?this.end(null,null,t):typeof e=="function"?this.end(t,null,e):(this._ended=!0,t&&this.write(t),!this._writableState.ending&&!this._writableState.destroyed&&this.write(qf),mi.Writable.prototype.end.call(this,r))};Uf.exports=ee});var ms=b((Tw,jf)=>{"use strict";var sg=Ye().Transform,og=wi(),Pe,Si,he;function ag(){var t=new sg;return t._write=function(e,r,i){Pe.send({data:e.buffer,success:function(){i()},fail:function(n){i(new Error(n))}})},t._flush=s(function(r){Pe.close({success:function(){r()}})},"socketEnd"),t}s(ag,"buildProxy");function fg(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}s(fg,"setDefaultOpts");function lg(t,e){var r=t.protocol==="wxs"?"wss":"ws",i=r+"://"+t.hostname+t.path;return t.port&&t.port!==80&&t.port!==443&&(i=r+"://"+t.hostname+":"+t.port+t.path),typeof t.transformWsUrl=="function"&&(i=t.transformWsUrl(i,t,e)),i}s(lg,"buildUrl");function ug(){Pe.onOpen(function(){he.setReadable(Si),he.setWritable(Si),he.emit("connect")}),Pe.onMessage(function(t){var e=t.data;e instanceof ArrayBuffer?e=Buffer.from(e):e=Buffer.from(e,"utf8"),Si.push(e)}),Pe.onClose(function(){he.end(),he.destroy()}),Pe.onError(function(t){he.destroy(new Error(t.errMsg))})}s(ug,"bindEventHandler");function cg(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt";fg(e);var i=lg(e,t);Pe=wx.connectSocket({url:i,protocols:[r]}),Si=ag(),he=og.obj(),he._destroy=function(o,a){Pe.close({success:function(){a&&a(o)}})};var n=he.destroy;return he.destroy=function(){he.destroy=n;var o=this;setTimeout(function(){Pe.close({fail:function(){o._destroy(new Error)}})},0)}.bind(he),ug(),he}s(cg,"buildStream");jf.exports=cg});var ws=b((Iw,Wf)=>{"use strict";var hg=Ye().Transform,dg=wi(),rt,fr,tt,Ff=!1;function pg(){var t=new hg;return t._write=function(e,r,i){rt.sendSocketMessage({data:e.buffer,success:function(){i()},fail:function(){i(new Error)}})},t._flush=s(function(r){rt.closeSocket({success:function(){r()}})},"socketEnd"),t}s(pg,"buildProxy");function _g(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}s(_g,"setDefaultOpts");function gg(t,e){var r=t.protocol==="alis"?"wss":"ws",i=r+"://"+t.hostname+t.path;return t.port&&t.port!==80&&t.port!==443&&(i=r+"://"+t.hostname+":"+t.port+t.path),typeof t.transformWsUrl=="function"&&(i=t.transformWsUrl(i,t,e)),i}s(gg,"buildUrl");function yg(){Ff||(Ff=!0,rt.onSocketOpen(function(){tt.setReadable(fr),tt.setWritable(fr),tt.emit("connect")}),rt.onSocketMessage(function(t){if(typeof t.data=="string"){var e=Buffer.from(t.data,"base64");fr.push(e)}else{var r=new FileReader;r.addEventListener("load",function(){var i=r.result;i instanceof ArrayBuffer?i=Buffer.from(i):i=Buffer.from(i,"utf8"),fr.push(i)}),r.readAsArrayBuffer(t.data)}}),rt.onSocketClose(function(){tt.end(),tt.destroy()}),rt.onSocketError(function(t){tt.destroy(t)}))}s(yg,"bindEventHandler");function bg(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt";_g(e);var i=gg(e,t);return rt=e.my,rt.connectSocket({url:i,protocols:r}),fr=pg(),tt=dg.obj(),yg(),tt}s(bg,"buildStream");Wf.exports=bg});var yt=b((Ow,Vf)=>{"use strict";Vf.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var lr=b((Rw,Ss)=>{"use strict";var{EMPTY_BUFFER:vg}=yt();function Hf(t,e){if(t.length===0)return vg;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),i=0;for(let n=0;n<t.length;n++){let o=t[n];r.set(o,i),i+=o.length}return i<e?r.slice(0,i):r}s(Hf,"concat");function $f(t,e,r,i,n){for(let o=0;o<n;o++)r[i+o]=t[o]^e[o&3]}s($f,"_mask");function Gf(t,e){let r=t.length;for(let i=0;i<r;i++)t[i]^=e[i&3]}s(Gf,"_unmask");function zf(t){return t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}s(zf,"toArrayBuffer");function Ei(t){if(Ei.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=Buffer.from(t):ArrayBuffer.isView(t)?e=Buffer.from(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),Ei.readOnly=!1),e}s(Ei,"toBuffer");try{let t=S("bufferutil"),e=t.BufferUtil||t;Ss.exports={concat:Hf,mask(r,i,n,o,a){a<48?$f(r,i,n,o,a):e.mask(r,i,n,o,a)},toArrayBuffer:zf,toBuffer:Ei,unmask(r,i){r.length<32?Gf(r,i):e.unmask(r,i)}}}catch{Ss.exports={concat:Hf,mask:$f,toArrayBuffer:zf,toBuffer:Ei,unmask:Gf}}});var Qf=b((Aw,Yf)=>{"use strict";var Kf=Symbol("kDone"),Es=Symbol("kRun"),xi=class{constructor(e){this[Kf]=()=>{this.pending--,this[Es]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Es]()}[Es](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[Kf])}}};s(xi,"Limiter");Yf.exports=xi});var hr=b((kw,el)=>{"use strict";var ur=S("zlib"),Jf=lr(),mg=Qf(),{kStatusCode:Xf,NOOP:wg}=yt(),Sg=Buffer.from([0,0,255,255]),Oi=Symbol("permessage-deflate"),Ne=Symbol("total-length"),cr=Symbol("callback"),it=Symbol("buffers"),Ti=Symbol("error"),Ci,Ii=class{constructor(e,r,i){if(this._maxPayload=i|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Ci){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Ci=new mg(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[cr];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,i=e.find(n=>!(r.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>n.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!i)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(i.server_no_context_takeover=!0),r.clientNoContextTakeover&&(i.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(i.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?i.client_max_window_bits=r.clientMaxWindowBits:(i.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete i.client_max_window_bits,i}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(i=>{let n=r[i];if(n.length>1)throw new Error(`Parameter "${i}" must have only a single value`);if(n=n[0],i==="client_max_window_bits"){if(n!==!0){let o=+n;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${i}": ${n}`);n=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${i}": ${n}`)}else if(i==="server_max_window_bits"){let o=+n;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${i}": ${n}`);n=o}else if(i==="client_no_context_takeover"||i==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${i}": ${n}`)}else throw new Error(`Unknown parameter "${i}"`);r[i]=n})}),e}decompress(e,r,i){Ci.add(n=>{this._decompress(e,r,(o,a)=>{n(),i(o,a)})})}compress(e,r,i){Ci.add(n=>{this._compress(e,r,(o,a)=>{n(),i(o,a)})})}_decompress(e,r,i){let n=this._isServer?"client":"server";if(!this._inflate){let o=`${n}_max_window_bits`,a=typeof this.params[o]!="number"?ur.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=ur.createInflateRaw({...this._options.zlibInflateOptions,windowBits:a}),this._inflate[Oi]=this,this._inflate[Ne]=0,this._inflate[it]=[],this._inflate.on("error",xg),this._inflate.on("data",Zf)}this._inflate[cr]=i,this._inflate.write(e),r&&this._inflate.write(Sg),this._inflate.flush(()=>{let o=this._inflate[Ti];if(o){this._inflate.close(),this._inflate=null,i(o);return}let a=Jf.concat(this._inflate[it],this._inflate[Ne]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Ne]=0,this._inflate[it]=[],r&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),i(null,a)})}_compress(e,r,i){let n=this._isServer?"server":"client";if(!this._deflate){let o=`${n}_max_window_bits`,a=typeof this.params[o]!="number"?ur.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=ur.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:a}),this._deflate[Ne]=0,this._deflate[it]=[],this._deflate.on("error",wg),this._deflate.on("data",Eg)}this._deflate[cr]=i,this._deflate.write(e),this._deflate.flush(ur.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let o=Jf.concat(this._deflate[it],this._deflate[Ne]);r&&(o=o.slice(0,o.length-4)),this._deflate[cr]=null,this._deflate[Ne]=0,this._deflate[it]=[],r&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),i(null,o)})}};s(Ii,"PerMessageDeflate");el.exports=Ii;function Eg(t){this[it].push(t),this[Ne]+=t.length}s(Eg,"deflateOnData");function Zf(t){if(this[Ne]+=t.length,this[Oi]._maxPayload<1||this[Ne]<=this[Oi]._maxPayload){this[it].push(t);return}this[Ti]=new RangeError("Max payload size exceeded"),this[Ti].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Ti][Xf]=1009,this.removeListener("data",Zf),this.reset()}s(Zf,"inflateOnData");function xg(t){this[Oi]._inflate=null,t[Xf]=1007,this[cr](t)}s(xg,"inflateOnError")});var Cs=b((Bw,xs)=>{"use strict";function tl(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}s(tl,"isValidStatusCode");function rl(t){let e=t.length,r=0;for(;r<e;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}s(rl,"_isValidUTF8");try{let t=S("utf-8-validate");typeof t=="object"&&(t=t.Validation.isValidUTF8),xs.exports={isValidStatusCode:tl,isValidUTF8(e){return e.length<150?rl(e):t(e)}}}catch{xs.exports={isValidStatusCode:tl,isValidUTF8:rl}}});var Os=b((Pw,fl)=>{"use strict";var{Writable:Cg}=S("stream"),il=hr(),{BINARY_TYPES:Tg,EMPTY_BUFFER:Ig,kStatusCode:Og,kWebSocket:Rg}=yt(),{concat:Ts,toArrayBuffer:Ag,unmask:kg}=lr(),{isValidStatusCode:Bg,isValidUTF8:nl}=Cs(),dr=0,sl=1,ol=2,al=3,Is=4,Pg=5,Ri=class extends Cg{constructor(e,r,i,n){super(),this._binaryType=e||Tg[0],this[Rg]=void 0,this._extensions=r||{},this._isServer=!!i,this._maxPayload=n|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=dr,this._loop=!1}_write(e,r,i){if(this._opcode===8&&this._state==dr)return i();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(i)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let i=this._buffers[0];return this._buffers[0]=i.slice(e),i.slice(0,e)}let r=Buffer.allocUnsafe(e);do{let i=this._buffers[0],n=r.length-e;e>=i.length?r.set(this._buffers.shift(),n):(r.set(new Uint8Array(i.buffer,i.byteOffset,e),n),this._buffers[0]=i.slice(e)),e-=i.length}while(e>0);return r}startLoop(e){let r;this._loop=!0;do switch(this._state){case dr:r=this.getInfo();break;case sl:r=this.getPayloadLength16();break;case ol:r=this.getPayloadLength64();break;case al:this.getMask();break;case Is:r=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(r)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if((e[0]&48)!==0)return this._loop=!1,J(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let r=(e[0]&64)===64;if(r&&!this._extensions[il.extensionName])return this._loop=!1,J(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(r)return this._loop=!1,J(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,J(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,J(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,J(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(r)return this._loop=!1,J(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,J(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,J(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,J(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,J(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=sl;else if(this._payloadLength===127)this._state=ol;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),r=e.readUInt32BE(0);return r>Math.pow(2,53-32)-1?(this._loop=!1,J(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=r*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,J(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=al:this._state=Is}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Is}getData(e){let r=Ig;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&kg(r,this._mask)}if(this._opcode>7)return this.controlMessage(r);if(this._compressed){this._state=Pg,this.decompress(r,e);return}return r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage()}decompress(e,r){this._extensions[il.extensionName].decompress(e,this._fin,(n,o)=>{if(n)return r(n);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return r(J(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(o)}let a=this.dataMessage();if(a)return r(a);this.startLoop(r)})}dataMessage(){if(this._fin){let e=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=Ts(r,e):this._binaryType==="arraybuffer"?i=Ag(Ts(r,e)):i=r,this.emit("message",i)}else{let i=Ts(r,e);if(!nl(i))return this._loop=!1,J(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",i.toString())}}this._state=dr}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return J(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{let r=e.readUInt16BE(0);if(!Bg(r))return J(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let i=e.slice(2);if(!nl(i))return J(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",r,i.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=dr}};s(Ri,"Receiver");fl.exports=Ri;function J(t,e,r,i,n){let o=new t(r?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(o,J),o.code=n,o[Og]=i,o}s(J,"error")});var Rs=b((Lw,cl)=>{"use strict";var Nw=S("net"),Mw=S("tls"),{randomFillSync:Ng}=S("crypto"),ll=hr(),{EMPTY_BUFFER:Mg}=yt(),{isValidStatusCode:Lg}=Cs(),{mask:ul,toBuffer:Me}=lr(),bt=Buffer.alloc(4),Ee=class{constructor(e,r){this._extensions=r||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,r){let i=r.mask&&r.readOnly,n=r.mask?6:2,o=e.length;e.length>=65536?(n+=8,o=127):e.length>125&&(n+=2,o=126);let a=Buffer.allocUnsafe(i?e.length+n:n);return a[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(a[0]|=64),a[1]=o,o===126?a.writeUInt16BE(e.length,2):o===127&&(a.writeUInt32BE(0,2),a.writeUInt32BE(e.length,6)),r.mask?(Ng(bt,0,4),a[1]|=128,a[n-4]=bt[0],a[n-3]=bt[1],a[n-2]=bt[2],a[n-1]=bt[3],i?(ul(e,bt,a,n,e.length),[a]):(ul(e,bt,e,0,e.length),[a,e])):[a,e]}close(e,r,i,n){let o;if(e===void 0)o=Mg;else{if(typeof e!="number"||!Lg(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||r==="")o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");o=Buffer.allocUnsafe(2+a),o.writeUInt16BE(e,0),o.write(r,2)}}this._deflating?this.enqueue([this.doClose,o,i,n]):this.doClose(o,i,n)}doClose(e,r,i){this.sendFrame(Ee.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:r,readOnly:!1}),i)}ping(e,r,i){let n=Me(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,n,r,Me.readOnly,i]):this.doPing(n,r,Me.readOnly,i)}doPing(e,r,i,n){this.sendFrame(Ee.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:r,readOnly:i}),n)}pong(e,r,i){let n=Me(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,n,r,Me.readOnly,i]):this.doPong(n,r,Me.readOnly,i)}doPong(e,r,i,n){this.sendFrame(Ee.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:r,readOnly:i}),n)}send(e,r,i){let n=Me(e),o=this._extensions[ll.extensionName],a=r.binary?2:1,l=r.compress;if(this._firstFragment?(this._firstFragment=!1,l&&o&&(l=n.length>=o._threshold),this._compress=l):(l=!1,a=0),r.fin&&(this._firstFragment=!0),o){let f={fin:r.fin,rsv1:l,opcode:a,mask:r.mask,readOnly:Me.readOnly};this._deflating?this.enqueue([this.dispatch,n,this._compress,f,i]):this.dispatch(n,this._compress,f,i)}else this.sendFrame(Ee.frame(n,{fin:r.fin,rsv1:!1,opcode:a,mask:r.mask,readOnly:Me.readOnly}),i)}dispatch(e,r,i,n){if(!r){this.sendFrame(Ee.frame(e,i),n);return}let o=this._extensions[ll.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,o.compress(e,i.fin,(a,l)=>{if(this._socket.destroyed){let f=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(f);for(let u=0;u<this._queue.length;u++){let c=this._queue[u][4];typeof c=="function"&&c(f)}return}this._bufferedBytes-=e.length,this._deflating=!1,i.readOnly=!1,this.sendFrame(Ee.frame(l,i),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};s(Ee,"Sender");cl.exports=Ee});var dl=b((qw,hl)=>{"use strict";var vt=class{constructor(e,r){this.target=r,this.type=e}};s(vt,"Event");var Ai=class extends vt{constructor(e,r){super("message",r),this.data=e}};s(Ai,"MessageEvent");var ki=class extends vt{constructor(e,r,i){super("close",i),this.wasClean=i._closeFrameReceived&&i._closeFrameSent,this.reason=r,this.code=e}};s(ki,"CloseEvent");var Bi=class extends vt{constructor(e){super("open",e)}};s(Bi,"OpenEvent");var Pi=class extends vt{constructor(e,r){super("error",r),this.message=e.message,this.error=e}};s(Pi,"ErrorEvent");var qg={addEventListener(t,e,r){if(typeof e!="function")return;function i(f){e.call(this,new Ai(f,this))}s(i,"onMessage");function n(f,u){e.call(this,new ki(f,u,this))}s(n,"onClose");function o(f){e.call(this,new Pi(f,this))}s(o,"onError");function a(){e.call(this,new Bi(this))}s(a,"onOpen");let l=r&&r.once?"once":"on";t==="message"?(i._listener=e,this[l](t,i)):t==="close"?(n._listener=e,this[l](t,n)):t==="error"?(o._listener=e,this[l](t,o)):t==="open"?(a._listener=e,this[l](t,a)):this[l](t,e)},removeEventListener(t,e){let r=this.listeners(t);for(let i=0;i<r.length;i++)(r[i]===e||r[i]._listener===e)&&this.removeListener(t,r[i])}};hl.exports=qg});var As=b((Dw,pl)=>{"use strict";var pr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Oe(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}s(Oe,"push");function Dg(t){let e=Object.create(null);if(t===void 0||t==="")return e;let r=Object.create(null),i=!1,n=!1,o=!1,a,l,f=-1,u=-1,c=0;for(;c<t.length;c++){let h=t.charCodeAt(c);if(a===void 0)if(u===-1&&pr[h]===1)f===-1&&(f=c);else if(h===32||h===9)u===-1&&f!==-1&&(u=c);else if(h===59||h===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${c}`);u===-1&&(u=c);let p=t.slice(f,u);h===44?(Oe(e,p,r),r=Object.create(null)):a=p,f=u=-1}else throw new SyntaxError(`Unexpected character at index ${c}`);else if(l===void 0)if(u===-1&&pr[h]===1)f===-1&&(f=c);else if(h===32||h===9)u===-1&&f!==-1&&(u=c);else if(h===59||h===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${c}`);u===-1&&(u=c),Oe(r,t.slice(f,u),!0),h===44&&(Oe(e,a,r),r=Object.create(null),a=void 0),f=u=-1}else if(h===61&&f!==-1&&u===-1)l=t.slice(f,c),f=u=-1;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(n){if(pr[h]!==1)throw new SyntaxError(`Unexpected character at index ${c}`);f===-1?f=c:i||(i=!0),n=!1}else if(o)if(pr[h]===1)f===-1&&(f=c);else if(h===34&&f!==-1)o=!1,u=c;else if(h===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(h===34&&t.charCodeAt(c-1)===61)o=!0;else if(u===-1&&pr[h]===1)f===-1&&(f=c);else if(f!==-1&&(h===32||h===9))u===-1&&(u=c);else if(h===59||h===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${c}`);u===-1&&(u=c);let p=t.slice(f,u);i&&(p=p.replace(/\\/g,""),i=!1),Oe(r,l,p),h===44&&(Oe(e,a,r),r=Object.create(null),a=void 0),l=void 0,f=u=-1}else throw new SyntaxError(`Unexpected character at index ${c}`)}if(f===-1||o)throw new SyntaxError("Unexpected end of input");u===-1&&(u=c);let d=t.slice(f,u);return a===void 0?Oe(e,d,r):(l===void 0?Oe(r,d,!0):i?Oe(r,l,d.replace(/\\/g,"")):Oe(r,l,d),Oe(e,a,r)),e}s(Dg,"parse");function Ug(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(i=>[e].concat(Object.keys(i).map(n=>{let o=i[n];return Array.isArray(o)||(o=[o]),o.map(a=>a===!0?n:`${n}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")}s(Ug,"format");pl.exports={format:Ug,parse:Dg}});var Ls=b((jw,xl)=>{"use strict";var jg=S("events"),Fg=S("https"),Wg=S("http"),yl=S("net"),Vg=S("tls"),{randomBytes:Hg,createHash:$g}=S("crypto"),{Readable:Uw}=S("stream"),{URL:ks}=S("url"),nt=hr(),Gg=Os(),zg=Rs(),{BINARY_TYPES:_l,EMPTY_BUFFER:Bs,GUID:Kg,kStatusCode:Yg,kWebSocket:ne,NOOP:bl}=yt(),{addEventListener:Qg,removeEventListener:Jg}=dl(),{format:Xg,parse:Zg}=As(),{toBuffer:ey}=lr(),Le=["CONNECTING","OPEN","CLOSING","CLOSED"],Ps=[8,13],ty=30*1e3,P=class extends jg{constructor(e,r,i){super(),this._binaryType=_l[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=P.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,Array.isArray(r)?r=r.join(", "):typeof r=="object"&&r!==null&&(i=r,r=void 0),vl(this,e,r,i)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){!_l.includes(e)||(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){}set onclose(e){}get onerror(){}set onerror(e){}get onopen(){}set onopen(e){}get onmessage(){}set onmessage(e){}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,i){let n=new Gg(this.binaryType,this._extensions,this._isServer,i);this._sender=new zg(e,this._extensions),this._receiver=n,this._socket=e,n[ne]=this,e[ne]=this,n.on("conclude",ny),n.on("drain",sy),n.on("error",oy),n.on("message",ay),n.on("ping",fy),n.on("pong",ly),e.setTimeout(0),e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",wl),e.on("data",Ni),e.on("end",Sl),e.on("error",El),this._readyState=P.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[nt.extensionName]&&this._extensions[nt.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=P.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING){let i="WebSocket was closed before the connection was established";return de(this,this._req,i)}if(this.readyState===P.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=P.CLOSING,this._sender.close(e,r,!this._isServer,i=>{i||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),ty)}}ping(e,r,i){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=r=void 0):typeof r=="function"&&(i=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==P.OPEN){Ms(this,e,i);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Bs,r,i)}pong(e,r,i){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=r=void 0):typeof r=="function"&&(i=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==P.OPEN){Ms(this,e,i);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Bs,r,i)}send(e,r,i){if(this.readyState===P.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(i=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==P.OPEN){Ms(this,e,i);return}let n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[nt.extensionName]||(n.compress=!1),this._sender.send(e||Bs,n,i)}terminate(){if(this.readyState!==P.CLOSED){if(this.readyState===P.CONNECTING){let e="WebSocket was closed before the connection was established";return de(this,this._req,e)}this._socket&&(this._readyState=P.CLOSING,this._socket.destroy())}}};s(P,"WebSocket");Object.defineProperty(P,"CONNECTING",{enumerable:!0,value:Le.indexOf("CONNECTING")});Object.defineProperty(P.prototype,"CONNECTING",{enumerable:!0,value:Le.indexOf("CONNECTING")});Object.defineProperty(P,"OPEN",{enumerable:!0,value:Le.indexOf("OPEN")});Object.defineProperty(P.prototype,"OPEN",{enumerable:!0,value:Le.indexOf("OPEN")});Object.defineProperty(P,"CLOSING",{enumerable:!0,value:Le.indexOf("CLOSING")});Object.defineProperty(P.prototype,"CLOSING",{enumerable:!0,value:Le.indexOf("CLOSING")});Object.defineProperty(P,"CLOSED",{enumerable:!0,value:Le.indexOf("CLOSED")});Object.defineProperty(P.prototype,"CLOSED",{enumerable:!0,value:Le.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(t=>{Object.defineProperty(P.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(P.prototype,`on${t}`,{enumerable:!0,get(){let e=this.listeners(t);for(let r=0;r<e.length;r++)if(e[r]._listener)return e[r]._listener},set(e){let r=this.listeners(t);for(let i=0;i<r.length;i++)r[i]._listener&&this.removeListener(t,r[i]);this.addEventListener(t,e)}})});P.prototype.addEventListener=Qg;P.prototype.removeEventListener=Jg;xl.exports=P;function vl(t,e,r,i){let n={protocolVersion:Ps[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!Ps.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Ps.join(", ")})`);let o;e instanceof ks?(o=e,t._url=e.href):(o=new ks(e),t._url=e);let a=o.protocol==="ws+unix:";if(!o.host&&(!a||!o.pathname)){let p=new Error(`Invalid URL: ${t.url}`);if(t._redirects===0)throw p;Ns(t,p);return}let l=o.protocol==="wss:"||o.protocol==="https:",f=l?443:80,u=Hg(16).toString("base64"),c=l?Fg.get:Wg.get,d;if(n.createConnection=l?iy:ry,n.defaultPort=n.defaultPort||f,n.port=o.port||f,n.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,n.headers={"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket",...n.headers},n.path=o.pathname+o.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(d=new nt(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=Xg({[nt.extensionName]:d.offer()})),r&&(n.headers["Sec-WebSocket-Protocol"]=r),n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(o.username||o.password)&&(n.auth=`${o.username}:${o.password}`),a){let p=n.path.split(":");n.socketPath=p[0],n.path=p[1]}if(n.followRedirects){if(t._redirects===0){t._originalUnixSocket=a,t._originalSecure=l,t._originalHostOrSocketPath=a?n.socketPath:o.host;let p=i&&i.headers;if(i={...i,headers:{}},p)for(let[g,m]of Object.entries(p))i.headers[g.toLowerCase()]=m}else{let p=a?t._originalUnixSocket?n.socketPath===t._originalHostOrSocketPath:!1:t._originalUnixSocket?!1:o.host===t._originalHostOrSocketPath;(!p||t._originalSecure&&!l)&&(delete n.headers.authorization,delete n.headers.cookie,p||delete n.headers.host,n.auth=void 0)}n.auth&&!i.headers.authorization&&(i.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64"))}let h=t._req=c(n);n.timeout&&h.on("timeout",()=>{de(t,h,"Opening handshake has timed out")}),h.on("error",p=>{h===null||h.aborted||(h=t._req=null,Ns(t,p))}),h.on("response",p=>{let g=p.headers.location,m=p.statusCode;if(g&&n.followRedirects&&m>=300&&m<400){if(++t._redirects>n.maxRedirects){de(t,h,"Maximum redirects exceeded");return}h.abort();let w;try{w=new ks(g,e)}catch(_){Ns(t,_);return}vl(t,w,r,i)}else t.emit("unexpected-response",h,p)||de(t,h,`Unexpected server response: ${p.statusCode}`)}),h.on("upgrade",(p,g,m)=>{if(t.emit("upgrade",p),t.readyState!==P.CONNECTING)return;if(h=t._req=null,p.headers.upgrade.toLowerCase()!=="websocket"){de(t,g,"Invalid Upgrade header");return}let w=$g("sha1").update(u+Kg).digest("base64");if(p.headers["sec-websocket-accept"]!==w){de(t,g,"Invalid Sec-WebSocket-Accept header");return}let _=p.headers["sec-websocket-protocol"],y=(r||"").split(/, */),x;if(!r&&_?x="Server sent a subprotocol but none was requested":r&&!_?x="Server sent no subprotocol":_&&!y.includes(_)&&(x="Server sent an invalid subprotocol"),x){de(t,g,x);return}_&&(t._protocol=_);let T=p.headers["sec-websocket-extensions"];if(T!==void 0){if(!d){de(t,g,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let I;try{I=Zg(T)}catch{de(t,g,"Invalid Sec-WebSocket-Extensions header");return}let E=Object.keys(I);if(E.length){if(E.length!==1||E[0]!==nt.extensionName){de(t,g,"Server indicated an extension that was not requested");return}try{d.accept(I[nt.extensionName])}catch{de(t,g,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[nt.extensionName]=d}}t.setSocket(g,m,n.maxPayload)})}s(vl,"initAsClient");function Ns(t,e){t._readyState=P.CLOSING,t.emit("error",e),t.emitClose()}s(Ns,"emitErrorAndClose");function ry(t){return t.path=t.socketPath,yl.connect(t)}s(ry,"netConnect");function iy(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=yl.isIP(t.host)?"":t.host),Vg.connect(t)}s(iy,"tlsConnect");function de(t,e,r){t._readyState=P.CLOSING;let i=new Error(r);Error.captureStackTrace(i,de),e.setHeader?(e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),e.once("abort",t.emitClose.bind(t)),t.emit("error",i)):(e.destroy(i),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}s(de,"abortHandshake");function Ms(t,e,r){if(e){let i=ey(e).length;t._socket?t._sender._bufferedBytes+=i:t._bufferedAmount+=i}if(r){let i=new Error(`WebSocket is not open: readyState ${t.readyState} (${Le[t.readyState]})`);r(i)}}s(Ms,"sendAfterClose");function ny(t,e){let r=this[ne];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[ne]!==void 0&&(r._socket.removeListener("data",Ni),process.nextTick(ml,r._socket),t===1005?r.close():r.close(t,e))}s(ny,"receiverOnConclude");function sy(){this[ne]._socket.resume()}s(sy,"receiverOnDrain");function oy(t){let e=this[ne];e._socket[ne]!==void 0&&(e._socket.removeListener("data",Ni),process.nextTick(ml,e._socket),e.close(t[Yg])),e.emit("error",t)}s(oy,"receiverOnError");function gl(){this[ne].emitClose()}s(gl,"receiverOnFinish");function ay(t){this[ne].emit("message",t)}s(ay,"receiverOnMessage");function fy(t){let e=this[ne];e.pong(t,!e._isServer,bl),e.emit("ping",t)}s(fy,"receiverOnPing");function ly(t){this[ne].emit("pong",t)}s(ly,"receiverOnPong");function ml(t){t.resume()}s(ml,"resume");function wl(){let t=this[ne];this.removeListener("close",wl),this.removeListener("data",Ni),this.removeListener("end",Sl),t._readyState=P.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[ne]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",gl),t._receiver.on("finish",gl))}s(wl,"socketOnClose");function Ni(t){this[ne]._receiver.write(t)||this.pause()}s(Ni,"socketOnData");function Sl(){let t=this[ne];t._readyState=P.CLOSING,t._receiver.end(),this.end()}s(Sl,"socketOnEnd");function El(){let t=this[ne];this.removeListener("error",El),this.on("error",bl),t&&(t._readyState=P.CLOSING,this.destroy())}s(El,"socketOnError")});var Ol=b((Fw,Il)=>{"use strict";var{Duplex:uy}=S("stream");function Cl(t){t.emit("close")}s(Cl,"emitClose");function cy(){!this.destroyed&&this._writableState.finished&&this.destroy()}s(cy,"duplexOnEnd");function Tl(t){this.removeListener("error",Tl),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}s(Tl,"duplexOnError");function hy(t,e){let r=!0,i=!0;function n(){r&&t._socket.resume()}s(n,"receiverOnDrain"),t.readyState===t.CONNECTING?t.once("open",s(function(){t._receiver.removeAllListeners("drain"),t._receiver.on("drain",n)},"open")):(t._receiver.removeAllListeners("drain"),t._receiver.on("drain",n));let o=new uy({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",s(function(l){o.push(l)||(r=!1,t._socket.pause())},"message")),t.once("error",s(function(l){o.destroyed||(i=!1,o.destroy(l))},"error")),t.once("close",s(function(){o.destroyed||o.push(null)},"close")),o._destroy=function(a,l){if(t.readyState===t.CLOSED){l(a),process.nextTick(Cl,o);return}let f=!1;t.once("error",s(function(c){f=!0,l(c)},"error")),t.once("close",s(function(){f||l(a),process.nextTick(Cl,o)},"close")),i&&t.terminate()},o._final=function(a){if(t.readyState===t.CONNECTING){t.once("open",s(function(){o._final(a)},"open"));return}t._socket!==null&&(t._socket._writableState.finished?(a(),o._readableState.endEmitted&&o.destroy()):(t._socket.once("finish",s(function(){a()},"finish")),t.close()))},o._read=function(){(t.readyState===t.OPEN||t.readyState===t.CLOSING)&&!r&&(r=!0,t._receiver._writableState.needDrain||t._socket.resume())},o._write=function(a,l,f){if(t.readyState===t.CONNECTING){t.once("open",s(function(){o._write(a,l,f)},"open"));return}t.send(a,f)},o.on("end",cy),o.on("error",Tl),o}s(hy,"createWebSocketStream");Il.exports=hy});var Pl=b(($w,Bl)=>{"use strict";var dy=S("events"),Li=S("http"),Ww=S("https"),Vw=S("net"),Hw=S("tls"),{createHash:py}=S("crypto"),mt=hr(),_y=Ls(),{format:gy,parse:yy}=As(),{GUID:by,kWebSocket:vy}=yt(),my=/^[+/0-9A-Za-z]{22}==$/,Rl=0,Al=1,kl=2,Mi=class extends dy{constructor(e,r){if(super(),e={maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Li.createServer((i,n)=>{let o=Li.STATUS_CODES[426];n.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),n.end(o)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let i=this.emit.bind(this,"connection");this._removeListeners=wy(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,o,a)=>{this.handleUpgrade(n,o,a,i)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e,this._state=Rl}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this._state===kl){process.nextTick(qs,this);return}if(this._state===Al)return;if(this._state=Al,this.clients)for(let i of this.clients)i.terminate();let r=this._server;if(r&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){r.close(qs.bind(void 0,this));return}process.nextTick(qs,this)}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,i,n){r.on("error",Ds);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,a=+e.headers["sec-websocket-version"],l={};if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!o||!my.test(o)||a!==8&&a!==13||!this.shouldHandle(e))return _r(r,400);if(this.options.perMessageDeflate){let f=new mt(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let u=yy(e.headers["sec-websocket-extensions"]);u[mt.extensionName]&&(f.accept(u[mt.extensionName]),l[mt.extensionName]=f)}catch{return _r(r,400)}}if(this.options.verifyClient){let f={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(f,(u,c,d,h)=>{if(!u)return _r(r,c||401,d,h);this.completeUpgrade(o,l,e,r,i,n)});return}if(!this.options.verifyClient(f))return _r(r,401)}this.completeUpgrade(o,l,e,r,i,n)}completeUpgrade(e,r,i,n,o,a){if(!n.readable||!n.writable)return n.destroy();if(n[vy])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Rl)return _r(n,503);let l=py("sha1").update(e+by).digest("base64"),f=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${l}`],u=new _y(null),c=i.headers["sec-websocket-protocol"];if(c&&(c=c.split(",").map(Sy),this.options.handleProtocols?c=this.options.handleProtocols(c,i):c=c[0],c&&(f.push(`Sec-WebSocket-Protocol: ${c}`),u._protocol=c)),r[mt.extensionName]){let d=r[mt.extensionName].params,h=gy({[mt.extensionName]:[d]});f.push(`Sec-WebSocket-Extensions: ${h}`),u._extensions=r}this.emit("headers",f,i),n.write(f.concat(`\r
`).join(`\r
`)),n.removeListener("error",Ds),u.setSocket(n,o,this.options.maxPayload),this.clients&&(this.clients.add(u),u.on("close",()=>this.clients.delete(u))),a(u,i)}};s(Mi,"WebSocketServer");Bl.exports=Mi;function wy(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return s(function(){for(let i of Object.keys(e))t.removeListener(i,e[i])},"removeListeners")}s(wy,"addListeners");function qs(t){t._state=kl,t.emit("close")}s(qs,"emitClose");function Ds(){this.destroy()}s(Ds,"socketOnError");function _r(t,e,r,i){t.writable&&(r=r||Li.STATUS_CODES[e],i={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...i},t.write(`HTTP/1.1 ${e} ${Li.STATUS_CODES[e]}\r
`+Object.keys(i).map(n=>`${n}: ${i[n]}`).join(`\r
`)+`\r
\r
`+r)),t.removeListener("error",Ds),t.destroy()}s(_r,"abortHandshake");function Sy(t){return t.trim()}s(Sy,"trim")});var Ml=b((Gw,Nl)=>{"use strict";var gr=Ls();gr.createWebSocketStream=Ol();gr.Server=Pl();gr.Receiver=Os();gr.Sender=Rs();Nl.exports=gr});var js=b((zw,Us)=>{"use strict";var Ll=Ml(),yr=Ze()("mqttjs:ws"),Ey=wi(),xy=Ye().Transform,Cy=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],ql=typeof process<"u"&&process.title==="browser"||typeof __webpack_require__=="function";function Dl(t,e){let r=t.protocol+"://"+t.hostname+":"+t.port+t.path;return typeof t.transformWsUrl=="function"&&(r=t.transformWsUrl(r,t,e)),r}s(Dl,"buildUrl");function Ul(t){let e=t;return t.hostname||(e.hostname="localhost"),t.port||(t.protocol==="wss"?e.port=443:e.port=80),t.path||(e.path="/"),t.wsOptions||(e.wsOptions={}),!ql&&t.protocol==="wss"&&Cy.forEach(function(r){t.hasOwnProperty(r)&&!t.wsOptions.hasOwnProperty(r)&&(e.wsOptions[r]=t[r])}),e}s(Ul,"setDefaultOpts");function Ty(t){let e=Ul(t);if(e.hostname||(e.hostname=e.host),!e.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let r=new URL(document.URL);e.hostname=r.hostname,e.port||(e.port=r.port)}return e.objectMode===void 0&&(e.objectMode=!(e.binary===!0||e.binary===void 0)),e}s(Ty,"setDefaultBrowserOpts");function Iy(t,e,r){yr("createWebSocket"),yr("protocol: "+r.protocolId+" "+r.protocolVersion);let i=r.protocolId==="MQIsdp"&&r.protocolVersion===3?"mqttv3.1":"mqtt";return yr("creating new Websocket for url: "+e+" and protocol: "+i),new Ll(e,[i],r.wsOptions)}s(Iy,"createWebSocket");function Oy(t,e){let r=e.protocolId==="MQIsdp"&&e.protocolVersion===3?"mqttv3.1":"mqtt",i=Dl(e,t),n=new WebSocket(i,[r]);return n.binaryType="arraybuffer",n}s(Oy,"createBrowserWebSocket");function Ry(t,e){yr("streamBuilder");let r=Ul(e),i=Dl(r,t),n=Iy(t,i,r),o=Ll.createWebSocketStream(n,r.wsOptions);return o.url=i,n.on("close",()=>{o.destroy()}),o}s(Ry,"streamBuilder");function Ay(t,e){yr("browserStreamBuilder");let r,n=Ty(e).browserBufferSize||1024*512,o=e.browserBufferTimeout||1e3,a=!e.objectMode,l=Oy(t,e),f=c(e,w,_);e.objectMode||(f._writev=m),f.on("close",()=>{l.close()});let u=typeof l.addEventListener<"u";l.readyState===l.OPEN?r=f:(r=r=Ey(void 0,void 0,e),e.objectMode||(r._writev=m),u?l.addEventListener("open",d):l.onopen=d),r.socket=l,u?(l.addEventListener("close",h),l.addEventListener("error",p),l.addEventListener("message",g)):(l.onclose=h,l.onerror=p,l.onmessage=g);function c(y,x,T){let I=new xy({objectModeMode:y.objectMode});return I._write=x,I._flush=T,I}s(c,"buildProxy");function d(){r.setReadable(f),r.setWritable(f),r.emit("connect")}s(d,"onopen");function h(){r.end(),r.destroy()}s(h,"onclose");function p(y){r.destroy(y)}s(p,"onerror");function g(y){let x=y.data;x instanceof ArrayBuffer?x=Buffer.from(x):x=Buffer.from(x,"utf8"),f.push(x)}s(g,"onmessage");function m(y,x){let T=new Array(y.length);for(let I=0;I<y.length;I++)typeof y[I].chunk=="string"?T[I]=Buffer.from(y[I],"utf8"):T[I]=y[I].chunk;this._write(Buffer.concat(T),"binary",x)}s(m,"writev");function w(y,x,T){l.bufferedAmount>n&&setTimeout(w,o,y,x,T),a&&typeof y=="string"&&(y=Buffer.from(y,"utf8"));try{l.send(y)}catch(I){return T(I)}T()}s(w,"socketWriteBrowser");function _(y){l.close(),y()}return s(_,"socketEndBrowser"),r}s(Ay,"browserStreamBuilder");ql?Us.exports=Ay:Us.exports=Ry});var Vl=b((Kw,br)=>{"use strict";var Fl=ps(),ky=si(),By=S("url"),Py=Vr(),jl=Ze()("mqttjs"),le={};typeof process<"u"&&process.title!=="browser"||typeof __webpack_require__!="function"?(le.mqtt=_s(),le.tcp=_s(),le.ssl=bi(),le.tls=bi(),le.mqtts=bi()):(le.wx=ms(),le.wxs=ms(),le.ali=ws(),le.alis=ws());le.ws=js();le.wss=js();function Ny(t){var e;t.auth&&(e=t.auth.match(/^(.+):(.+)$/),e?(t.username=e[1],t.password=e[2]):t.username=t.auth)}s(Ny,"parseAuthOptions");function Wl(t,e){if(jl("connecting to an MQTT broker..."),typeof t=="object"&&!e&&(e=t,t=null),e=e||{},t){var r=By.parse(t,!0);if(r.port!=null&&(r.port=Number(r.port)),e=Py(r,e),e.protocol===null)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}if(Ny(e),e.query&&typeof e.query.clientId=="string"&&(e.clientId=e.query.clientId),e.cert&&e.key)if(e.protocol){if(["mqtts","wss","wxs","alis"].indexOf(e.protocol)===-1)switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+e.protocol+'"!')}}else throw new Error("Missing secure protocol key");if(!le[e.protocol]){var i=["mqtts","wss"].indexOf(e.protocol)!==-1;e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(a,l){return i&&l%2===0?!1:typeof le[a]=="function"})[0]}if(e.clean===!1&&!e.clientId)throw new Error("Missing clientId for unclean clients");e.protocol&&(e.defaultProtocol=e.protocol);function n(a){return e.servers&&((!a._reconnectCount||a._reconnectCount===e.servers.length)&&(a._reconnectCount=0),e.host=e.servers[a._reconnectCount].host,e.port=e.servers[a._reconnectCount].port,e.protocol=e.servers[a._reconnectCount].protocol?e.servers[a._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,a._reconnectCount++),jl("calling streambuilder for",e.protocol),le[e.protocol](a,e)}s(n,"wrapper");var o=new Fl(n,e);return o.on("error",function(){}),o}s(Wl,"connect");br.exports=Wl;br.exports.connect=Wl;br.exports.MqttClient=Fl;br.exports.Store=ky});var $l=b((Yw,vr)=>{var Hl=ps(),My=Vl(),Ly=si();vr.exports.connect=My;vr.exports.MqttClient=Hl;vr.exports.Client=Hl;vr.exports.Store=Ly});var Di=b((qi,Gl)=>{(function(t,e){typeof qi=="object"?Gl.exports=qi=e():typeof define=="function"&&define.amd?define([],e):t.CryptoJS=e()})(qi,function(){var t=t||function(e,r){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof global<"u"&&global.crypto&&(i=global.crypto),!i&&typeof S=="function")try{i=S("crypto")}catch{}var n=s(function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},"cryptoSecureRandomInt"),o=Object.create||function(){function _(){}return s(_,"F"),function(y){var x;return _.prototype=y,x=new _,_.prototype=null,x}}(),a={},l=a.lib={},f=l.Base=function(){return{extend:function(_){var y=o(this);return _&&y.mixIn(_),(!y.hasOwnProperty("init")||this.init===y.init)&&(y.init=function(){y.$super.init.apply(this,arguments)}),y.init.prototype=y,y.$super=this,y},create:function(){var _=this.extend();return _.init.apply(_,arguments),_},init:function(){},mixIn:function(_){for(var y in _)_.hasOwnProperty(y)&&(this[y]=_[y]);_.hasOwnProperty("toString")&&(this.toString=_.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),u=l.WordArray=f.extend({init:function(_,y){_=this.words=_||[],y!=r?this.sigBytes=y:this.sigBytes=_.length*4},toString:function(_){return(_||d).stringify(this)},concat:function(_){var y=this.words,x=_.words,T=this.sigBytes,I=_.sigBytes;if(this.clamp(),T%4)for(var E=0;E<I;E++){var M=x[E>>>2]>>>24-E%4*8&255;y[T+E>>>2]|=M<<24-(T+E)%4*8}else for(var E=0;E<I;E+=4)y[T+E>>>2]=x[E>>>2];return this.sigBytes+=I,this},clamp:function(){var _=this.words,y=this.sigBytes;_[y>>>2]&=4294967295<<32-y%4*8,_.length=e.ceil(y/4)},clone:function(){var _=f.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var y=[],x=0;x<_;x+=4)y.push(n());return new u.init(y,_)}}),c=a.enc={},d=c.Hex={stringify:function(_){for(var y=_.words,x=_.sigBytes,T=[],I=0;I<x;I++){var E=y[I>>>2]>>>24-I%4*8&255;T.push((E>>>4).toString(16)),T.push((E&15).toString(16))}return T.join("")},parse:function(_){for(var y=_.length,x=[],T=0;T<y;T+=2)x[T>>>3]|=parseInt(_.substr(T,2),16)<<24-T%8*4;return new u.init(x,y/2)}},h=c.Latin1={stringify:function(_){for(var y=_.words,x=_.sigBytes,T=[],I=0;I<x;I++){var E=y[I>>>2]>>>24-I%4*8&255;T.push(String.fromCharCode(E))}return T.join("")},parse:function(_){for(var y=_.length,x=[],T=0;T<y;T++)x[T>>>2]|=(_.charCodeAt(T)&255)<<24-T%4*8;return new u.init(x,y)}},p=c.Utf8={stringify:function(_){try{return decodeURIComponent(escape(h.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return h.parse(unescape(encodeURIComponent(_)))}},g=l.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=p.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var y,x=this._data,T=x.words,I=x.sigBytes,E=this.blockSize,M=E*4,H=I/M;_?H=e.ceil(H):H=e.max((H|0)-this._minBufferSize,0);var K=H*E,ft=e.min(K*4,I);if(K){for(var Ce=0;Ce<K;Ce+=E)this._doProcessBlock(T,Ce);y=T.splice(0,K),x.sigBytes-=ft}return new u.init(y,ft)},clone:function(){var _=f.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0}),m=l.Hasher=g.extend({cfg:f.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){_&&this._append(_);var y=this._doFinalize();return y},blockSize:512/32,_createHelper:function(_){return function(y,x){return new _.init(x).finalize(y)}},_createHmacHelper:function(_){return function(y,x){return new w.HMAC.init(_,x).finalize(y)}}}),w=a.algo={};return a}(Math);return t})});var Fs=b((Ui,zl)=>{(function(t,e){typeof Ui=="object"?zl.exports=Ui=e(Di()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(Ui,function(t){return function(e){var r=t,i=r.lib,n=i.WordArray,o=i.Hasher,a=r.algo,l=[],f=[];(function(){function d(m){for(var w=e.sqrt(m),_=2;_<=w;_++)if(!(m%_))return!1;return!0}s(d,"isPrime");function h(m){return(m-(m|0))*4294967296|0}s(h,"getFractionalBits");for(var p=2,g=0;g<64;)d(p)&&(g<8&&(l[g]=h(e.pow(p,1/2))),f[g]=h(e.pow(p,1/3)),g++),p++})();var u=[],c=a.SHA256=o.extend({_doReset:function(){this._hash=new n.init(l.slice(0))},_doProcessBlock:function(d,h){for(var p=this._hash.words,g=p[0],m=p[1],w=p[2],_=p[3],y=p[4],x=p[5],T=p[6],I=p[7],E=0;E<64;E++){if(E<16)u[E]=d[h+E]|0;else{var M=u[E-15],H=(M<<25|M>>>7)^(M<<14|M>>>18)^M>>>3,K=u[E-2],ft=(K<<15|K>>>17)^(K<<13|K>>>19)^K>>>10;u[E]=H+u[E-7]+ft+u[E-16]}var Ce=y&x^~y&T,Ur=g&m^g&w^m&w,mn=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),Kt=(y<<26|y>>>6)^(y<<21|y>>>11)^(y<<7|y>>>25),jr=I+Kt+Ce+f[E]+u[E],Fr=mn+Ur;I=T,T=x,x=y,y=_+jr|0,_=w,w=m,m=g,g=jr+Fr|0}p[0]=p[0]+g|0,p[1]=p[1]+m|0,p[2]=p[2]+w|0,p[3]=p[3]+_|0,p[4]=p[4]+y|0,p[5]=p[5]+x|0,p[6]=p[6]+T|0,p[7]=p[7]+I|0},_doFinalize:function(){var d=this._data,h=d.words,p=this._nDataBytes*8,g=d.sigBytes*8;return h[g>>>5]|=128<<24-g%32,h[(g+64>>>9<<4)+14]=e.floor(p/4294967296),h[(g+64>>>9<<4)+15]=p,d.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var d=o.clone.call(this);return d._hash=this._hash.clone(),d}});r.SHA256=o._createHelper(c),r.HmacSHA256=o._createHmacHelper(c)}(Math),t.SHA256})});var Yl=b((ji,Kl)=>{(function(t,e){typeof ji=="object"?Kl.exports=ji=e(Di()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(ji,function(t){(function(){var e=t,r=e.lib,i=r.Base,n=e.enc,o=n.Utf8,a=e.algo,l=a.HMAC=i.extend({init:function(f,u){f=this._hasher=new f.init,typeof u=="string"&&(u=o.parse(u));var c=f.blockSize,d=c*4;u.sigBytes>d&&(u=f.finalize(u)),u.clamp();for(var h=this._oKey=u.clone(),p=this._iKey=u.clone(),g=h.words,m=p.words,w=0;w<c;w++)g[w]^=1549556828,m[w]^=909522486;h.sigBytes=p.sigBytes=d,this.reset()},reset:function(){var f=this._hasher;f.reset(),f.update(this._iKey)},update:function(f){return this._hasher.update(f),this},finalize:function(f){var u=this._hasher,c=u.finalize(f);u.reset();var d=u.finalize(this._oKey.clone().concat(c));return d}})})()})});var Jl=b((Fi,Ql)=>{(function(t,e,r){typeof Fi=="object"?Ql.exports=Fi=e(Di(),Fs(),Yl()):typeof define=="function"&&define.amd?define(["./core","./sha256","./hmac"],e):e(t.CryptoJS)})(Fi,function(t){return t.HmacSHA256})});var Zl=b((Qw,Xl)=>{Xl.exports={INVALID_CONNECT_OPTIONS:"Invalid connect options supplied.",INVALID_CLIENT_ID_OPTION:'Invalid "clientId" (mqtt client id) option supplied.',INVALID_RECONNECT_TIMING:"Invalid reconnect timing options supplied.",INVALID_OFFLINE_QUEUEING_PARAMETERS:"Invalid offline queueing options supplied."}});var mr=b((Jw,eu)=>{eu.exports=function(t){return typeof t>"u"||t===null}});var ru=b((Xw,tu)=>{tu.exports={NO_KEY_OPTION:'No "keyPath" or "privateKey" option supplied.',NO_CERT_OPTION:'No "certPath" or "clientCert" option supplied.',NO_CA_OPTION:'No "caPath" or "caCert" option supplied.',INVALID_KEY_PATH_OPTION:'Invalid "keyPath" option supplied.',INVALID_CERT_PATH_OPTION:'Invalid "certPath" option supplied.',INVALID_CA_PATH_OPTION:'Invalid "caPath" option supplied.',INVALID_CLIENT_CERT_OPTION:'Invalid "clientCert" option supplied.',INVALID_PRIVATE_KEY_OPTION:'Invalid "privateKey" option supplied.',INVALID_CA_CERT_OPTION:'Invalid "caCert" option supplied.'}});var nu=b((Zw,iu)=>{var me=S("fs"),we=mr(),qe=ru();iu.exports=function(t){if(we(t.keyPath)&&we(t.privateKey))throw new Error(qe.NO_KEY_OPTION);if(we(t.certPath)&&we(t.clientCert))throw new Error(qe.NO_CERT_OPTION);if(we(t.caPath)&&we(t.caCert))throw new Error(qe.NO_CA_OPTION);if(!we(t.caCert))if(Buffer.isBuffer(t.caCert))t.ca=t.caCert;else if(me.existsSync(t.caCert))t.ca=me.readFileSync(t.caCert);else throw new Error(qe.INVALID_CA_CERT_OPTION);if(!we(t.privateKey))if(Buffer.isBuffer(t.privateKey))t.key=t.privateKey;else if(me.existsSync(t.privateKey))t.key=me.readFileSync(t.privateKey);else throw new Error(qe.INVALID_PRIVATE_KEY_OPTION);if(!we(t.clientCert))if(Buffer.isBuffer(t.clientCert))t.cert=t.clientCert;else if(me.existsSync(t.clientCert))t.cert=me.readFileSync(t.clientCert);else throw new Error(qe.INVALID_CLIENT_CERT_OPTION);if(me.existsSync(t.keyPath))t.key=me.readFileSync(t.keyPath);else if(!we(t.keyPath))throw new Error(qe.INVALID_KEY_PATH_OPTION);if(me.existsSync(t.certPath))t.cert=me.readFileSync(t.certPath);else if(!we(t.certPath))throw new Error(qe.INVALID_CERT_PATH_OPTION);if(me.existsSync(t.caPath))t.ca=me.readFileSync(t.caPath);else if(!we(t.caPath))throw new Error(qe.INVALID_CA_PATH_OPTION);t.requestCert=!0,t.rejectUnauthorized=!0}});var su=b((e0,qy)=>{qy.exports={name:"aws-iot-device-sdk",description:"AWS IoT Node.js SDK for Embedded Devices",version:"2.2.12",author:{name:"Amazon Web Services",email:"",url:"http://aws.amazon.com"},homepage:"https://github.com/aws/aws-iot-device-sdk-js",main:"index.js",engines:{node:">=4.0.0"},repository:{type:"git",url:"git://github.com/aws/aws-iot-device-sdk-js"},bugs:{url:"http://github.com/aws/aws-iot-device-sdk-js/issues"},license:"Apache-2.0",keywords:["api","amazon","aws","iot","mqtt"],dependencies:{"crypto-js":"4.0.0",minimist:"1.2.6",mqtt:"4.2.8","websocket-stream":"^5.5.2"},devDependencies:{gulp:"^3.9.0","gulp-beautify":"^2.0.0","gulp-concat":"^2.6.0","gulp-coverage":"^0.3.38","gulp-jscs":"^4.0.0","gulp-jshint":"^2.0.0","gulp-mocha":"^3.0.1",jshint:"^2.9.1","jshint-stylish":"^2.2.1",rewire:"^2.5.1",sinon:"^1.17.3"},scripts:{test:"node ./node_modules/gulp/bin/gulp.js test --verbose",browserize:"./scripts/browserize.sh",beautify:"node ./node_modules/gulp/bin/gulp.js beautify"}}});var au=b((t0,ou)=>{var Dy=S("tls");function Uy(t,e){var r;r=Dy.connect(e);function i(n){t.emit("error",n),r.end()}return s(i,"handleTLSerrors"),r.on("secureConnect",function(){r.authorized?r.removeListener("error",i):r.emit("error",new Error("TLS not authorized"))}),r.on("error",i),r}s(Uy,"buildBuilder");ou.exports=Uy});var Ws=b((r0,fu)=>{"use strict";var jy=Object.prototype.hasOwnProperty,Fy=0;function wt(t){if(!(this instanceof wt))return new wt(t);this.id=Fy++,this.ee=t}s(wt,"Ultron");wt.prototype.on=s(function(e,r,i){return r.__ultron=this.id,this.ee.on(e,r,i),this},"on");wt.prototype.once=s(function(e,r,i){return r.__ultron=this.id,this.ee.once(e,r,i),this},"once");wt.prototype.remove=s(function(){var e=arguments,r=this.ee,i;if(e.length===1&&typeof e[0]=="string")e=e[0].split(/[, ]+/);else if(!e.length){if(r.eventNames)e=r.eventNames();else if(r._events){e=[];for(i in r._events)jy.call(r._events,i)&&e.push(i);Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(r._events)))}}for(var n=0;n<e.length;n++)for(var o=r.listeners(e[n]),a=0;a<o.length;a++){if(i=o[a],i.listener){if(i.listener.__ultron!==this.id)continue}else if(i.__ultron!==this.id)continue;r.removeListener(e[n],i)}return this},"remove");wt.prototype.destroy=s(function(){return this.ee?(this.remove(),this.ee=null,!0):!1},"destroy");fu.exports=wt});var St=b((Vs,uu)=>{var Wi=S("buffer"),De=Wi.Buffer;function lu(t,e){for(var r in t)e[r]=t[r]}s(lu,"copyProps");De.from&&De.alloc&&De.allocUnsafe&&De.allocUnsafeSlow?uu.exports=Wi:(lu(Wi,Vs),Vs.Buffer=qt);function qt(t,e,r){return De(t,e,r)}s(qt,"SafeBuffer");lu(De,qt);qt.from=function(t,e,r){if(typeof t=="number")throw new TypeError("Argument must not be a number");return De(t,e,r)};qt.alloc=function(t,e,r){if(typeof t!="number")throw new TypeError("Argument must be a number");var i=De(t);return e!==void 0?typeof r=="string"?i.fill(e,r):i.fill(e):i.fill(0),i};qt.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return De(t)};qt.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return Wi.SlowBuffer(t)}});var hu=b((i0,cu)=>{"use strict";function Et(t){if(!(this instanceof Et))return new Et(t);t=t||{},this.concurrency=t.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=Vy.bind(this)}s(Et,"Queue");var Wy=["push","unshift","splice"];Wy.forEach(function(t){Et.prototype[t]=function(){var e=Array.prototype[t].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(Et.prototype,"length",{get:function(){return this.pending+this.jobs.length}});Et.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var t=this.jobs.shift();this.pending++,t(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};Et.prototype.onDone=function(t){typeof t=="function"&&(this.cbs.push(t),this._run())};function Vy(){this.pending--,this._run()}s(Vy,"done");cu.exports=Et});var Vi=b((n0,Hs)=>{"use strict";var Hy=St(),$y=Hy.Buffer,du=s((t,e)=>{let r=$y.allocUnsafe(e);for(var i=0,n=0;n<t.length;n++){let o=t[n];o.copy(r,i),i+=o.length}return r},"concat");try{let t=S("bufferutil");Hs.exports=Object.assign({concat:du},t.BufferUtil||t)}catch{let e=s((i,n,o,a,l)=>{for(var f=0;f<l;f++)o[a+f]=i[f]^n[f&3]},"mask"),r=s((i,n)=>{let o=i.length;for(var a=0;a<o;a++)i[a]^=n[a&3]},"unmask");Hs.exports={concat:du,mask:e,unmask:r}}});var wr=b((s0,bu)=>{"use strict";var Gy=St(),zy=hu(),st=S("zlib"),pu=Vi(),_u=Gy.Buffer,Ky=_u.from([0,0,255,255]),Yy=_u.from([0]),Dt=Symbol("write-in-progress"),Hi=Symbol("pending-close"),Ue=Symbol("total-length"),gu=Symbol("callback"),ot=Symbol("buffers"),$s=Symbol("error"),zi=Symbol("owner"),$i,Gi=class{constructor(e,r,i){if(this._maxPayload=i|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!$i){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;$i=new zy({concurrency:n})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){e=this.normalizeParams(e);var r;return this._isServer?r=this.acceptAsServer(e):r=this.acceptAsClient(e),this.params=r,r}cleanup(){this._inflate&&(this._inflate[Dt]?this._inflate[Hi]=!0:(this._inflate.close(),this._inflate=null)),this._deflate&&(this._deflate[Dt]?this._deflate[Hi]=!0:(this._deflate.close(),this._deflate=null))}acceptAsServer(e){let r={};if(!e.some(n=>{if(!(this._options.serverNoContextTakeover===!1&&n.server_no_context_takeover||this._options.serverMaxWindowBits===!1&&n.server_max_window_bits||typeof this._options.serverMaxWindowBits=="number"&&typeof n.server_max_window_bits=="number"&&this._options.serverMaxWindowBits>n.server_max_window_bits||typeof this._options.clientMaxWindowBits=="number"&&!n.client_max_window_bits))return(this._options.serverNoContextTakeover||n.server_no_context_takeover)&&(r.server_no_context_takeover=!0),(this._options.clientNoContextTakeover||this._options.clientNoContextTakeover!==!1&&n.client_no_context_takeover)&&(r.client_no_context_takeover=!0),typeof this._options.serverMaxWindowBits=="number"?r.server_max_window_bits=this._options.serverMaxWindowBits:typeof n.server_max_window_bits=="number"&&(r.server_max_window_bits=n.server_max_window_bits),typeof this._options.clientMaxWindowBits=="number"?r.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits!==!1&&typeof n.client_max_window_bits=="number"&&(r.client_max_window_bits=n.client_max_window_bits),!0}))throw new Error("Doesn't support the offered configuration");return r}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Invalid value for "client_no_context_takeover"');if(typeof this._options.clientMaxWindowBits=="number"&&(!r.client_max_window_bits||r.client_max_window_bits>this._options.clientMaxWindowBits)||this._options.clientMaxWindowBits===!1&&r.client_max_window_bits)throw new Error('Invalid value for "client_max_window_bits"');return r}normalizeParams(e){return e.map(r=>(Object.keys(r).forEach(i=>{var n=r[i];if(n.length>1)throw new Error(`Multiple extension parameters for ${i}`);switch(n=n[0],i){case"server_no_context_takeover":case"client_no_context_takeover":if(n!==!0)throw new Error(`invalid extension parameter value for ${i} (${n})`);r[i]=!0;break;case"server_max_window_bits":case"client_max_window_bits":if(typeof n=="string"&&(n=parseInt(n,10),Number.isNaN(n)||n<st.Z_MIN_WINDOWBITS||n>st.Z_MAX_WINDOWBITS))throw new Error(`invalid extension parameter value for ${i} (${n})`);if(!this._isServer&&n===!0)throw new Error(`Missing extension parameter value for ${i}`);r[i]=n;break;default:throw new Error(`Not defined extension parameter (${i})`)}}),r))}decompress(e,r,i){$i.push(n=>{this._decompress(e,r,(o,a)=>{n(),i(o,a)})})}compress(e,r,i){$i.push(n=>{this._compress(e,r,(o,a)=>{n(),i(o,a)})})}_decompress(e,r,i){let n=this._isServer?"client":"server";if(!this._inflate){let o=`${n}_max_window_bits`,a=typeof this.params[o]!="number"?st.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=st.createInflateRaw({windowBits:a}),this._inflate[Ue]=0,this._inflate[ot]=[],this._inflate[zi]=this,this._inflate.on("error",Jy),this._inflate.on("data",yu)}this._inflate[gu]=i,this._inflate[Dt]=!0,this._inflate.write(e),r&&this._inflate.write(Ky),this._inflate.flush(()=>{let o=this._inflate[$s];if(o){this._inflate.close(),this._inflate=null,i(o);return}let a=pu.concat(this._inflate[ot],this._inflate[Ue]);r&&this.params[`${n}_no_context_takeover`]||this._inflate[Hi]?(this._inflate.close(),this._inflate=null):(this._inflate[Dt]=!1,this._inflate[Ue]=0,this._inflate[ot]=[]),i(null,a)})}_compress(e,r,i){if(!e||e.length===0){process.nextTick(i,null,Yy);return}let n=this._isServer?"server":"client";if(!this._deflate){let o=`${n}_max_window_bits`,a=typeof this.params[o]!="number"?st.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=st.createDeflateRaw({memLevel:this._options.memLevel,level:this._options.level,flush:st.Z_SYNC_FLUSH,windowBits:a}),this._deflate[Ue]=0,this._deflate[ot]=[],this._deflate.on("data",Qy)}this._deflate[Dt]=!0,this._deflate.write(e),this._deflate.flush(st.Z_SYNC_FLUSH,()=>{var o=pu.concat(this._deflate[ot],this._deflate[Ue]);r&&(o=o.slice(0,o.length-4)),r&&this.params[`${n}_no_context_takeover`]||this._deflate[Hi]?(this._deflate.close(),this._deflate=null):(this._deflate[Dt]=!1,this._deflate[Ue]=0,this._deflate[ot]=[]),i(null,o)})}};s(Gi,"PerMessageDeflate");bu.exports=Gi;function Qy(t){this[ot].push(t),this[Ue]+=t.length}s(Qy,"deflateOnData");function yu(t){if(this[Ue]+=t.length,this[zi]._maxPayload<1||this[Ue]<=this[zi]._maxPayload){this[ot].push(t);return}this[$s]=new Error("max payload size exceeded"),this[$s].closeCode=1009,this.removeListener("data",yu),this.reset()}s(yu,"inflateOnData");function Jy(t){this[zi]._inflate=null,this[gu](t)}s(Jy,"inflateOnError")});var mu=b((o0,vu)=>{"use strict";var Ut=class{constructor(e,r){this.target=r,this.type=e}};s(Ut,"Event");var Ki=class extends Ut{constructor(e,r){super("message",r),this.data=e}};s(Ki,"MessageEvent");var Yi=class extends Ut{constructor(e,r,i){super("close",i),this.wasClean=i._closeFrameReceived&&i._closeFrameSent,this.reason=r,this.code=e}};s(Yi,"CloseEvent");var Qi=class extends Ut{constructor(e){super("open",e)}};s(Qi,"OpenEvent");var Xy={addEventListener(t,e){if(typeof e!="function")return;function r(a){e.call(this,new Ki(a,this))}s(r,"onMessage");function i(a,l){e.call(this,new Yi(a,l,this))}s(i,"onClose");function n(a){a.type="error",a.target=this,e.call(this,a)}s(n,"onError");function o(){e.call(this,new Qi(this))}s(o,"onOpen"),t==="message"?(r._listener=e,this.on(t,r)):t==="close"?(i._listener=e,this.on(t,i)):t==="error"?(n._listener=e,this.on(t,n)):t==="open"?(o._listener=e,this.on(t,o)):this.on(t,e)},removeEventListener(t,e){let r=this.listeners(t);for(var i=0;i<r.length;i++)(r[i]===e||r[i]._listener===e)&&this.removeListener(t,r[i])}};vu.exports=Xy});var Gs=b((a0,wu)=>{"use strict";var Sr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Re(t,e,r){Object.prototype.hasOwnProperty.call(t,e)?t[e].push(r):t[e]=[r]}s(Re,"push");function Zy(t){let e={};if(t===void 0||t==="")return e;for(var r={},i=!1,n=!1,o=!1,a,l,f=-1,u=-1,c=0;c<t.length;c++){let p=t.charCodeAt(c);if(a===void 0)if(u===-1&&Sr[p]===1)f===-1&&(f=c);else if(p===32||p===9)u===-1&&f!==-1&&(u=c);else if(p===59||p===44){if(f===-1)throw new Error(`unexpected character at index ${c}`);u===-1&&(u=c);let g=t.slice(f,u);p===44?(Re(e,g,r),r={}):a=g,f=u=-1}else throw new Error(`unexpected character at index ${c}`);else if(l===void 0)if(u===-1&&Sr[p]===1)f===-1&&(f=c);else if(p===32||p===9)u===-1&&f!==-1&&(u=c);else if(p===59||p===44){if(f===-1)throw new Error(`unexpected character at index ${c}`);u===-1&&(u=c),Re(r,t.slice(f,u),!0),p===44&&(Re(e,a,r),r={},a=void 0),f=u=-1}else if(p===61&&f!==-1&&u===-1)l=t.slice(f,c),f=u=-1;else throw new Error(`unexpected character at index ${c}`);else if(n){if(Sr[p]!==1)throw new Error(`unexpected character at index ${c}`);f===-1?f=c:i||(i=!0),n=!1}else if(o)if(Sr[p]===1)f===-1&&(f=c);else if(p===34&&f!==-1)o=!1,u=c;else if(p===92)n=!0;else throw new Error(`unexpected character at index ${c}`);else if(p===34&&t.charCodeAt(c-1)===61)o=!0;else if(u===-1&&Sr[p]===1)f===-1&&(f=c);else if(f!==-1&&(p===32||p===9))u===-1&&(u=c);else if(p===59||p===44){if(f===-1)throw new Error(`unexpected character at index ${c}`);u===-1&&(u=c);var d=t.slice(f,u);i&&(d=d.replace(/\\/g,""),i=!1),Re(r,l,d),p===44&&(Re(e,a,r),r={},a=void 0),l=void 0,f=u=-1}else throw new Error(`unexpected character at index ${c}`)}if(f===-1||o)throw new Error("unexpected end of input");u===-1&&(u=c);let h=t.slice(f,u);return a===void 0?Re(e,h,{}):(l===void 0?Re(r,h,!0):i?Re(r,l,h.replace(/\\/g,"")):Re(r,l,h),Re(e,a,r)),e}s(Zy,"parse");function eb(t){return Object.keys(t).map(e=>{var r=t[e];return Array.isArray(r)||(r=[r]),r.map(i=>[e].concat(Object.keys(i).map(n=>{var o=i[n];return Array.isArray(o)||(o=[o]),o.map(a=>a===!0?n:`${n}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")}s(eb,"format");wu.exports={format:eb,parse:Zy}});var xr=b(Er=>{"use strict";var tb=St(),rb=tb.Buffer;Er.BINARY_TYPES=["nodebuffer","arraybuffer","fragments"];Er.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";Er.EMPTY_BUFFER=rb.alloc(0);Er.NOOP=()=>{}});var Su=b((l0,zs)=>{"use strict";try{let t=S("utf-8-validate");zs.exports=typeof t=="object"?t.Validation.isValidUTF8:t}catch{zs.exports=()=>!0}});var Ks=b((u0,Eu)=>{"use strict";Eu.exports={isValidErrorCode:function(t){return t>=1e3&&t<=1013&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999},1e3:"normal",1001:"going away",1002:"protocol error",1003:"unsupported data",1004:"reserved",1005:"reserved for extensions",1006:"reserved for extensions",1007:"inconsistent or invalid data",1008:"policy violation",1009:"message too big",1010:"extension handshake missing",1011:"an unexpected condition prevented the request from being fulfilled",1012:"service restart",1013:"try again later"}});var Xs=b((c0,ku)=>{"use strict";var ib=St(),xu=wr(),Cu=Su(),Au=Vi(),nb=Ks(),Js=xr(),sb=ib.Buffer,Ji=0,Tu=1,Iu=2,Ou=3,Ys=4,Ru=5,Xi=class{constructor(e,r,i){this._binaryType=i||Js.BINARY_TYPES[0],this._extensions=e||{},this._maxPayload=r|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._fragmented=0,this._masked=!1,this._fin=!1,this._mask=null,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._cleanupCallback=null,this._hadError=!1,this._dead=!1,this._loop=!1,this.onmessage=null,this.onclose=null,this.onerror=null,this.onping=null,this.onpong=null,this._state=Ji}readBuffer(e){var r=0,i,n;if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length)return i=this._buffers[0].slice(0,e),this._buffers[0]=this._buffers[0].slice(e),i;for(i=sb.allocUnsafe(e);e>0;)n=this._buffers[0].length,e>=n?(this._buffers[0].copy(i,r),r+=n,this._buffers.shift()):(this._buffers[0].copy(i,r,0,e),this._buffers[0]=this._buffers[0].slice(e)),e-=n;return i}hasBufferedBytes(e){return this._bufferedBytes>=e?!0:(this._loop=!1,this._dead&&this.cleanup(this._cleanupCallback),!1)}add(e){this._dead||(this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop())}startLoop(){for(this._loop=!0;this._loop;)switch(this._state){case Ji:this.getInfo();break;case Tu:this.getPayloadLength16();break;case Iu:this.getPayloadLength64();break;case Ou:this.getMask();break;case Ys:this.getData();break;default:this._loop=!1}}getInfo(){if(!this.hasBufferedBytes(2))return;let e=this.readBuffer(2);if((e[0]&48)!==0){this.error(new Error("RSV2 and RSV3 must be clear"),1002);return}let r=(e[0]&64)===64;if(r&&!this._extensions[xu.extensionName]){this.error(new Error("RSV1 must be clear"),1002);return}if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(r){this.error(new Error("RSV1 must be clear"),1002);return}if(this._fragmented)this._opcode=this._fragmented;else{this.error(new Error(`invalid opcode: ${this._opcode}`),1002);return}}else if(this._opcode===1||this._opcode===2){if(this._fragmented){this.error(new Error(`invalid opcode: ${this._opcode}`),1002);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){this.error(new Error("FIN must be set"),1002);return}if(r){this.error(new Error("RSV1 must be clear"),1002);return}if(this._payloadLength>125){this.error(new Error("invalid payload length"),1002);return}}else{this.error(new Error(`invalid opcode: ${this._opcode}`),1002);return}!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126?this._state=Tu:this._payloadLength===127?this._state=Iu:this.haveLength()}getPayloadLength16(){!this.hasBufferedBytes(2)||(this._payloadLength=this.readBuffer(2).readUInt16BE(0,!0),this.haveLength())}getPayloadLength64(){if(!this.hasBufferedBytes(8))return;let e=this.readBuffer(8),r=e.readUInt32BE(0,!0);if(r>Math.pow(2,53-32)-1){this.error(new Error("max payload size exceeded"),1009);return}this._payloadLength=r*Math.pow(2,32)+e.readUInt32BE(4,!0),this.haveLength()}haveLength(){this._opcode<8&&this.maxPayloadExceeded(this._payloadLength)||(this._masked?this._state=Ou:this._state=Ys)}getMask(){!this.hasBufferedBytes(4)||(this._mask=this.readBuffer(4),this._state=Ys)}getData(){var e=Js.EMPTY_BUFFER;if(this._payloadLength){if(!this.hasBufferedBytes(this._payloadLength))return;e=this.readBuffer(this._payloadLength),this._masked&&Au.unmask(e,this._mask)}this._opcode>7?this.controlMessage(e):this._compressed?(this._state=Ru,this.decompress(e)):this.pushFragment(e)&&this.dataMessage()}decompress(e){this._extensions[xu.extensionName].decompress(e,this._fin,(i,n)=>{if(i){this.error(i,i.closeCode===1009?1009:1007);return}this.pushFragment(n)&&this.dataMessage(),this.startLoop()})}dataMessage(){if(this._fin){let r=this._messageLength,i=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=Qs(i,r):this._binaryType==="arraybuffer"?e=ob(Qs(i,r)):e=i,this.onmessage(e)}else{let n=Qs(i,r);if(!Cu(n)){this.error(new Error("invalid utf8 sequence"),1007);return}this.onmessage(n.toString())}}this._state=Ji}controlMessage(e){if(this._opcode===8){if(e.length===0)this.onclose(1e3,""),this._loop=!1,this.cleanup(this._cleanupCallback);else if(e.length===1)this.error(new Error("invalid payload length"),1002);else{let r=e.readUInt16BE(0,!0);if(!nb.isValidErrorCode(r)){this.error(new Error(`invalid status code: ${r}`),1002);return}let i=e.slice(2);if(!Cu(i)){this.error(new Error("invalid utf8 sequence"),1007);return}this.onclose(r,i.toString()),this._loop=!1,this.cleanup(this._cleanupCallback)}return}this._opcode===9?this.onping(e):this.onpong(e),this._state=Ji}error(e,r){this.onerror(e,r),this._hadError=!0,this._loop=!1,this.cleanup(this._cleanupCallback)}maxPayloadExceeded(e){if(e===0||this._maxPayload<1)return!1;let r=this._totalPayloadLength+e;return r<=this._maxPayload?(this._totalPayloadLength=r,!1):(this.error(new Error("max payload size exceeded"),1009),!0)}pushFragment(e){if(e.length===0)return!0;let r=this._messageLength+e.length;return this._maxPayload<1||r<=this._maxPayload?(this._messageLength=r,this._fragments.push(e),!0):(this.error(new Error("max payload size exceeded"),1009),!1)}cleanup(e){this._dead=!0,!this._hadError&&(this._loop||this._state===Ru)?this._cleanupCallback=e:(this._extensions=null,this._fragments=null,this._buffers=null,this._mask=null,this._cleanupCallback=null,this.onmessage=null,this.onclose=null,this.onerror=null,this.onping=null,this.onpong=null,e&&e())}};s(Xi,"Receiver");ku.exports=Xi;function Qs(t,e){return t.length===1?t[0]:t.length>1?Au.concat(t,e):Js.EMPTY_BUFFER}s(Qs,"toBuffer");function ob(t){return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}s(ob,"toArrayBuffer")});var eo=b((h0,Nu)=>{"use strict";var ab=St(),fb=S("crypto"),Bu=wr(),Pu=Vi(),lb=Ks(),ub=xr(),ue=ab.Buffer,xe=class{constructor(e,r){this._extensions=r||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,r){let i=e.length<1024||r.mask&&r.readOnly;var n=r.mask?6:2,o=e.length;e.length>=65536?(n+=8,o=127):e.length>125&&(n+=2,o=126);let a=ue.allocUnsafe(i?e.length+n:n);if(a[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(a[0]|=64),o===126?a.writeUInt16BE(e.length,2,!0):o===127&&(a.writeUInt32BE(0,2,!0),a.writeUInt32BE(e.length,6,!0)),!r.mask)return a[1]=o,i?(e.copy(a,n),[a]):[a,e];let l=fb.randomBytes(4);return a[1]=o|128,a[n-4]=l[0],a[n-3]=l[1],a[n-2]=l[2],a[n-1]=l[3],i?(Pu.mask(e,l,a,n,e.length),[a]):(Pu.mask(e,l,e,0,e.length),[a,e])}close(e,r,i,n){var o;if(e===void 0)e=1e3;else if(typeof e!="number"||!lb.isValidErrorCode(e))throw new Error("first argument must be a valid error code number");r===void 0||r===""?e===1e3?o=ub.EMPTY_BUFFER:(o=ue.allocUnsafe(2),o.writeUInt16BE(e,0,!0)):(o=ue.allocUnsafe(2+ue.byteLength(r)),o.writeUInt16BE(e,0,!0),o.write(r,2)),this._deflating?this.enqueue([this.doClose,o,i,n]):this.doClose(o,i,n)}doClose(e,r,i){this.sendFrame(xe.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:r,readOnly:!1}),i)}ping(e,r){var i=!0;ue.isBuffer(e)||(e instanceof ArrayBuffer?e=ue.from(e):ArrayBuffer.isView(e)?e=Zs(e):(e=ue.from(e),i=!1)),this._deflating?this.enqueue([this.doPing,e,r,i]):this.doPing(e,r,i)}doPing(e,r,i){this.sendFrame(xe.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:r,readOnly:i}))}pong(e,r){var i=!0;ue.isBuffer(e)||(e instanceof ArrayBuffer?e=ue.from(e):ArrayBuffer.isView(e)?e=Zs(e):(e=ue.from(e),i=!1)),this._deflating?this.enqueue([this.doPong,e,r,i]):this.doPong(e,r,i)}doPong(e,r,i){this.sendFrame(xe.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:r,readOnly:i}))}send(e,r,i){var n=r.binary?2:1,o=r.compress,a=!0;ue.isBuffer(e)||(e instanceof ArrayBuffer?e=ue.from(e):ArrayBuffer.isView(e)?e=Zs(e):(e=ue.from(e),a=!1));let l=this._extensions[Bu.extensionName];if(this._firstFragment?(this._firstFragment=!1,o&&l&&(o=e.length>=l._threshold),this._compress=o):(o=!1,n=0),r.fin&&(this._firstFragment=!0),l){let f={fin:r.fin,rsv1:o,opcode:n,mask:r.mask,readOnly:a};this._deflating?this.enqueue([this.dispatch,e,this._compress,f,i]):this.dispatch(e,this._compress,f,i)}else this.sendFrame(xe.frame(e,{fin:r.fin,rsv1:!1,opcode:n,mask:r.mask,readOnly:a}),i)}dispatch(e,r,i,n){if(!r){this.sendFrame(xe.frame(e,i),n);return}let o=this._extensions[Bu.extensionName];this._deflating=!0,o.compress(e,i.fin,(a,l)=>{i.readOnly=!1,this.sendFrame(xe.frame(l,i),n),this._deflating=!1,this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.write(e[0]),this._socket.write(e[1],r)):this._socket.write(e[0],r)}};s(xe,"Sender");Nu.exports=xe;function Zs(t){let e=ue.from(t.buffer);return t.byteLength!==t.buffer.byteLength?e.slice(t.byteOffset,t.byteOffset+t.byteLength):e}s(Zs,"viewToBuffer")});var ro=b((d0,Du)=>{"use strict";var cb=S("events"),Mu=S("crypto"),hb=Ws(),db=S("https"),pb=S("http"),_b=S("url"),at=wr(),qu=mu(),Lu=Gs(),xt=xr(),gb=Xs(),yb=eo(),to=[8,13],bb=30*1e3,D=class extends cb{constructor(e,r,i){super(),r?typeof r=="string"?r=[r]:Array.isArray(r)||(i=r,r=[]):r=[],this.readyState=D.CONNECTING,this.bytesReceived=0,this.extensions={},this.protocol="",this._binaryType=xt.BINARY_TYPES[0],this._finalize=this.finalize.bind(this),this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._finalized=!1,this._closeCode=1006,this._receiver=null,this._sender=null,this._socket=null,this._ultron=null,Array.isArray(e)?vb.call(this,e[0],e[1],i):mb.call(this,e,r,i)}get CONNECTING(){return D.CONNECTING}get CLOSING(){return D.CLOSING}get CLOSED(){return D.CLOSED}get OPEN(){return D.OPEN}get bufferedAmount(){var e=0;return this._socket&&(e=this._socket.bufferSize+this._sender._bufferedBytes),e}get binaryType(){return this._binaryType}set binaryType(e){xt.BINARY_TYPES.indexOf(e)<0||(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}setSocket(e,r){e.setTimeout(0),e.setNoDelay(),this._receiver=new gb(this.extensions,this._maxPayload,this.binaryType),this._sender=new yb(e,this.extensions),this._ultron=new hb(e),this._socket=e,this._ultron.on("close",this._finalize),this._ultron.on("error",this._finalize),this._ultron.on("end",this._finalize),r.length>0&&e.unshift(r),this._ultron.on("data",i=>{this.bytesReceived+=i.length,this._receiver.add(i)}),this._receiver.onmessage=i=>this.emit("message",i),this._receiver.onping=i=>{this.pong(i,!this._isServer,!0),this.emit("ping",i)},this._receiver.onpong=i=>this.emit("pong",i),this._receiver.onclose=(i,n)=>{this._closeFrameReceived=!0,this._closeMessage=n,this._closeCode=i,this._finalized||this.close(i,n)},this._receiver.onerror=(i,n)=>{this._closeMessage="",this._closeCode=n,this.readyState=D.CLOSING,this.emit("error",i),this.finalize(!0)},this.readyState=D.OPEN,this.emit("open")}finalize(e){if(!this._finalized){if(this.readyState=D.CLOSING,this._finalized=!0,typeof e=="object"&&this.emit("error",e),!this._socket)return this.emitClose();clearTimeout(this._closeTimer),this._closeTimer=null,this._ultron.destroy(),this._ultron=null,this._socket.on("error",xt.NOOP),e?this._socket.destroy():this._socket.end(),this._socket=null,this._sender=null,this._receiver.cleanup(()=>this.emitClose()),this._receiver=null}}emitClose(){this.readyState=D.CLOSED,this.emit("close",this._closeCode,this._closeMessage),this.extensions[at.extensionName]&&this.extensions[at.extensionName].cleanup(),this.extensions=null,this.removeAllListeners()}pause(){if(this.readyState!==D.OPEN)throw new Error("not opened");this._socket.pause()}resume(){if(this.readyState!==D.OPEN)throw new Error("not opened");this._socket.resume()}close(e,r){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING){this._req.abort(),this.finalize(new Error("closed before the connection is established"));return}if(this.readyState===D.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=D.CLOSING,this._sender.close(e,r,!this._isServer,i=>{i||(this._closeFrameSent=!0,this._finalized||(this._closeFrameReceived&&this._socket.end(),this._closeTimer=setTimeout(this._finalize,bb,!0)))})}}ping(e,r,i){if(this.readyState!==D.OPEN){if(i)return;throw new Error("not opened")}typeof e=="number"&&(e=e.toString()),r===void 0&&(r=!this._isServer),this._sender.ping(e||xt.EMPTY_BUFFER,r)}pong(e,r,i){if(this.readyState!==D.OPEN){if(i)return;throw new Error("not opened")}typeof e=="number"&&(e=e.toString()),r===void 0&&(r=!this._isServer),this._sender.pong(e||xt.EMPTY_BUFFER,r)}send(e,r,i){if(typeof r=="function"&&(i=r,r={}),this.readyState!==D.OPEN){if(i)i(new Error("not opened"));else throw new Error("not opened");return}typeof e=="number"&&(e=e.toString());let n=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},r);this.extensions[at.extensionName]||(n.compress=!1),this._sender.send(e||xt.EMPTY_BUFFER,n,i)}terminate(){if(this.readyState!==D.CLOSED){if(this.readyState===D.CONNECTING){this._req.abort(),this.finalize(new Error("closed before the connection is established"));return}this.finalize(!0)}}};s(D,"WebSocket");D.CONNECTING=0;D.OPEN=1;D.CLOSING=2;D.CLOSED=3;["open","error","close","message"].forEach(t=>{Object.defineProperty(D.prototype,`on${t}`,{get(){let e=this.listeners(t);for(var r=0;r<e.length;r++)if(e[r]._listener)return e[r]._listener},set(e){let r=this.listeners(t);for(var i=0;i<r.length;i++)r[i]._listener&&this.removeListener(t,r[i]);this.addEventListener(t,e)}})});D.prototype.addEventListener=qu.addEventListener;D.prototype.removeEventListener=qu.removeEventListener;Du.exports=D;function vb(t,e,r){this.protocolVersion=r.protocolVersion,this._maxPayload=r.maxPayload,this.extensions=r.extensions,this.protocol=r.protocol,this._isServer=!0,this.setSocket(t,e)}s(vb,"initAsServerClient");function mb(t,e,r){if(r=Object.assign({protocolVersion:to[1],protocol:e.join(","),perMessageDeflate:!0,handshakeTimeout:null,localAddress:null,headers:null,family:null,origin:null,agent:null,host:null,checkServerIdentity:null,rejectUnauthorized:null,passphrase:null,ciphers:null,ecdhCurve:null,cert:null,key:null,pfx:null,ca:null},r),to.indexOf(r.protocolVersion)===-1)throw new Error(`unsupported protocol version: ${r.protocolVersion} (supported versions: ${to.join(", ")})`);this.protocolVersion=r.protocolVersion,this._isServer=!1,this.url=t;let i=_b.parse(t),n=i.protocol==="ws+unix:";if(!i.host&&(!n||!i.path))throw new Error("invalid url");let o=i.protocol==="wss:"||i.protocol==="https:",a=Mu.randomBytes(16).toString("base64"),l=o?db:pb;var f;let u={port:i.port||(o?443:80),host:i.hostname,path:"/",headers:{"Sec-WebSocket-Version":r.protocolVersion,"Sec-WebSocket-Key":a,Connection:"Upgrade",Upgrade:"websocket"}};if(r.headers&&Object.assign(u.headers,r.headers),r.perMessageDeflate&&(f=new at(r.perMessageDeflate!==!0?r.perMessageDeflate:{},!1),u.headers["Sec-WebSocket-Extensions"]=Lu.format({[at.extensionName]:f.offer()})),r.protocol&&(u.headers["Sec-WebSocket-Protocol"]=r.protocol),r.origin&&(r.protocolVersion<13?u.headers["Sec-WebSocket-Origin"]=r.origin:u.headers.Origin=r.origin),r.host&&(u.headers.Host=r.host),i.auth&&(u.auth=i.auth),r.localAddress&&(u.localAddress=r.localAddress),r.family&&(u.family=r.family),n){let d=i.path.split(":");u.socketPath=d[0],u.path=d[1]}else i.path&&(i.path.charAt(0)!=="/"?u.path=`/${i.path}`:u.path=i.path);var c=r.agent;(r.rejectUnauthorized!=null||r.checkServerIdentity||r.passphrase||r.ciphers||r.ecdhCurve||r.cert||r.key||r.pfx||r.ca)&&(r.passphrase&&(u.passphrase=r.passphrase),r.ciphers&&(u.ciphers=r.ciphers),r.ecdhCurve&&(u.ecdhCurve=r.ecdhCurve),r.cert&&(u.cert=r.cert),r.key&&(u.key=r.key),r.pfx&&(u.pfx=r.pfx),r.ca&&(u.ca=r.ca),r.checkServerIdentity&&(u.checkServerIdentity=r.checkServerIdentity),r.rejectUnauthorized!=null&&(u.rejectUnauthorized=r.rejectUnauthorized),c||(c=new l.Agent(u))),c&&(u.agent=c),this._req=l.get(u),r.handshakeTimeout&&this._req.setTimeout(r.handshakeTimeout,()=>{this._req.abort(),this.finalize(new Error("opening handshake has timed out"))}),this._req.on("error",d=>{this._req.aborted||(this._req=null,this.finalize(d))}),this._req.on("response",d=>{this.emit("unexpected-response",this._req,d)||(this._req.abort(),this.finalize(new Error(`unexpected server response (${d.statusCode})`)))}),this._req.on("upgrade",(d,h,p)=>{if(this.emit("headers",d.headers,d),this.readyState!==D.CONNECTING)return;this._req=null;let g=Mu.createHash("sha1").update(a+xt.GUID,"binary").digest("base64");if(d.headers["sec-websocket-accept"]!==g)return h.destroy(),this.finalize(new Error("invalid server key"));let m=d.headers["sec-websocket-protocol"],w=(r.protocol||"").split(/, */);var _;if(!r.protocol&&m?_="server sent a subprotocol even though none requested":r.protocol&&!m?_="server sent no subprotocol even though requested":m&&w.indexOf(m)===-1&&(_="server responded with an invalid protocol"),_)return h.destroy(),this.finalize(new Error(_));if(m&&(this.protocol=m),f)try{let y=Lu.parse(d.headers["sec-websocket-extensions"]);y[at.extensionName]&&(f.accept(y[at.extensionName]),this.extensions[at.extensionName]=f)}catch{h.destroy(),this.finalize(new Error("invalid Sec-WebSocket-Extensions header"));return}this.setSocket(h,p)})}s(mb,"initAsClient")});var Fu=b((p0,ju)=>{"use strict";var wb=St(),Sb=S("events"),Eb=S("crypto"),xb=Ws(),en=S("http"),Cb=S("url"),Ct=wr(),Uu=Gs(),Tb=xr(),Ib=ro(),Ob=wb.Buffer,Zi=class extends Sb{constructor(e,r){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError("missing or invalid options");e.port!=null?(this._server=en.createServer((i,n)=>{let o=en.STATUS_CODES[426];n.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),n.end(o)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server&&(this._ultron=new xb(this._server),this._ultron.on("listening",()=>this.emit("listening")),this._ultron.on("error",i=>this.emit("error",i)),this._ultron.on("upgrade",(i,n,o)=>{this.handleUpgrade(i,n,o,a=>{this.emit("connection",a,i)})})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}close(e){if(this.clients)for(let i of this.clients)i.terminate();let r=this._server;if(r&&(this._ultron.destroy(),this._ultron=this._server=null,this.options.port!=null))return r.close(e);e&&e()}shouldHandle(e){return!(this.options.path&&Cb.parse(e.url).pathname!==this.options.path)}handleUpgrade(e,r,i,n){r.on("error",io);let o=+e.headers["sec-websocket-version"],a={};if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!e.headers["sec-websocket-key"]||o!==8&&o!==13||!this.shouldHandle(e))return Cr(r,400);if(this.options.perMessageDeflate){let f=new Ct(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let u=Uu.parse(e.headers["sec-websocket-extensions"]);u[Ct.extensionName]&&(f.accept(u[Ct.extensionName]),a[Ct.extensionName]=f)}catch{return Cr(r,400)}}var l=(e.headers["sec-websocket-protocol"]||"").split(/, */);if(this.options.handleProtocols){if(l=this.options.handleProtocols(l,e),l===!1)return Cr(r,401)}else l=l[0];if(this.options.verifyClient){let f={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(f,(u,c,d)=>{if(!u)return Cr(r,c||401,d);this.completeUpgrade(l,a,o,e,r,i,n)});return}if(!this.options.verifyClient(f))return Cr(r,401)}this.completeUpgrade(l,a,o,e,r,i,n)}completeUpgrade(e,r,i,n,o,a,l){if(!o.readable||!o.writable)return o.destroy();let f=Eb.createHash("sha1").update(n.headers["sec-websocket-key"]+Tb.GUID,"binary").digest("base64"),u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${f}`];if(e&&u.push(`Sec-WebSocket-Protocol: ${e}`),r[Ct.extensionName]){let d=r[Ct.extensionName].params,h=Uu.format({[Ct.extensionName]:[d]});u.push(`Sec-WebSocket-Extensions: ${h}`)}this.emit("headers",u,n),o.write(u.concat(`\r
`).join(`\r
`));let c=new Ib([o,a],null,{maxPayload:this.options.maxPayload,protocolVersion:i,extensions:r,protocol:e});this.clients&&(this.clients.add(c),c.on("close",()=>this.clients.delete(c))),o.removeListener("error",io),l(c)}};s(Zi,"WebSocketServer");ju.exports=Zi;function io(){this.destroy()}s(io,"socketError");function Cr(t,e,r){t.writable&&(r=r||en.STATUS_CODES[e],t.write(`HTTP/1.1 ${e} ${en.STATUS_CODES[e]}\r
Connection: close\r
Content-type: text/html\r
Content-Length: ${Ob.byteLength(r)}\r
\r
`+r)),t.removeListener("error",io),t.destroy()}s(Cr,"abortConnection")});var no=b((_0,Wu)=>{"use strict";var tn=ro();tn.Server=Fu();tn.Receiver=Xs();tn.Sender=eo();Wu.exports=tn});var Hu=b((g0,Vu)=>{var Rb={}.toString;Vu.exports=Array.isArray||function(t){return Rb.call(t)=="[object Array]"}});var so=b((y0,$u)=>{$u.exports=S("stream")});var nn=b((oo,zu)=>{var rn=S("buffer"),je=rn.Buffer;function Gu(t,e){for(var r in t)e[r]=t[r]}s(Gu,"copyProps");je.from&&je.alloc&&je.allocUnsafe&&je.allocUnsafeSlow?zu.exports=rn:(Gu(rn,oo),oo.Buffer=jt);function jt(t,e,r){return je(t,e,r)}s(jt,"SafeBuffer");Gu(je,jt);jt.from=function(t,e,r){if(typeof t=="number")throw new TypeError("Argument must not be a number");return je(t,e,r)};jt.alloc=function(t,e,r){if(typeof t!="number")throw new TypeError("Argument must be a number");var i=je(t);return e!==void 0?typeof r=="string"?i.fill(e,r):i.fill(e):i.fill(0),i};jt.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return je(t)};jt.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return rn.SlowBuffer(t)}});var Ft=b(se=>{function Ab(t){return Array.isArray?Array.isArray(t):sn(t)==="[object Array]"}s(Ab,"isArray");se.isArray=Ab;function kb(t){return typeof t=="boolean"}s(kb,"isBoolean");se.isBoolean=kb;function Bb(t){return t===null}s(Bb,"isNull");se.isNull=Bb;function Pb(t){return t==null}s(Pb,"isNullOrUndefined");se.isNullOrUndefined=Pb;function Nb(t){return typeof t=="number"}s(Nb,"isNumber");se.isNumber=Nb;function Mb(t){return typeof t=="string"}s(Mb,"isString");se.isString=Mb;function Lb(t){return typeof t=="symbol"}s(Lb,"isSymbol");se.isSymbol=Lb;function qb(t){return t===void 0}s(qb,"isUndefined");se.isUndefined=qb;function Db(t){return sn(t)==="[object RegExp]"}s(Db,"isRegExp");se.isRegExp=Db;function Ub(t){return typeof t=="object"&&t!==null}s(Ub,"isObject");se.isObject=Ub;function jb(t){return sn(t)==="[object Date]"}s(jb,"isDate");se.isDate=jb;function Fb(t){return sn(t)==="[object Error]"||t instanceof Error}s(Fb,"isError");se.isError=Fb;function Wb(t){return typeof t=="function"}s(Wb,"isFunction");se.isFunction=Wb;function Vb(t){return t===null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||typeof t=="symbol"||typeof t>"u"}s(Vb,"isPrimitive");se.isPrimitive=Vb;se.isBuffer=S("buffer").Buffer.isBuffer;function sn(t){return Object.prototype.toString.call(t)}s(sn,"objectToString")});var Yu=b((v0,ao)=>{"use strict";function Hb(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}s(Hb,"_classCallCheck");var Ku=nn().Buffer,Tr=S("util");function $b(t,e,r){t.copy(e,r)}s($b,"copyBuffer");ao.exports=function(){function t(){Hb(this,t),this.head=null,this.tail=null,this.length=0}return s(t,"BufferList"),t.prototype.push=s(function(r){var i={data:r,next:null};this.length>0?this.tail.next=i:this.head=i,this.tail=i,++this.length},"push"),t.prototype.unshift=s(function(r){var i={data:r,next:this.head};this.length===0&&(this.tail=i),this.head=i,++this.length},"unshift"),t.prototype.shift=s(function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}},"shift"),t.prototype.clear=s(function(){this.head=this.tail=null,this.length=0},"clear"),t.prototype.join=s(function(r){if(this.length===0)return"";for(var i=this.head,n=""+i.data;i=i.next;)n+=r+i.data;return n},"join"),t.prototype.concat=s(function(r){if(this.length===0)return Ku.alloc(0);if(this.length===1)return this.head.data;for(var i=Ku.allocUnsafe(r>>>0),n=this.head,o=0;n;)$b(n.data,i,o),o+=n.data.length,n=n.next;return i},"concat"),t}();Tr&&Tr.inspect&&Tr.inspect.custom&&(ao.exports.prototype[Tr.inspect.custom]=function(){var t=Tr.inspect({length:this.length});return this.constructor.name+" "+t})});var fo=b((m0,Xu)=>{"use strict";var Qu=Mt();function Gb(t,e){var r=this,i=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return i||n?(e?e(t):t&&(!this._writableState||!this._writableState.errorEmitted)&&Qu.nextTick(Ju,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(o){!e&&o?(Qu.nextTick(Ju,r,o),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(o)}),this)}s(Gb,"destroy");function zb(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}s(zb,"undestroy");function Ju(t,e){t.emit("error",e)}s(Ju,"emitErrorNT");Xu.exports={destroy:Gb,undestroy:zb}});var uo=b((w0,oc)=>{"use strict";var Tt=Mt();oc.exports=Q;function ec(t){var e=this;this.next=null,this.entry=null,this.finish=function(){cv(e,t)}}s(ec,"CorkedRequest");var Kb=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:Tt.nextTick,Wt;Q.WritableState=Or;var tc=Object.create(Ft());tc.inherits=oe();var Yb={deprecate:Bn()},rc=so(),an=nn().Buffer,Qb=global.Uint8Array||function(){};function Jb(t){return an.from(t)}s(Jb,"_uint8ArrayToBuffer");function Xb(t){return an.isBuffer(t)||t instanceof Qb}s(Xb,"_isUint8Array");var ic=fo();tc.inherits(Q,rc);function Zb(){}s(Zb,"nop");function Or(t,e){Wt=Wt||It(),t=t||{};var r=e instanceof Wt;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,n=t.writableHighWaterMark,o=this.objectMode?16:16*1024;i||i===0?this.highWaterMark=i:r&&(n||n===0)?this.highWaterMark=n:this.highWaterMark=o,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=t.decodeStrings===!1;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(l){ov(e,l)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new ec(this)}s(Or,"WritableState");Or.prototype.getBuffer=s(function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r},"getBuffer");(function(){try{Object.defineProperty(Or.prototype,"buffer",{get:Yb.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var on;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(on=Function.prototype[Symbol.hasInstance],Object.defineProperty(Q,Symbol.hasInstance,{value:function(t){return on.call(this,t)?!0:this!==Q?!1:t&&t._writableState instanceof Or}})):on=s(function(t){return t instanceof this},"realHasInstance");function Q(t){if(Wt=Wt||It(),!on.call(Q,this)&&!(this instanceof Wt))return new Q(t);this._writableState=new Or(t,this),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),rc.call(this)}s(Q,"Writable");Q.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function ev(t,e){var r=new Error("write after end");t.emit("error",r),Tt.nextTick(e,r)}s(ev,"writeAfterEnd");function tv(t,e,r,i){var n=!0,o=!1;return r===null?o=new TypeError("May not write null values to stream"):typeof r!="string"&&r!==void 0&&!e.objectMode&&(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),Tt.nextTick(i,o),n=!1),n}s(tv,"validChunk");Q.prototype.write=function(t,e,r){var i=this._writableState,n=!1,o=!i.objectMode&&Xb(t);return o&&!an.isBuffer(t)&&(t=Jb(t)),typeof e=="function"&&(r=e,e=null),o?e="buffer":e||(e=i.defaultEncoding),typeof r!="function"&&(r=Zb),i.ended?ev(this,r):(o||tv(this,i,t,r))&&(i.pendingcb++,n=iv(this,i,o,t,e,r)),n};Q.prototype.cork=function(){var t=this._writableState;t.corked++};Q.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.finished&&!t.bufferProcessing&&t.bufferedRequest&&nc(this,t))};Q.prototype.setDefaultEncoding=s(function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},"setDefaultEncoding");function rv(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=an.from(e,r)),e}s(rv,"decodeChunk");Object.defineProperty(Q.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function iv(t,e,r,i,n,o){if(!r){var a=rv(e,i,n);i!==a&&(r=!0,n="buffer",i=a)}var l=e.objectMode?1:i.length;e.length+=l;var f=e.length<e.highWaterMark;if(f||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:o,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else lo(t,e,!1,l,i,n,o);return f}s(iv,"writeOrBuffer");function lo(t,e,r,i,n,o,a){e.writelen=i,e.writecb=a,e.writing=!0,e.sync=!0,r?t._writev(n,e.onwrite):t._write(n,o,e.onwrite),e.sync=!1}s(lo,"doWrite");function nv(t,e,r,i,n){--e.pendingcb,r?(Tt.nextTick(n,i),Tt.nextTick(Ir,t,e),t._writableState.errorEmitted=!0,t.emit("error",i)):(n(i),t._writableState.errorEmitted=!0,t.emit("error",i),Ir(t,e))}s(nv,"onwriteError");function sv(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}s(sv,"onwriteStateUpdate");function ov(t,e){var r=t._writableState,i=r.sync,n=r.writecb;if(sv(r),e)nv(t,r,i,e,n);else{var o=sc(r);!o&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&nc(t,r),i?Kb(Zu,t,r,o,n):Zu(t,r,o,n)}}s(ov,"onwrite");function Zu(t,e,r,i){r||av(t,e),e.pendingcb--,i(),Ir(t,e)}s(Zu,"afterWrite");function av(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}s(av,"onwriteDrain");function nc(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var i=e.bufferedRequestCount,n=new Array(i),o=e.corkedRequestsFree;o.entry=r;for(var a=0,l=!0;r;)n[a]=r,r.isBuf||(l=!1),r=r.next,a+=1;n.allBuffers=l,lo(t,e,!0,e.length,n,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new ec(e),e.bufferedRequestCount=0}else{for(;r;){var f=r.chunk,u=r.encoding,c=r.callback,d=e.objectMode?1:f.length;if(lo(t,e,!1,d,f,u,c),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}s(nc,"clearBuffer");Q.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))};Q.prototype._writev=null;Q.prototype.end=function(t,e,r){var i=this._writableState;typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),!i.ending&&!i.finished&&uv(this,i,r)};function sc(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}s(sc,"needFinish");function fv(t,e){t._final(function(r){e.pendingcb--,r&&t.emit("error",r),e.prefinished=!0,t.emit("prefinish"),Ir(t,e)})}s(fv,"callFinal");function lv(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"?(e.pendingcb++,e.finalCalled=!0,Tt.nextTick(fv,t,e)):(e.prefinished=!0,t.emit("prefinish")))}s(lv,"prefinish");function Ir(t,e){var r=sc(e);return r&&(lv(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"))),r}s(Ir,"finishMaybe");function uv(t,e,r){e.ending=!0,Ir(t,e),r&&(e.finished?Tt.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}s(uv,"endWritable");function cv(t,e,r){var i=t.entry;for(t.entry=null;i;){var n=i.callback;e.pendingcb--,n(r),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}s(cv,"onCorkedFinish");Object.defineProperty(Q.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){!this._writableState||(this._writableState.destroyed=t)}});Q.prototype.destroy=ic.destroy;Q.prototype._undestroy=ic.undestroy;Q.prototype._destroy=function(t,e){this.end(),e(t)}});var It=b((S0,uc)=>{"use strict";var ac=Mt(),hv=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};uc.exports=Fe;var fc=Object.create(Ft());fc.inherits=oe();var lc=po(),ho=uo();fc.inherits(Fe,lc);for(co=hv(ho.prototype),fn=0;fn<co.length;fn++)ln=co[fn],Fe.prototype[ln]||(Fe.prototype[ln]=ho.prototype[ln]);var co,ln,fn;function Fe(t){if(!(this instanceof Fe))return new Fe(t);lc.call(this,t),ho.call(this,t),t&&t.readable===!1&&(this.readable=!1),t&&t.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,t&&t.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",dv)}s(Fe,"Duplex");Object.defineProperty(Fe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function dv(){this.allowHalfOpen||this._writableState.ended||ac.nextTick(pv,this)}s(dv,"onend");function pv(t){t.end()}s(pv,"onEndNT");Object.defineProperty(Fe.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=t,this._writableState.destroyed=t)}});Fe.prototype._destroy=function(t,e){this.push(null),this.end(),ac.nextTick(e,t)}});var dc=b((_o,hc)=>{var un=S("buffer"),We=un.Buffer;function cc(t,e){for(var r in t)e[r]=t[r]}s(cc,"copyProps");We.from&&We.alloc&&We.allocUnsafe&&We.allocUnsafeSlow?hc.exports=un:(cc(un,_o),_o.Buffer=Vt);function Vt(t,e,r){return We(t,e,r)}s(Vt,"SafeBuffer");cc(We,Vt);Vt.from=function(t,e,r){if(typeof t=="number")throw new TypeError("Argument must not be a number");return We(t,e,r)};Vt.alloc=function(t,e,r){if(typeof t!="number")throw new TypeError("Argument must be a number");var i=We(t);return e!==void 0?typeof r=="string"?i.fill(e,r):i.fill(e):i.fill(0),i};Vt.allocUnsafe=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return We(t)};Vt.allocUnsafeSlow=function(t){if(typeof t!="number")throw new TypeError("Argument must be a number");return un.SlowBuffer(t)}});var bo=b(_c=>{"use strict";var yo=dc().Buffer,pc=yo.isEncoding||function(t){switch(t=""+t,t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function _v(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}s(_v,"_normalizeEncoding");function gv(t){var e=_v(t);if(typeof e!="string"&&(yo.isEncoding===pc||!pc(t)))throw new Error("Unknown encoding: "+t);return e||t}s(gv,"normalizeEncoding");_c.StringDecoder=Rr;function Rr(t){this.encoding=gv(t);var e;switch(this.encoding){case"utf16le":this.text=Sv,this.end=Ev,e=4;break;case"utf8":this.fillLast=vv,e=4;break;case"base64":this.text=xv,this.end=Cv,e=3;break;default:this.write=Tv,this.end=Iv;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=yo.allocUnsafe(e)}s(Rr,"StringDecoder");Rr.prototype.write=function(t){if(t.length===0)return"";var e,r;if(this.lastNeed){if(e=this.fillLast(t),e===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""};Rr.prototype.end=wv;Rr.prototype.text=mv;Rr.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length};function go(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}s(go,"utf8CheckByte");function yv(t,e,r){var i=e.length-1;if(i<r)return 0;var n=go(e[i]);return n>=0?(n>0&&(t.lastNeed=n-1),n):--i<r||n===-2?0:(n=go(e[i]),n>=0?(n>0&&(t.lastNeed=n-2),n):--i<r||n===-2?0:(n=go(e[i]),n>=0?(n>0&&(n===2?n=0:t.lastNeed=n-3),n):0))}s(yv,"utf8CheckIncomplete");function bv(t,e,r){if((e[0]&192)!==128)return t.lastNeed=0,"\uFFFD";if(t.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return t.lastNeed=1,"\uFFFD";if(t.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return t.lastNeed=2,"\uFFFD"}}s(bv,"utf8CheckExtraBytes");function vv(t){var e=this.lastTotal-this.lastNeed,r=bv(this,t,e);if(r!==void 0)return r;if(this.lastNeed<=t.length)return t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,e,0,t.length),this.lastNeed-=t.length}s(vv,"utf8FillLast");function mv(t,e){var r=yv(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var i=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString("utf8",e,i)}s(mv,"utf8Text");function wv(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\uFFFD":e}s(wv,"utf8End");function Sv(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var i=r.charCodeAt(r.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}s(Sv,"utf16Text");function Ev(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}s(Ev,"utf16End");function xv(t,e){var r=(t.length-e)%3;return r===0?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}s(xv,"base64Text");function Cv(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}s(Cv,"base64End");function Tv(t){return t.toString(this.encoding)}s(Tv,"simpleWrite");function Iv(t){return t&&t.length?this.write(t):""}s(Iv,"simpleEnd")});var po=b((C0,Ic)=>{"use strict";var $t=Mt();Ic.exports=z;var Ov=Hu(),Ar;z.ReadableState=Sc;var x0=S("events").EventEmitter,vc=s(function(t,e){return t.listeners(e).length},"EElistenerCount"),Eo=so(),kr=nn().Buffer,Rv=global.Uint8Array||function(){};function Av(t){return kr.from(t)}s(Av,"_uint8ArrayToBuffer");function kv(t){return kr.isBuffer(t)||t instanceof Rv}s(kv,"_isUint8Array");var mc=Object.create(Ft());mc.inherits=oe();var vo=S("util"),U=void 0;vo&&vo.debuglog?U=vo.debuglog("stream"):U=s(function(){},"debug");var Bv=Yu(),wc=fo(),Ht;mc.inherits(z,Eo);var mo=["error","close","destroy","pause","resume"];function Pv(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Ov(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}s(Pv,"prependListener");function Sc(t,e){Ar=Ar||It(),t=t||{};var r=e instanceof Ar;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,n=t.readableHighWaterMark,o=this.objectMode?16:16*1024;i||i===0?this.highWaterMark=i:r&&(n||n===0)?this.highWaterMark=n:this.highWaterMark=o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new Bv,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(Ht||(Ht=bo().StringDecoder),this.decoder=new Ht(t.encoding),this.encoding=t.encoding)}s(Sc,"ReadableState");function z(t){if(Ar=Ar||It(),!(this instanceof z))return new z(t);this._readableState=new Sc(t,this),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),Eo.call(this)}s(z,"Readable");Object.defineProperty(z.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){!this._readableState||(this._readableState.destroyed=t)}});z.prototype.destroy=wc.destroy;z.prototype._undestroy=wc.undestroy;z.prototype._destroy=function(t,e){this.push(null),e(t)};z.prototype.push=function(t,e){var r=this._readableState,i;return r.objectMode?i=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=kr.from(t,e),e=""),i=!0),Ec(this,t,e,!1,i)};z.prototype.unshift=function(t){return Ec(this,t,null,!0,!1)};function Ec(t,e,r,i,n){var o=t._readableState;if(e===null)o.reading=!1,qv(t,o);else{var a;n||(a=Nv(o,e)),a?t.emit("error",a):o.objectMode||e&&e.length>0?(typeof e!="string"&&!o.objectMode&&Object.getPrototypeOf(e)!==kr.prototype&&(e=Av(e)),i?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):wo(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!r?(e=o.decoder.write(e),o.objectMode||e.length!==0?wo(t,o,e,!1):xc(t,o)):wo(t,o,e,!1))):i||(o.reading=!1)}return Mv(o)}s(Ec,"readableAddChunk");function wo(t,e,r,i){e.flowing&&e.length===0&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,i?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&cn(t)),xc(t,e)}s(wo,"addChunk");function Nv(t,e){var r;return!kv(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new TypeError("Invalid non-string/buffer chunk")),r}s(Nv,"chunkInvalid");function Mv(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||t.length===0)}s(Mv,"needMoreData");z.prototype.isPaused=function(){return this._readableState.flowing===!1};z.prototype.setEncoding=function(t){return Ht||(Ht=bo().StringDecoder),this._readableState.decoder=new Ht(t),this._readableState.encoding=t,this};var gc=8388608;function Lv(t){return t>=gc?t=gc:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}s(Lv,"computeNewHighWaterMark");function yc(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=Lv(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}s(yc,"howMuchToRead");z.prototype.read=function(t){U("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return U("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?So(this):cn(this),null;if(t=yc(t,e),t===0&&e.ended)return e.length===0&&So(this),null;var i=e.needReadable;U("need readable",i),(e.length===0||e.length-t<e.highWaterMark)&&(i=!0,U("length less than watermark",i)),e.ended||e.reading?(i=!1,U("reading or ended",i)):i&&(U("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=yc(r,e)));var n;return t>0?n=Cc(t,e):n=null,n===null?(e.needReadable=!0,t=0):e.length-=t,e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&So(this)),n!==null&&this.emit("data",n),n};function qv(t,e){if(!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,cn(t)}}s(qv,"onEofChunk");function cn(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(U("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?$t.nextTick(bc,t):bc(t))}s(cn,"emitReadable");function bc(t){U("emit readable"),t.emit("readable"),xo(t)}s(bc,"emitReadable_");function xc(t,e){e.readingMore||(e.readingMore=!0,$t.nextTick(Dv,t,e))}s(xc,"maybeReadMore");function Dv(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(U("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}s(Dv,"maybeReadMore_");z.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))};z.prototype.pipe=function(t,e){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=t;break;case 1:i.pipes=[i.pipes,t];break;default:i.pipes.push(t);break}i.pipesCount+=1,U("pipe count=%d opts=%j",i.pipesCount,e);var n=(!e||e.end!==!1)&&t!==process.stdout&&t!==process.stderr,o=n?l:w;i.endEmitted?$t.nextTick(o):r.once("end",o),t.on("unpipe",a);function a(_,y){U("onunpipe"),_===r&&y&&y.hasUnpiped===!1&&(y.hasUnpiped=!0,c())}s(a,"onunpipe");function l(){U("onend"),t.end()}s(l,"onend");var f=Uv(r);t.on("drain",f);var u=!1;function c(){U("cleanup"),t.removeListener("close",g),t.removeListener("finish",m),t.removeListener("drain",f),t.removeListener("error",p),t.removeListener("unpipe",a),r.removeListener("end",l),r.removeListener("end",w),r.removeListener("data",h),u=!0,i.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&f()}s(c,"cleanup");var d=!1;r.on("data",h);function h(_){U("ondata"),d=!1;var y=t.write(_);y===!1&&!d&&((i.pipesCount===1&&i.pipes===t||i.pipesCount>1&&Tc(i.pipes,t)!==-1)&&!u&&(U("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,d=!0),r.pause())}s(h,"ondata");function p(_){U("onerror",_),w(),t.removeListener("error",p),vc(t,"error")===0&&t.emit("error",_)}s(p,"onerror"),Pv(t,"error",p);function g(){t.removeListener("finish",m),w()}s(g,"onclose"),t.once("close",g);function m(){U("onfinish"),t.removeListener("close",g),w()}s(m,"onfinish"),t.once("finish",m);function w(){U("unpipe"),r.unpipe(t)}return s(w,"unpipe"),t.emit("pipe",r),i.flowing||(U("pipe resume"),r.resume()),t};function Uv(t){return function(){var e=t._readableState;U("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,e.awaitDrain===0&&vc(t,"data")&&(e.flowing=!0,xo(t))}}s(Uv,"pipeOnDrain");z.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var i=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<n;o++)i[o].emit("unpipe",this,r);return this}var a=Tc(e.pipes,t);return a===-1?this:(e.pipes.splice(a,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)};z.prototype.on=function(t,e){var r=Eo.prototype.on.call(this,t,e);if(t==="data")this._readableState.flowing!==!1&&this.resume();else if(t==="readable"){var i=this._readableState;!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&cn(this):$t.nextTick(jv,this))}return r};z.prototype.addListener=z.prototype.on;function jv(t){U("readable nexttick read 0"),t.read(0)}s(jv,"nReadingNextTick");z.prototype.resume=function(){var t=this._readableState;return t.flowing||(U("resume"),t.flowing=!0,Fv(this,t)),this};function Fv(t,e){e.resumeScheduled||(e.resumeScheduled=!0,$t.nextTick(Wv,t,e))}s(Fv,"resume");function Wv(t,e){e.reading||(U("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),xo(t),e.flowing&&!e.reading&&t.read(0)}s(Wv,"resume_");z.prototype.pause=function(){return U("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(U("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function xo(t){var e=t._readableState;for(U("flow",e.flowing);e.flowing&&t.read()!==null;);}s(xo,"flow");z.prototype.wrap=function(t){var e=this,r=this._readableState,i=!1;t.on("end",function(){if(U("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&e.push(a)}e.push(null)}),t.on("data",function(a){if(U("wrapped data"),r.decoder&&(a=r.decoder.write(a)),!(r.objectMode&&a==null)&&!(!r.objectMode&&(!a||!a.length))){var l=e.push(a);l||(i=!0,t.pause())}});for(var n in t)this[n]===void 0&&typeof t[n]=="function"&&(this[n]=function(a){return function(){return t[a].apply(t,arguments)}}(n));for(var o=0;o<mo.length;o++)t.on(mo[o],this.emit.bind(this,mo[o]));return this._read=function(a){U("wrapped _read",a),i&&(i=!1,t.resume())},this};Object.defineProperty(z.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});z._fromList=Cc;function Cc(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.head.data:r=e.buffer.concat(e.length),e.buffer.clear()):r=Vv(t,e.buffer,e.decoder),r}s(Cc,"fromList");function Vv(t,e,r){var i;return t<e.head.data.length?(i=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):t===e.head.data.length?i=e.shift():i=r?Hv(t,e):$v(t,e),i}s(Vv,"fromListPartial");function Hv(t,e){var r=e.head,i=1,n=r.data;for(t-=n.length;r=r.next;){var o=r.data,a=t>o.length?o.length:t;if(a===o.length?n+=o:n+=o.slice(0,t),t-=a,t===0){a===o.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(a));break}++i}return e.length-=i,n}s(Hv,"copyFromBufferString");function $v(t,e){var r=kr.allocUnsafe(t),i=e.head,n=1;for(i.data.copy(r),t-=i.data.length;i=i.next;){var o=i.data,a=t>o.length?o.length:t;if(o.copy(r,r.length-t,0,a),t-=a,t===0){a===o.length?(++n,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=o.slice(a));break}++n}return e.length-=n,r}s($v,"copyFromBuffer");function So(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,$t.nextTick(Gv,e,t))}s(So,"endReadable");function Gv(t,e){!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"))}s(Gv,"endReadableNT");function Tc(t,e){for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1}s(Tc,"indexOf")});var Co=b((T0,Ac)=>{"use strict";Ac.exports=Ve;var hn=It(),Rc=Object.create(Ft());Rc.inherits=oe();Rc.inherits(Ve,hn);function zv(t,e){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,e!=null&&this.push(e),i(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}s(zv,"afterTransform");function Ve(t){if(!(this instanceof Ve))return new Ve(t);hn.call(this,t),this._transformState={afterTransform:zv.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",Kv)}s(Ve,"Transform");function Kv(){var t=this;typeof this._flush=="function"?this._flush(function(e,r){Oc(t,e,r)}):Oc(this,null,null)}s(Kv,"prefinish");Ve.prototype.push=function(t,e){return this._transformState.needTransform=!1,hn.prototype.push.call(this,t,e)};Ve.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")};Ve.prototype._write=function(t,e,r){var i=this._transformState;if(i.writecb=r,i.writechunk=t,i.writeencoding=e,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}};Ve.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Ve.prototype._destroy=function(t,e){var r=this;hn.prototype._destroy.call(this,t,function(i){e(i),r.emit("close")})};function Oc(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}s(Oc,"done")});var Nc=b((I0,Pc)=>{"use strict";Pc.exports=Br;var kc=Co(),Bc=Object.create(Ft());Bc.inherits=oe();Bc.inherits(Br,kc);function Br(t){if(!(this instanceof Br))return new Br(t);kc.call(this,t)}s(Br,"PassThrough");Br.prototype._transform=function(t,e,r){r(null,t)}});var To=b((te,dn)=>{var Ae=S("stream");process.env.READABLE_STREAM==="disable"&&Ae?(dn.exports=Ae,te=dn.exports=Ae.Readable,te.Readable=Ae.Readable,te.Writable=Ae.Writable,te.Duplex=Ae.Duplex,te.Transform=Ae.Transform,te.PassThrough=Ae.PassThrough,te.Stream=Ae):(te=dn.exports=po(),te.Stream=Ae||te,te.Readable=te,te.Writable=uo(),te.Duplex=It(),te.Transform=Co(),te.PassThrough=Nc())});var Uc=b((O0,Dc)=>{var pn=To(),Mc=ys(),Yv=oe(),Qv=bs(),Lc=Buffer.from&&Buffer.from!==Uint8Array.from?Buffer.from([0]):new Buffer([0]),Io=s(function(t,e){t._corked?t.once("uncork",e):e()},"onuncork"),Jv=s(function(t,e){t._autoDestroy&&t.destroy(e)},"autoDestroy"),qc=s(function(t,e){return function(r){r?Jv(t,r.message==="premature close"?null:r):e&&!t._ended&&t.end()}},"destroyer"),Xv=s(function(t,e){if(!t||t._writableState&&t._writableState.finished)return e();if(t._writableState)return t.end(e);t.end(),e()},"end"),Zv=s(function(t){return new pn.Readable({objectMode:!0,highWaterMark:16}).wrap(t)},"toStreams2"),re=s(function(t,e,r){if(!(this instanceof re))return new re(t,e,r);pn.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||r.autoDestroy!==!1,this._forwardDestroy=!r||r.destroy!==!1,this._forwardEnd=!r||r.end!==!1,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,t&&this.setWritable(t),e&&this.setReadable(e)},"Duplexify");Yv(re,pn.Duplex);re.obj=function(t,e,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new re(t,e,r)};re.prototype.cork=function(){++this._corked===1&&this.emit("cork")};re.prototype.uncork=function(){this._corked&&--this._corked===0&&this.emit("uncork")};re.prototype.setWritable=function(t){if(this._unwrite&&this._unwrite(),this.destroyed){t&&t.destroy&&t.destroy();return}if(t===null||t===!1){this.end();return}var e=this,r=Mc(t,{writable:!0,readable:!1},qc(this,this._forwardEnd)),i=s(function(){var o=e._ondrain;e._ondrain=null,o&&o()},"ondrain"),n=s(function(){e._writable.removeListener("drain",i),r()},"clear");this._unwrite&&process.nextTick(i),this._writable=t,this._writable.on("drain",i),this._unwrite=n,this.uncork()};re.prototype.setReadable=function(t){if(this._unread&&this._unread(),this.destroyed){t&&t.destroy&&t.destroy();return}if(t===null||t===!1){this.push(null),this.resume();return}var e=this,r=Mc(t,{writable:!1,readable:!0},qc(this)),i=s(function(){e._forward()},"onreadable"),n=s(function(){e.push(null)},"onend"),o=s(function(){e._readable2.removeListener("readable",i),e._readable2.removeListener("end",n),r()},"clear");this._drained=!0,this._readable=t,this._readable2=t._readableState?t:Zv(t),this._readable2.on("readable",i),this._readable2.on("end",n),this._unread=o,this._forward()};re.prototype._read=function(){this._drained=!0,this._forward()};re.prototype._forward=function(){if(!(this._forwarding||!this._readable2||!this._drained)){this._forwarding=!0;for(var t;this._drained&&(t=Qv(this._readable2))!==null;)this.destroyed||(this._drained=this.push(t));this._forwarding=!1}};re.prototype.destroy=function(t){if(!this.destroyed){this.destroyed=!0;var e=this;process.nextTick(function(){e._destroy(t)})}};re.prototype._destroy=function(t){if(t){var e=this._ondrain;this._ondrain=null,e?e(t):this.emit("error",t)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")};re.prototype._write=function(t,e,r){if(this.destroyed)return r();if(this._corked)return Io(this,this._write.bind(this,t,e,r));if(t===Lc)return this._finish(r);if(!this._writable)return r();this._writable.write(t)===!1?this._ondrain=r:r()};re.prototype._finish=function(t){var e=this;this.emit("preend"),Io(this,function(){Xv(e._forwardEnd&&e._writable,function(){e._writableState.prefinished===!1&&(e._writableState.prefinished=!0),e.emit("prefinish"),Io(e,t)})})};re.prototype.end=function(t,e,r){return typeof t=="function"?this.end(null,null,t):typeof e=="function"?this.end(t,null,e):(this._ended=!0,t&&this.write(t),this._writableState.ending||this.write(Lc),pn.Writable.prototype.end.call(this,r))};Dc.exports=re});var Oo=b((R0,Fc)=>{"use strict";var em=To().Transform,tm=Uc(),jc=no(),Gt=jn().Buffer;Fc.exports=im;function rm(t,e,r){var i=new em({objectMode:t.objectMode});return i._write=e,i._flush=r,i}s(rm,"buildProxy");function im(t,e,r){var i,n,o=process.title==="browser",a=!!global.WebSocket,l=o?g:p;e&&!Array.isArray(e)&&typeof e=="object"&&(r=e,e=null,(typeof r.protocol=="string"||Array.isArray(r.protocol))&&(e=r.protocol)),r||(r={}),r.objectMode===void 0&&(r.objectMode=!(r.binary===!0||r.binary===void 0));var f=rm(r,l,m);r.objectMode||(f._writev=I);var u=r.browserBufferSize||1024*512,c=r.browserBufferTimeout||1e3;typeof t=="object"?n=t:(a&&o?n=new jc(t,e):n=new jc(t,e,r),n.binaryType="arraybuffer");var d=typeof n.addEventListener>"u";n.readyState===n.OPEN?i=f:(i=i=tm(void 0,void 0,r),r.objectMode||(i._writev=I),d?n.addEventListener("open",w):n.onopen=w),i.socket=n,d?(n.addEventListener("close",_),n.addEventListener("error",y),n.addEventListener("message",x)):(n.onclose=_,n.onerror=y,n.onmessage=x),f.on("close",T);var h=!r.objectMode;function p(E,M,H){if(n.readyState!==n.OPEN){H();return}h&&typeof E=="string"&&(E=Gt.from(E,"utf8")),n.send(E,H)}s(p,"socketWriteNode");function g(E,M,H){if(n.bufferedAmount>u){setTimeout(g,c,E,M,H);return}h&&typeof E=="string"&&(E=Gt.from(E,"utf8"));try{n.send(E)}catch(K){return H(K)}H()}s(g,"socketWriteBrowser");function m(E){n.close(),E()}s(m,"socketEnd");function w(){i.setReadable(f),i.setWritable(f),i.emit("connect")}s(w,"onopen");function _(){i.end(),i.destroy()}s(_,"onclose");function y(E){i.destroy(E)}s(y,"onerror");function x(E){var M=E.data;M instanceof ArrayBuffer?M=Gt.from(M):M=Gt.from(M,"utf8"),f.push(M)}s(x,"onmessage");function T(){n.close()}s(T,"destroy");function I(E,M){for(var H=new Array(E.length),K=0;K<E.length;K++)typeof E[K].chunk=="string"?H[K]=Gt.from(E[K],"utf8"):H[K]=E[K].chunk;this._write(Gt.concat(H),"binary",M)}return s(I,"writev"),i}s(im,"WebSocketStream")});var Wc=b((A0,Ro)=>{"use strict";var nm=no().Server,sm=Oo(),Pr=class extends nm{constructor(e,r){super(e);var i=!1;this.on("newListener",function(n){!i&&n==="stream"&&(i=!0,this.on("connection",function(o,a){this.emit("stream",sm(o,e),a)}))}),r&&this.on("stream",r)}};s(Pr,"Server");Ro.exports.Server=Pr;Ro.exports.createServer=function(t,e){return new Pr(t,e)}});var Hc=b((k0,_n)=>{var Vc=Wc();_n.exports=Oo();_n.exports.Server=Vc.Server;_n.exports.createServer=Vc.createServer});var Gc=b((B0,$c)=>{var om=Hc();function am(t,e){return om(e.url,["mqttv3.1"],e.websocketOptions)}s(am,"buildBuilder");$c.exports=am});var gn=b((P0,qr)=>{var fm=S("events"),lm=S("util").inherits,um=$l(),Mr=Jl(),zc=Fs(),ke=Zl(),B=mr(),cm=nu(),hm=S("path"),dm=S("fs");function Nr(t){return t>9?t:"0"+t}s(Nr,"makeTwoDigits");function pm(){var t=new Date;return t.getUTCFullYear()+""+Nr(t.getUTCMonth()+1)+Nr(t.getUTCDate())+"T"+Nr(t.getUTCHours())+Nr(t.getUTCMinutes())+Nr(t.getUTCSeconds())+"Z"}s(pm,"getDateTimeString");function _m(t){return t.substring(0,t.indexOf("T"))}s(_m,"getDateString");function gm(t,e,r,i){var n=Mr(e,"AWS4"+t,{asBytes:!0}),o=Mr(r,n,{asBytes:!0}),a=Mr(i,o,{asBytes:!0}),l=Mr("aws4_request",a,{asBytes:!0});return l}s(gm,"getSignatureKey");function ym(t,e,r,i,n,o,a,l,f,u,c,d,h,p){var g="host",m="host:"+r.toLowerCase()+`
`,w=t+`
`+i+`
`+n+`
`+m+`
`+g+`
`+zc(u,{asBytes:!0});h===!0&&console.log("canonical request: "+w+`
`);var _=zc(w,{asBytes:!0});h===!0&&console.log("hashed canonical request: "+_+`
`);var y=`AWS4-HMAC-SHA256
`+d+`
`+c+"/"+l+"/"+f+`/aws4_request
`+_;h===!0&&console.log("string to sign: "+y+`
`);var x=gm(a,c,l,f);h===!0&&console.log("signing key: "+x+`
`);var T=Mr(y,x,{asBytes:!0});h===!0&&console.log("signature: "+T+`
`);var I=n+"&X-Amz-Signature="+T;B(p)||(I+="&X-Amz-Security-Token="+encodeURIComponent(p));var E=e+r+i+"?"+I;return h===!0&&console.log("url: "+E+`
`),E}s(ym,"signUrl");function Kc(t,e,r,i){var n=pm(),o=_m(n),a="/mqtt",l="iotdevicegateway",f="X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential="+e+"%2F"+o+"%2F"+t.region+"%2F"+l+"%2Faws4_request&X-Amz-Date="+n+"&X-Amz-SignedHeaders=host",u=t.host;return!B(t.port)&&t.port!==443&&(u=t.host+":"+t.port),ym("GET","wss://",u,a,f,e,r,t.region,l,"",o,n,t.debug,i)}s(Kc,"prepareWebSocketUrl");function Yc(t){var e="/mqtt",r=t.host;return!B(t.port)&&t.port!==443&&(r=t.host+":"+t.port),"wss://"+r+e+(t.customAuthQueryString||"")}s(Yc,"prepareWebSocketCustomAuthUrl");function bm(t,e){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.call(this,t[r],parseInt(r,10))}s(bm,"arrayEach");function vm(t){var e={},r={};return bm(t.split(/\r?\n/),function(i){i=i.split(/(^|\s)[;#]/)[0];var n=i.match(/^\s*\[([^\[\]]+)\]\s*$/);if(n)r=n[1];else if(r){var o=i.match(/^\s*(.+?)\s*=\s*(.+?)\s*$/);o&&(e[r]=e[r]||{},e[r][o[1]]=o[2])}}),e}s(vm,"getCredentials");function Lr(t){if(!(this instanceof Lr))return new Lr(t);var e=this,r=[],i=!0,n=0,o="oldest";r.length=0;var a=[],l=50;a.length=0;var f=[],u=!0;f.length=0;var c=[];c.length=0;var d="inactive",h=null,p=250,g=300,m=1e3,w=2e4,_=128e3,y,x=null,T,I,E,M="?SDK=JavaScript&Version=",H=su(),K=H.version,ft=M+K;if(B(t)||Object.keys(t).length===0)throw new Error(ke.INVALID_CONNECT_OPTIONS);if(B(t.keepalive)&&(t.keepalive=g),(B(t.enableMetrics)||t.enableMetrics===!0)&&(B(t.username)?t.username=ft:t.username+=ft),B(t.baseReconnectTimeMs)||(m=t.baseReconnectTimeMs),B(t.minimumConnectionTimeMs)||(w=t.minimumConnectionTimeMs),B(t.maximumReconnectTimeMs)||(_=t.maximumReconnectTimeMs),B(t.drainTimeMs)||(p=t.drainTimeMs),B(t.autoResubscribe)||(u=t.autoResubscribe),B(t.offlineQueueing)||(i=t.offlineQueueing),B(t.offlineQueueMaxSize)||(n=t.offlineQueueMaxSize),B(t.offlineQueueDropBehavior)||(o=t.offlineQueueDropBehavior),y=m,t.reconnectPeriod=y,t.fastDisconnectDetection=!0,t.resubscribe=!1,t.baseReconnectTimeMs<=0)throw new Error(ke.INVALID_RECONNECT_TIMING);if(_<m)throw new Error(ke.INVALID_RECONNECT_TIMING);if(w<m)throw new Error(ke.INVALID_RECONNECT_TIMING);if(o!=="newest"&&o!=="oldest")throw new Error(ke.INVALID_OFFLINE_QUEUEING_PARAMETERS);if(n<0)throw new Error(ke.INVALID_OFFLINE_QUEUEING_PARAMETERS);if(B(t.protocol)&&(t.protocol="mqtts"),B(t.host))throw new Error(ke.INVALID_CONNECT_OPTIONS);if(B(t.servername)&&(t.servername=t.host.split(":")[0]),t.protocol==="mqtts")B(t.port)&&(t.port=8883),cm(t);else if(t.protocol==="wss"||t.protocol==="wss-custom-auth"){if(t.protocol==="wss"){if(B(t.accessKeyId)?T=process.env.AWS_ACCESS_KEY_ID:T=t.accessKeyId,B(t.secretKey)?I=process.env.AWS_SECRET_ACCESS_KEY:I=t.secretKey,B(t.sessionToken)?E=process.env.AWS_SESSION_TOKEN:E=t.sessionToken,B(T)||B(I)){var Ce,Ur=t.profile||process.env.AWS_PROFILE||"default";try{B(t.filename)?Ce=fh():Ce=t.filename;var mn=vm(dm.readFileSync(Ce,"utf-8")),Kt=mn[Ur];T=Kt.aws_access_key_id,I=Kt.aws_secret_access_key,E=Kt.aws_session_token}catch(O){console.log(O),console.log("Failed to read credentials for AWS_PROFILE "+Ur+" from "+Ce)}}if(B(T)||B(I))throw console.log("To connect via WebSocket/SigV4, AWS Access Key ID and AWS Secret Key must be passed either in options or as environment variables; see README.md"),new Error(ke.INVALID_CONNECT_OPTIONS)}else if(B(t.customAuthHeaders)&&B(t.customAuthQueryString))throw console.log("To authenticate with a custom authorizer, you must provide the required HTTP headers or queryString; see README.md"),new Error(ke.INVALID_CONNECT_OPTIONS);if(!B(t.host)&&B(t.region)){var jr=/[a-zA-Z0-9]+\.iot\.([a-z]+-[a-z]+-[0-9]+)\.amazonaws\..+/,Fr=jr.exec(t.host);if(Fr===null)throw console.log("Host endpoint is not valid"),new Error(ke.INVALID_CONNECT_OPTIONS);t.region=Fr[1]}B(t.port)&&(t.port=443),B(t.websocketOptions)?t.websocketOptions={protocol:"mqttv3.1"}:t.websocketOptions.protocol="mqttv3.1",t.protocol==="wss-custom-auth"&&(t.websocketOptions.headers=t.customAuthHeaders)}!B(t)&&t.debug===!0&&(console.log(t),console.log("attempting new mqtt connection..."));var wn={};wn.mqtts=au(),wn.wss=Gc();function fh(){var O=process.env.HOME||process.env.USERPROFILE||(process.env.HOMEPATH?(process.env.HOMEDRIVE||"C:/")+process.env.HOMEPATH:null);return hm.join(O,".aws","credentials")}s(fh,"_loadDefaultFilename");function lh(O,A){var W=f.filter(function(pe){return pe.topic===O});W.length===0&&f.push({topic:O,options:A})}s(lh,"_addToSubscriptionCache");function uh(O,A){var W=f.filter(function(pe){return pe.topic!==O});f=W}s(uh,"_deleteFromSubscriptionCache");function Sn(O,A,W){var pe=null;u!==!1&&(O==="subscribe"?pe=lh:O==="unsubscribe"&&(pe=uh),Object.prototype.toString.call(A)==="[object Array]"?A.forEach(function(_h,km,Bm){pe(_h,W)}):pe(A,W))}s(Sn,"_updateSubscriptionCache");function Wr(){return d==="inactive"}s(Wr,"_filling");function ch(O){var A=t.protocol;if(A==="wss"){var W;T===""||I===""?W="wss://no-credentials-available":W=Kc(t,T,I,E),t.debug===!0&&console.log("using websockets, will connect to '"+W+"'..."),t.url=W}else A==="wss-custom-auth"&&(t.url=Yc(t),t.debug===!0&&console.log("using websockets custom auth, will connect to '"+t.url+"'..."),A="wss");return wn[A](O,t)}s(ch,"_wrapper");var F=new um.MqttClient(ch,t);function hh(){y=m,F.options.reconnectPeriod=y,x=null,d="stable"}s(hh,"_markConnectionStable");function dh(){var O=!0;return n>0&&r.length>=n&&(o==="oldest"?r.shift():O=!1),O}s(dh,"_trimOfflinePublishQueueIfNecessary");function ph(){var O=c.shift();if(!B(O))B(O.callback)?F.subscribe(O.topic,O.options):F.subscribe(O.topic,O.options,O.callback);else{var A=a.shift();if(!B(A))Sn(A.type,A.topics,A.options),A.type==="subscribe"?B(A.callback)?F.subscribe(A.topics,A.options):F.subscribe(A.topics,A.options,A.callback):A.type==="unsubscribe"&&F.unsubscribe(A.topics,A.callback);else{var W=r.shift();B(W)||F.publish(W.topic,W.message,W.options,W.callback),r.length===0&&(clearInterval(h),h=null)}}}s(ph,"_drainOperationQueue"),F.on("connect",function(O){x===null&&(x=setTimeout(hh,w)),d="established",h===null&&(c=f.slice(0),h=setInterval(ph,p)),e.emit("connect",O)}),F.on("close",function(O){B(O)||e.emit("error",O),!B(t)&&t.debug===!0&&console.log("connection lost - will attempt reconnection in "+F.options.reconnectPeriod/1e3+" seconds..."),clearTimeout(x),x=null,clearInterval(h),h=null,d="inactive",e.emit("close")}),F.on("reconnect",function(){y=y*2,y=Math.min(_,y),F.options.reconnectPeriod=y,e.emit("reconnect")}),F.on("end",function(){e.emit("end")}),F.on("offline",function(){e.emit("offline")}),F.on("error",function(O){e.emit("error",O)}),F.on("packetsend",function(O){e.emit("packetsend",O)}),F.on("packetreceive",function(O){e.emit("packetreceive",O)}),F.on("message",function(O,A,W){e.emit("message",O,A,W)}),this.publish=function(O,A,W,pe){i===!0&&(Wr()||h!==null)?dh()&&r.push({topic:O,message:A,options:W,callback:pe}):(i===!0||!Wr())&&F.publish(O,A,W,pe)},this.subscribe=function(O,A,W){!Wr()||u===!1?(Sn("subscribe",O,A),B(W)?F.subscribe(O,A):F.subscribe(O,A,W)):a.length<l?a.push({type:"subscribe",topics:O,options:A,callback:W}):e.emit("error",new Error("Maximum queued offline subscription reached"))},this.unsubscribe=function(O,A){!Wr()||u===!1?(Sn("unsubscribe",O),F.unsubscribe(O,A)):a.length<l&&a.push({type:"unsubscribe",topics:O,options:t,callback:A})},this.end=function(O,A){F.end(O,A)},this.handleMessage=F.handleMessage.bind(F),F.handleMessage=function(O,A){e.handleMessage(O,A)},this.updateWebSocketCredentials=function(O,A,W,pe){T=O,I=A,E=W},this.getWebsocketHeaders=function(){return t.websocketOptions.headers},this.updateCustomAuthHeaders=function(O){t.websocketOptions.headers=O},this.simulateNetworkFailure=function(){F.stream.emit("error",new Error("simulated connection error")),F.stream.end()}}s(Lr,"DeviceClient");lm(Lr,fm.EventEmitter);qr.exports=Lr;qr.exports.DeviceClient=Lr;qr.exports.prepareWebSocketUrl=Kc;qr.exports.prepareWebSocketCustomAuthUrl=Yc});var Zc=b((N0,Xc)=>{var Jc=S("events"),mm=S("util").inherits,wm=gn(),j=mr();function Qc(t,e,r){return j(r)?"$aws/things/"+t+"/shadow/"+e:"$aws/things/"+t+"/shadow/"+e+"/"+r}s(Qc,"buildThingShadowTopic");function Sm(t,e){var r=!1;return t[0]==="$aws"&&t[1]==="things"&&t[3]==="shadow"&&(t[4]==="update"||t[4]==="get"||t[4]==="delete")&&(e==="subscribe"?(t[5]==="accepted"||t[5]==="rejected"||t[5]==="delta")&&t.length===6&&(r=!0):t.length===5&&(r=!0)),r}s(Sm,"isThingShadowTopic");function yn(t,e){if(!(this instanceof yn))return new yn(t,e);var r=this,i=[{}],n=0,o=1e4,a=!0,l=wm.DeviceClient(t);j(e)||j(e.operationTimeout)||(o=e.operationTimeout),this._handleSubscriptions=function(f,u,c,d){for(var h=[],p=0,g=u.length;p<g;p++)for(var m=0,w=u[p].operations.length;m<w;m++)for(var _=0,y=u[p].statii.length;_<y;_++)h.push(Qc(f,u[p].operations[m],u[p].statii[_]));i[f].debug===!0&&console.log(c+" on "+h);var x=[];x.push(h),c==="subscribe"?(x.push({qos:i[f].qos}),x.push(function(T,I){if(!j(d)){if(T){d(T);return}for(var E=[],M=0,H=I.length;M<H;M++)I[M].qos===128&&E.push(I[M]);if(E.length>0){d("Not all subscriptions were granted",E);return}d()}})):j(d)||x.push(d),l[c].apply(l,x)},this._handleMessages=function(f,u,c,d){var h={};try{h=JSON.parse(d.toString())}catch(m){t.debug===!0&&console.error("failed parsing JSON '"+d.toString()+"', "+m);return}var p=h.clientToken,g=h.version;if(delete h.clientToken,!j(g)&&c!=="rejected"){if(j(i[f].version)||g>=i[f].version)i[f].version=g;else if(u!=="delete"&&i[f].discardStale===!0){t.debug===!0&&console.warn("out-of-date version '"+g+"' on '"+f+"' (local version '"+i[f].version+"')");return}}if(c==="delta"){this.emit("delta",f,h);return}if(j(i[f].clientToken)||i[f].clientToken!==p){c==="accepted"&&u!=="get"&&this.emit("foreignStateChange",f,u,h);return}clearTimeout(i[f].timeout),delete i[f].timeout,delete i[f].clientToken,i[f].pending=!1,i[f].persistentSubscribe===!1&&this._handleSubscriptions(f,[{operations:[u],statii:["accepted","rejected"]}],"unsubscribe"),this.emit("status",f,c,p,h)},l.on("connect",function(){r.emit("connect")}),l.on("close",function(){r.emit("close")}),l.on("reconnect",function(){r.emit("reconnect")}),l.on("offline",function(){r.emit("offline")}),l.on("error",function(f){r.emit("error",f)}),l.on("packetsend",function(f){r.emit("packetsend",f)}),l.on("packetreceive",function(f){r.emit("packetreceive",f)}),l.on("message",function(f,u){if(a===!0){var c=f.split("/");Sm(c,"subscribe")?i.hasOwnProperty(c[2])&&r._handleMessages(c[2],c[4],c[5],u):r.emit("message",f,u)}}),this._thingOperation=function(f,u,c){var d=null;if(i.hasOwnProperty(f))if(i[f].pending===!1){i[f].pending=!0;var h;if(j(c.clientToken)){var p=t.clientId.length;p>48?h=t.clientId.substr(p-48)+"-"+n++:h=t.clientId+"-"+n++}else h=c.clientToken;i[f].clientToken=h;var g=Qc(f,u);i[f].timeout=setTimeout(function(m,w){i[m].persistentSubscribe===!1&&r._handleSubscriptions(m,[{operations:[u],statii:["accepted","rejected"]}],"unsubscribe"),i[m].pending=!1,delete i[m].timeout,delete i[m].clientToken,r.emit("timeout",m,w)},o,f,h),i[f].persistentSubscribe===!1?this._handleSubscriptions(f,[{operations:[u],statii:["accepted","rejected"]}],"subscribe",function(m,w){if(!j(m)||!j(w)){console.warn("failed subscription to accepted/rejected topics");return}j(c)||(!j(i[f].version)&&i[f].enableVersioning&&(c.version=i[f].version),c.clientToken=h,l.publish(g,JSON.stringify(c),{qos:i[f].qos}),!j(i[f])&&i[f].debug===!0&&console.log("publishing '"+JSON.stringify(c)+" on '"+g+"'"))}):(!j(i[f].version)&&i[f].enableVersioning&&(c.version=i[f].version),c.clientToken=h,l.publish(g,JSON.stringify(c),{qos:i[f].qos}),i[f].debug===!0&&console.log("publishing '"+JSON.stringify(c)+" on '"+g+"'")),d=h}else t.debug===!0&&console.error(u+" still in progress on thing: ",f);else t.debug===!0&&console.error("attempting to "+u+" unknown thing: ",f);return d},this.register=function(f,u,c){if(i.hasOwnProperty(f))t.debug===!0&&console.error("thing already registered: ",f);else{var d=!1,h=[];i[f]={persistentSubscribe:!0,debug:!1,discardStale:!0,enableVersioning:!0,qos:0,pending:!0},typeof u=="function"&&(c=u,u=null),j(u)||(j(u.ignoreDeltas)||(d=u.ignoreDeltas),j(u.persistentSubscribe)||(i[f].persistentSubscribe=u.persistentSubscribe),j(u.debug)||(i[f].debug=u.debug),j(u.discardStale)||(i[f].discardStale=u.discardStale),j(u.enableVersioning)||(i[f].enableVersioning=u.enableVersioning),j(u.qos)||(i[f].qos=u.qos)),d===!1&&h.push({operations:["update"],statii:["delta"]}),i[f].persistentSubscribe===!0&&h.push({operations:["update","get","delete"],statii:["accepted","rejected"]}),h.length>0?this._handleSubscriptions(f,h,"subscribe",function(p,g){j(p)&&j(g)&&(i[f].pending=!1),j(c)||c(p,g)}):(i[f].pending=!1,j(c)||c())}},this.unregister=function(f){if(i.hasOwnProperty(f)){var u=[];u.push({operations:["update"],statii:["delta"]}),i[f].persistentSubscribe===!0&&u.push({operations:["update","get","delete"],statii:["accepted","rejected"]}),this._handleSubscriptions(f,u,"unsubscribe"),j(i[f].timeout)||clearTimeout(i[f].timeout),delete i[f]}else t.debug===!0&&console.error("attempting to unregister unknown thing: ",f)},this.update=function(f,u){var c=null;return j(u.version)?c=r._thingOperation(f,"update",u):console.error("message can't contain 'version' property"),c},this.get=function(f,u){var c={};return j(u)||(c.clientToken=u),r._thingOperation(f,"get",c)},this.delete=function(f,u){var c={};return j(u)||(c.clientToken=u),r._thingOperation(f,"delete",c)},this.publish=function(f,u,c,d){l.publish(f,u,c,d)},this.subscribe=function(f,u,c){var d=[];typeof f=="string"?d.push(f):typeof f=="object"&&f.length&&(d=f),l.subscribe(d,u,c)},this.unsubscribe=function(f,u){var c=[];typeof f=="string"?c.push(f):typeof f=="object"&&f.length&&(c=f),l.unsubscribe(c,u)},this.end=function(f,u){l.end(f,u)},this.updateWebSocketCredentials=function(f,u,c,d){l.updateWebSocketCredentials(f,u,c,d)},this.updateCustomAuthHeaders=function(f){l.updateCustomAuthHeaders(f)},this.setConnectionStatus=function(f){a=f},Jc.EventEmitter.call(this)}s(yn,"ThingShadowsClient");mm(yn,Jc.EventEmitter);Xc.exports=yn});var th=b((M0,eh)=>{var Em=S("events"),xm=S("util").inherits,Cm=gn(),$=mr();function Tm(t){return t[0]==="$aws"&&t[1]==="things"&&t[3]==="jobs"}s(Tm,"isJobTopic");function zt(t,e,r){var i="$aws/things/"+t+"/jobs/";return $(r)?r=e:i+=e.toString()+"/",i+=r,i}s(zt,"buildJobTopic");function bn(t){if(!(this instanceof bn))return new bn(t);var e=this,r=[],i=Cm.DeviceClient(t);this._updateJobStatus=function(n,o,a,l,f){typeof l=="function"&&(f=l,l=void 0),!$(t)&&t.debug===!0&&console.log("updateJobStatus:",{thingName:n,jobId:o.id,status:a,statusDetails:l}),i.publish(zt(n,o.id,"update"),JSON.stringify({status:a,statusDetails:l}),null,function(u){$(u)&&(o.status={status:a,statusDetails:l}),$(f)||f(u)})},this._buildJobObject=function(n,o){if($(o)||$(o.jobId))return null;var a={};return a.id=o.jobId,a.document=o.jobDocument,a.operation=a.document.operation,a.status={status:o.status,statusDetails:o.statusDetails},a.inProgress=function(l,f){e._updateJobStatus(n,a,"IN_PROGRESS",l,f)},a.failed=function(l,f){e._updateJobStatus(n,a,"FAILED",l,f)},a.succeeded=function(l,f){e._updateJobStatus(n,a,"SUCCEEDED",l,f)},a},this._handleMessages=function(n,o){var a=n.split("/");if(!Tm(a)){e.emit("message",n,o);return}var l=a[2],f=r.find(function(h){return h.thingName===l});if(!$(f)){var u={};try{u=JSON.parse(o.toString())}catch(h){t.debug===!0&&console.error("failed parsing JSON '"+o.toString()+"', "+h);return}if(!($(u.execution)||$(u.execution.jobId)||$(u.execution.jobDocument))){var c=u.execution.jobDocument.operation,d=f.operations.find(function(h){return $(c)?$(h.operationName):c===h.operationName});$(d)&&(d=f.operations.find(function(h){return $(h.operationName)}),$(d))||d.callback(null,e._buildJobObject(l,u.execution))}}},this.subscribeToJobs=function(n,o,a){$(a)&&(a=o,o=null),!$(t)&&t.debug===!0&&console.log("subscribeToJobs:",{thingName:n,operationName:o});var l=r.find(function(u){return u.thingName===n});$(l)&&(l={thingName:n,operations:[]},r.push(l),i.subscribe([zt(n,"$next/get/accepted"),zt(n,"notify-next")],function(u,c){$(u)||a(u)}));var f=l.operations.find(function(u){return $(o)?$(u.operationName):o===u.operationName});$(f)?(f={operationName:o,callback:a},l.operations.push(f)):f.callback=a},this.unsubscribeFromJobs=function(n,o,a){$(a)&&(a=o,o=null),!$(t)&&t.debug===!0&&console.log("unsubscribeFromJobs:",{thingName:n,operationName:o});var l=r.findIndex(function(c){return c.thingName===n}),f=new Error("subscription not found for given thing");if(l<0){a(f);return}var u=r[l].operations.findIndex(function(c){return $(o)?$(c.operationName):o===c.operationName});if(u<0){a(f);return}if(r[l].operations.splice(u,1),r[l].operations.length===0){r.splice(l,1),i.unsubscribe([zt(n,"$next/get/accepted"),zt(n,"notify-next")],a);return}a()},this.startJobNotifications=function(n,o){!$(t)&&t.debug===!0&&console.log("startJobNotifications:",{thingName:n}),i.publish(zt(n,"$next","get"),"{}",o)},i.on("connect",function(){e.emit("connect")}),i.on("close",function(){e.emit("close")}),i.on("reconnect",function(){e.emit("reconnect")}),i.on("offline",function(){e.emit("offline")}),i.on("error",function(n){e.emit("error",n)}),i.on("message",e._handleMessages),this.publish=i.publish,this.subscribe=i.subscribe,this.unsubscribe=i.unsubscribe,this.end=i.end,this.handleMessage=i.handleMessage,this.updateWebSocketCredentials=i.updateWebSocketCredentials,this.simulateNetworkFailure=i.simulateNetworkFailure}s(bn,"jobsClient");xm(bn,Em.EventEmitter);eh.exports=bn});var rh=b((L0,vn)=>{vn.exports.device=gn();vn.exports.thingShadow=Zc();vn.exports.jobs=th()});var nh=Sh(rh(),1),sh="test",oh=`/sst/${process.env.SST_APP}/${process.env.SST_STAGE}/${sh}`,Im={SST_DEBUG_ENDPOINT:!0,SST_DEBUG_SRC_HANDLER:!0,SST_DEBUG_SRC_PATH:!0,AWS_LAMBDA_FUNCTION_MEMORY_SIZE:!0,AWS_LAMBDA_LOG_GROUP_NAME:!0,AWS_LAMBDA_LOG_STREAM_NAME:!0,LD_LIBRARY_PATH:!0,LAMBDA_TASK_ROOT:!0,AWS_LAMBDA_RUNTIME_API:!0,AWS_EXECUTION_ENV:!0,AWS_XRAY_DAEMON_ADDRESS:!0,AWS_LAMBDA_INITIALIZATION_TYPE:!0,PATH:!0,PWD:!0,LAMBDA_RUNTIME_DIR:!0,LANG:!0,NODE_PATH:!0,TZ:!0,SHLVL:!0,_AWS_XRAY_DAEMON_ADDRESS:!0,_AWS_XRAY_DAEMON_PORT:!0,AWS_XRAY_CONTEXT_MISSING:!0,_HANDLER:!0,_LAMBDA_CONSOLE_SOCKET:!0,_LAMBDA_CONTROL_SOCKET:!0,_LAMBDA_LOG_FD:!0,_LAMBDA_RUNTIME_LOAD_TIME:!0,_LAMBDA_SB_ID:!0,_LAMBDA_SERVER_PORT:!0,_LAMBDA_SHARED_MEM_FD:!0},Om=Object.fromEntries(Object.entries(process.env).filter(([t,e])=>Im[t]!==!0)),Rm="a38npzxl5ie9zp-ats.iot.us-east-1.amazonaws.com",Dr=new nh.default.device({protocol:"wss",host:Rm});Dr.on("error",console.log);Dr.on("connect",console.log);Dr.subscribe(`${oh}/response`);var ih=new Map,ah;Dr.on("message",(t,e)=>{let r=JSON.parse(e.toString()),i=ih.get(r.id);if(i||(i=new Map,ih.set(r.id,i)),i.set(r.index,r),i.size===r.count){let n=[...i.values()].sort((a,l)=>a.index-l.index).map(a=>a.data).join(""),o=JSON.parse(n);ah(o)}});async function q0(t,e){for(let i of Am({type:"function.invocation",properties:{functionID:sh,event:t,context:e,env:Om}}))Dr.publish(`${oh}/invocation`,JSON.stringify(i));let r=await new Promise(i=>{ah=s(n=>{(n.type="function.responded")&&i(n.properties)},"onMessage")});if(r.type==="success")return r.body;if(r.type==="failure")throw r.body}s(q0,"handler");function Am(t){let r=JSON.stringify(t).match(/.{1,100000}/g);if(!r)return[];let i=Math.random().toString();return r.map((n,o)=>({id:i,index:o,count:r?.length,data:n}))}s(Am,"encode");export{q0 as handler};
/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
